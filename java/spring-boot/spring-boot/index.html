
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Một Cheatsheet lớn tổng hợp lại rất nhiều thứ hay mà mình đã học được khi học lập trình.">
      
      
        <meta name="author" content="duykhanh471">
      
      
      
        <link rel="prev" href="../core/">
      
      
        <link rel="next" href="../jpa/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Spring Boot - Lập trình Cheatsheet</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="grey">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#component-va-autowired" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Lập trình Cheatsheet" class="md-header__button md-logo" aria-label="Lập trình Cheatsheet" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lập trình Cheatsheet
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spring Boot
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/duyk471/lap-trinh-cheatsheet" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Mở PR cho trang
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Trang chủ dự án

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../html-css/co-ban/" class="md-tabs__link">
          
  
  
  HTML/CSS/JS

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../js-frameworks/react/" class="md-tabs__link">
          
  
  
  JS Frameworks

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  Java & Spring

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../rust/" class="md-tabs__link">
          
  
  
  Rust

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../linh-tinh/bash/" class="md-tabs__link">
          
  
  
  Những thứ hay ho

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../cli/yt-dlp/" class="md-tabs__link">
          
  
  
  Công cụ CLI

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../khmt/ktmt/" class="md-tabs__link">
          
  
  
  Khoa học máy tính

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../toan/cao-cap/" class="md-tabs__link">
          
  
  
  Toán

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Lập trình Cheatsheet" class="md-nav__button md-logo" aria-label="Lập trình Cheatsheet" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Lập trình Cheatsheet
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/duyk471/lap-trinh-cheatsheet" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Mở PR cho trang
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trang chủ dự án
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HTML/CSS/JS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            HTML/CSS/JS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HTML/CSS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            HTML/CSS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../html-css/co-ban/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cơ bản
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../html-css/nang-cao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nâng cao
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    JS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            JS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tổng hợp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js/array/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Array
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js/ngay-gio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ngày giờ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js/string/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    String
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js/object/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Object
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js/typescript/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Typescript cơ bản
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    JS Frameworks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            JS Frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js-frameworks/react/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js-frameworks/svelte/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Svelte
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js-frameworks/nodejs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NodeJS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../js-frameworks/expressjs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ExpressJS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Java & Spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Java & Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tổng hợp kiến thức
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_2" >
        
          
          <label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kho snippets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            Kho snippets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tổng hợp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/van-de-hang-ngay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hàng ngày
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cơ bản
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Spring Boot
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Spring Boot
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#viec-chay-ung-dung-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Việc chạy ứng dụng Spring Boot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component" class="md-nav__link">
    <span class="md-ellipsis">
      @Component
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autowired" class="md-nav__link">
    <span class="md-ellipsis">
      @Autowired
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#singleton" class="md-nav__link">
    <span class="md-ellipsis">
      Singleton
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inject-la-cai-quai-gi-vay" class="md-nav__link">
    <span class="md-ellipsis">
      Inject là cái quái gì vậy?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cach-inject-bean-cua-spring" class="md-nav__link">
    <span class="md-ellipsis">
      Cách inject Bean của Spring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#van-e-cua-autowired" class="md-nav__link">
    <span class="md-ellipsis">
      Vấn đề của @Autowired
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary" class="md-nav__link">
    <span class="md-ellipsis">
      @Primary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qualifier" class="md-nav__link">
    <span class="md-ellipsis">
      @Qualifier
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predestroy" class="md-nav__link">
    <span class="md-ellipsis">
      @PreDestroy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean-life-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      Bean Life Cycle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-du" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#y-nghia" class="md-nav__link">
    <span class="md-ellipsis">
      Ý nghĩa.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kien-truc-trong-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Kiến trúc trong Spring Boot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-vs-service-vs-repository" class="md-nav__link">
    <span class="md-ellipsis">
      @Controller vs @Service vs @Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement" class="md-nav__link">
    <span class="md-ellipsis">
      Implement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giai-thich" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-scan-la-gi" class="md-nav__link">
    <span class="md-ellipsis">
      Component Scan là gì?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Scan là gì?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Component Scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-1componentscan" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 1:@ComponentScan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-2scanbasepackages" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 2:scanBasePackages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-va-bean" class="md-nav__link">
    <span class="md-ellipsis">
      @Configuration và @Bean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="@Configuration và @Bean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-va-bean_1" class="md-nav__link">
    <span class="md-ellipsis">
      @Configuration và @Bean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hoat-ong-nen" class="md-nav__link">
    <span class="md-ellipsis">
      Hoạt động nền
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#co-y-nghia-gi" class="md-nav__link">
    <span class="md-ellipsis">
      Có ý nghĩa gì?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bean-co-tham-so" class="md-nav__link">
    <span class="md-ellipsis">
      @Bean có tham số
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thuc-te" class="md-nav__link">
    <span class="md-ellipsis">
      Thực tế
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-config-va-value" class="md-nav__link">
    <span class="md-ellipsis">
      Application Config và @Value
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Config và @Value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#applicationproperties" class="md-nav__link">
    <span class="md-ellipsis">
      application.properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value" class="md-nav__link">
    <span class="md-ellipsis">
      @Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du-va-oc-them" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ và đọc thêm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    <span class="md-ellipsis">
      @Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-1" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-2" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giai-thich-cach-thymeleaf-van-hanh-expression" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích cách Thymeleaf vận hành + Expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Giải thích cách Thymeleaf vận hành + Expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thymeleaf" class="md-nav__link">
    <span class="md-ellipsis">
      Thymeleaf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cu-phap" class="md-nav__link">
    <span class="md-ellipsis">
      Cú pháp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-view-trong-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Model &amp; View Trong Spring Boot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-variables-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      ${...} - Variables Expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-variables-expressions-on-selections" class="md-nav__link">
    <span class="md-ellipsis">
      *{...} - Variables Expressions on selections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-message-expression" class="md-nav__link">
    <span class="md-ellipsis">
      #{...} - Message Expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-url-expression" class="md-nav__link">
    <span class="md-ellipsis">
      @{...} - URL Expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postmapping" class="md-nav__link">
    <span class="md-ellipsis">
      @PostMapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestmapping" class="md-nav__link">
    <span class="md-ellipsis">
      @RequestMapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmapping" class="md-nav__link">
    <span class="md-ellipsis">
      GetMapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#van-e-cua-hibernate-truyen-thong" class="md-nav__link">
    <span class="md-ellipsis">
      Vấn đề của Hibernate truyền thống
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jparepository" class="md-nav__link">
    <span class="md-ellipsis">
      JpaRepository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spring-jpa-method-query" class="md-nav__link">
    <span class="md-ellipsis">
      Spring JPA Method + @Query
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spring JPA Method + @Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Query Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quy-tac-at-ten-method-trong-spring-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      Quy tắc đặt tên method trong Spring JPA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    <span class="md-ellipsis">
      @Query
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chi-tiet-spring-boot-thymeleaf-mysql-i18n" class="md-nav__link">
    <span class="md-ellipsis">
      Chi tiết Spring Boot + Thymeleaf + MySQL + i18n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chi tiết Spring Boot + Thymeleaf + MySQL + i18n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tao-database" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-hinh-ung-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Cấu hình ứng dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-model" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todoconfig" class="md-nav__link">
    <span class="md-ellipsis">
      TodoConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tang-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Tầng Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tang-service" class="md-nav__link">
    <span class="md-ellipsis">
      Tầng Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tang-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Tầng Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templates" class="md-nav__link">
    <span class="md-ellipsis">
      Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i18n" class="md-nav__link">
    <span class="md-ellipsis">
      i18n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestbody" class="md-nav__link">
    <span class="md-ellipsis">
      @RequestBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pathvariable" class="md-nav__link">
    <span class="md-ellipsis">
      @PathVariable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsestatus" class="md-nav__link">
    <span class="md-ellipsis">
      @ResponseStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huong-dan-su-dung-configurationproperties" class="md-nav__link">
    <span class="md-ellipsis">
      Hướng dẫn sử dụng @ConfigurationProperties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hướng dẫn sử dụng @ConfigurationProperties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cau-hinh-on-gian" class="md-nav__link">
    <span class="md-ellipsis">
      Cấu hình đơn giản
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chay-thu" class="md-nav__link">
    <span class="md-ellipsis">
      Chạy thử
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Nested Properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-kich-hoat-config" class="md-nav__link">
    <span class="md-ellipsis">
      2. Kích hoạt config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Kích hoạt config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#su-dung-springprofilesactive-trong-file-applicationproperties-hoac-applicationyml" class="md-nav__link">
    <span class="md-ellipsis">
      Sử dụng spring.profiles.active trong file application.properties hoặc application.yml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-su-dung-jvm-system-parameter-nen-dung" class="md-nav__link">
    <span class="md-ellipsis">
      3: Sử dụng JVM System Parameter (nên dùng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-environment-variable-unix-nen-dung" class="md-nav__link">
    <span class="md-ellipsis">
      4: Environment Variable (Unix) (nên dùng)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cach-su-dung-profile" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cách sử dụng @Profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testconfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      @TestConfiguration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mockbean" class="md-nav__link">
    <span class="md-ellipsis">
      @MockBean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-1" class="md-nav__link">
    <span class="md-ellipsis">
      Demo 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-bang-springboottest" class="md-nav__link">
    <span class="md-ellipsis">
      Test bằng @SpringBootTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#van-e-test-spring-boot-2" class="md-nav__link">
    <span class="md-ellipsis">
      Vấn đề Test + Spring Boot 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webmvctest" class="md-nav__link">
    <span class="md-ellipsis">
      @WebMvcTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-2" class="md-nav__link">
    <span class="md-ellipsis">
      Demo 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-test-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Test Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ket" class="md-nav__link">
    <span class="md-ellipsis">
      Kết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huong-dan-chi-tiet-test-spring-boot-phan-2" class="md-nav__link">
    <span class="md-ellipsis">
      Hướng dẫn chi tiết Test Spring Boot (Phần 2)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hướng dẫn chi tiết Test Spring Boot (Phần 2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai-at_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajpatest" class="md-nav__link">
    <span class="md-ellipsis">
      @DataJpaTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-data" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      @Sql
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ket_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sb20-huong-dan-toan-tap-mockito" class="md-nav__link">
    <span class="md-ellipsis">
      [SB20] Hướng dẫn toàn tập Mockito
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[SB20] Hướng dẫn toàn tập Mockito">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yeu-cau" class="md-nav__link">
    <span class="md-ellipsis">
      Yêu cầu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gioi-thieu" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at_2" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-mock" class="md-nav__link">
    <span class="md-ellipsis">
      Cách Mock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-1-mockitomock" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 1: Mockito.mock()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-2-su-dung-mock" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 2: Sử dụng @Mock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-su-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Cách sử dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spy" class="md-nav__link">
    <span class="md-ellipsis">
      Spy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#captor" class="md-nav__link">
    <span class="md-ellipsis">
      Captor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-mock" class="md-nav__link">
    <span class="md-ellipsis">
      Inject Mock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ket_2" class="md-nav__link">
    <span class="md-ellipsis">
      Kết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jpa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jpa
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Rust
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cơ bản
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/thuat-toan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thuật toán
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/command-line/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/he-thong/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/internet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tệp
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Tệp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/tep/epub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EPUB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/tep/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/tep/html/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust/tep/rss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RSS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Những thứ hay ho
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Những thứ hay ho
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linh-tinh/bash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linh-tinh/regex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regex
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Công cụ CLI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Công cụ CLI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/yt-dlp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    yt-dlp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/pandoc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pandoc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/cac-ung-dung-khac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Các ứng dụng khác
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Khoa học máy tính
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Khoa học máy tính
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kiến trúc máy tính
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Kiến trúc máy tính
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trang chủ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Adder%20Chip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adder Chip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Arithmetic%20Logic%20Unit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arithmetic Logic Unit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Arithmetic%20Logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Assembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Bit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Boolean%20Algebra/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/CPU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Cache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Combinational%20chips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Control%20Unit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/C%E1%BB%95ng%20Logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Input%20%26%20Output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Machine%20Language/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Program%20Counter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Register/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../khmt/ktmt/Sequential%20chips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    X
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Toán
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Toán
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../toan/cao-cap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Toán cao cấp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../toan/roi-rac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Toán rời rạc
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#viec-chay-ung-dung-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Việc chạy ứng dụng Spring Boot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component" class="md-nav__link">
    <span class="md-ellipsis">
      @Component
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autowired" class="md-nav__link">
    <span class="md-ellipsis">
      @Autowired
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#singleton" class="md-nav__link">
    <span class="md-ellipsis">
      Singleton
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inject-la-cai-quai-gi-vay" class="md-nav__link">
    <span class="md-ellipsis">
      Inject là cái quái gì vậy?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cach-inject-bean-cua-spring" class="md-nav__link">
    <span class="md-ellipsis">
      Cách inject Bean của Spring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#van-e-cua-autowired" class="md-nav__link">
    <span class="md-ellipsis">
      Vấn đề của @Autowired
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary" class="md-nav__link">
    <span class="md-ellipsis">
      @Primary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qualifier" class="md-nav__link">
    <span class="md-ellipsis">
      @Qualifier
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predestroy" class="md-nav__link">
    <span class="md-ellipsis">
      @PreDestroy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean-life-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      Bean Life Cycle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-du" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#y-nghia" class="md-nav__link">
    <span class="md-ellipsis">
      Ý nghĩa.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kien-truc-trong-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Kiến trúc trong Spring Boot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-vs-service-vs-repository" class="md-nav__link">
    <span class="md-ellipsis">
      @Controller vs @Service vs @Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement" class="md-nav__link">
    <span class="md-ellipsis">
      Implement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giai-thich" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-scan-la-gi" class="md-nav__link">
    <span class="md-ellipsis">
      Component Scan là gì?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component Scan là gì?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Component Scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-1componentscan" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 1:@ComponentScan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-2scanbasepackages" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 2:scanBasePackages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-va-bean" class="md-nav__link">
    <span class="md-ellipsis">
      @Configuration và @Bean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="@Configuration và @Bean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-va-bean_1" class="md-nav__link">
    <span class="md-ellipsis">
      @Configuration và @Bean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hoat-ong-nen" class="md-nav__link">
    <span class="md-ellipsis">
      Hoạt động nền
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#co-y-nghia-gi" class="md-nav__link">
    <span class="md-ellipsis">
      Có ý nghĩa gì?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bean-co-tham-so" class="md-nav__link">
    <span class="md-ellipsis">
      @Bean có tham số
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thuc-te" class="md-nav__link">
    <span class="md-ellipsis">
      Thực tế
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-config-va-value" class="md-nav__link">
    <span class="md-ellipsis">
      Application Config và @Value
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Config và @Value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#applicationproperties" class="md-nav__link">
    <span class="md-ellipsis">
      application.properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value" class="md-nav__link">
    <span class="md-ellipsis">
      @Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du-va-oc-them" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ và đọc thêm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    <span class="md-ellipsis">
      @Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-1" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-2" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giai-thich-cach-thymeleaf-van-hanh-expression" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích cách Thymeleaf vận hành + Expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Giải thích cách Thymeleaf vận hành + Expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thymeleaf" class="md-nav__link">
    <span class="md-ellipsis">
      Thymeleaf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cu-phap" class="md-nav__link">
    <span class="md-ellipsis">
      Cú pháp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-view-trong-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Model &amp; View Trong Spring Boot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-variables-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      ${...} - Variables Expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-variables-expressions-on-selections" class="md-nav__link">
    <span class="md-ellipsis">
      *{...} - Variables Expressions on selections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-message-expression" class="md-nav__link">
    <span class="md-ellipsis">
      #{...} - Message Expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-url-expression" class="md-nav__link">
    <span class="md-ellipsis">
      @{...} - URL Expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postmapping" class="md-nav__link">
    <span class="md-ellipsis">
      @PostMapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestmapping" class="md-nav__link">
    <span class="md-ellipsis">
      @RequestMapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmapping" class="md-nav__link">
    <span class="md-ellipsis">
      GetMapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#van-e-cua-hibernate-truyen-thong" class="md-nav__link">
    <span class="md-ellipsis">
      Vấn đề của Hibernate truyền thống
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jparepository" class="md-nav__link">
    <span class="md-ellipsis">
      JpaRepository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spring-jpa-method-query" class="md-nav__link">
    <span class="md-ellipsis">
      Spring JPA Method + @Query
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spring JPA Method + @Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Query Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quy-tac-at-ten-method-trong-spring-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      Quy tắc đặt tên method trong Spring JPA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    <span class="md-ellipsis">
      @Query
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chi-tiet-spring-boot-thymeleaf-mysql-i18n" class="md-nav__link">
    <span class="md-ellipsis">
      Chi tiết Spring Boot + Thymeleaf + MySQL + i18n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chi tiết Spring Boot + Thymeleaf + MySQL + i18n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tao-database" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-hinh-ung-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Cấu hình ứng dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-model" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todoconfig" class="md-nav__link">
    <span class="md-ellipsis">
      TodoConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tang-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Tầng Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tang-service" class="md-nav__link">
    <span class="md-ellipsis">
      Tầng Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tang-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Tầng Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templates" class="md-nav__link">
    <span class="md-ellipsis">
      Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i18n" class="md-nav__link">
    <span class="md-ellipsis">
      i18n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestbody" class="md-nav__link">
    <span class="md-ellipsis">
      @RequestBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pathvariable" class="md-nav__link">
    <span class="md-ellipsis">
      @PathVariable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsestatus" class="md-nav__link">
    <span class="md-ellipsis">
      @ResponseStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huong-dan-su-dung-configurationproperties" class="md-nav__link">
    <span class="md-ellipsis">
      Hướng dẫn sử dụng @ConfigurationProperties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hướng dẫn sử dụng @ConfigurationProperties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cau-hinh-on-gian" class="md-nav__link">
    <span class="md-ellipsis">
      Cấu hình đơn giản
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chay-thu" class="md-nav__link">
    <span class="md-ellipsis">
      Chạy thử
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Nested Properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-kich-hoat-config" class="md-nav__link">
    <span class="md-ellipsis">
      2. Kích hoạt config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Kích hoạt config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#su-dung-springprofilesactive-trong-file-applicationproperties-hoac-applicationyml" class="md-nav__link">
    <span class="md-ellipsis">
      Sử dụng spring.profiles.active trong file application.properties hoặc application.yml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-su-dung-jvm-system-parameter-nen-dung" class="md-nav__link">
    <span class="md-ellipsis">
      3: Sử dụng JVM System Parameter (nên dùng)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-environment-variable-unix-nen-dung" class="md-nav__link">
    <span class="md-ellipsis">
      4: Environment Variable (Unix) (nên dùng)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cach-su-dung-profile" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cách sử dụng @Profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testconfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      @TestConfiguration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mockbean" class="md-nav__link">
    <span class="md-ellipsis">
      @MockBean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-1" class="md-nav__link">
    <span class="md-ellipsis">
      Demo 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-bang-springboottest" class="md-nav__link">
    <span class="md-ellipsis">
      Test bằng @SpringBootTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#van-e-test-spring-boot-2" class="md-nav__link">
    <span class="md-ellipsis">
      Vấn đề Test + Spring Boot 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webmvctest" class="md-nav__link">
    <span class="md-ellipsis">
      @WebMvcTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-2" class="md-nav__link">
    <span class="md-ellipsis">
      Demo 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-test-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Test Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ket" class="md-nav__link">
    <span class="md-ellipsis">
      Kết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huong-dan-chi-tiet-test-spring-boot-phan-2" class="md-nav__link">
    <span class="md-ellipsis">
      Hướng dẫn chi tiết Test Spring Boot (Phần 2)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hướng dẫn chi tiết Test Spring Boot (Phần 2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai-at_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajpatest" class="md-nav__link">
    <span class="md-ellipsis">
      @DataJpaTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-data" class="md-nav__link">
    <span class="md-ellipsis">
      Tạo Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      @Sql
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ket_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sb20-huong-dan-toan-tap-mockito" class="md-nav__link">
    <span class="md-ellipsis">
      [SB20] Hướng dẫn toàn tập Mockito
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[SB20] Hướng dẫn toàn tập Mockito">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yeu-cau" class="md-nav__link">
    <span class="md-ellipsis">
      Yêu cầu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gioi-thieu" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at_2" class="md-nav__link">
    <span class="md-ellipsis">
      Cài đặt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-mock" class="md-nav__link">
    <span class="md-ellipsis">
      Cách Mock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-1-mockitomock" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 1: Mockito.mock()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-2-su-dung-mock" class="md-nav__link">
    <span class="md-ellipsis">
      Cách 2: Sử dụng @Mock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cach-su-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Cách sử dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spy" class="md-nav__link">
    <span class="md-ellipsis">
      Spy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#captor" class="md-nav__link">
    <span class="md-ellipsis">
      Captor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-mock" class="md-nav__link">
    <span class="md-ellipsis">
      Inject Mock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ket_2" class="md-nav__link">
    <span class="md-ellipsis">
      Kết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="component-va-autowired">@Component và @Autowired<a class="headerlink" href="#component-va-autowired" title="Permanent link">&para;</a></h1>
<p><a href="https://viblo.asia/p/spring-boot-1-huong-dan-atcomponent-va-atautowired-E375zXvJZGW">Đường dẫn bài viết</a></p>
<p>Thường thì giờ đã có <a href="https://start.spring.io/">Spring Initializr</a> rồi nên thêm dự án mới rất dễ!</p>
<h3 id="viec-chay-ung-dung-spring-boot">Việc chạy ứng dụng Spring Boot<a class="headerlink" href="#viec-chay-ung-dung-spring-boot" title="Permanent link">&para;</a></h3>
<p>Chương trình chạy ở hàm <code>main()</code> và cần thêm annotation <code>@SpringBootApplication</code> trên class chính và gọi <code>SpringApplication.run(App.class, args);</code> để chạy project (Cho Spring Boot biết <code>main()</code> ở chỗ nào). <code>SpringApplication.run(App.class, args)</code> chính là câu lệnh để tạo ra <em>container</em>. Sau đó nó tìm toàn bộ các <em>dependency</em> trong project của bạn và đưa vào đó.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ApplicationContext chứa toàn bộ dependency trong project.</span>
<span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Spring đặt tên cho:</p>
<ul>
<li><em>container</em> là <code>ApplicationContext</code></li>
<li><em>dependency</em> là <code>Bean</code> (Để biết cái nào là <em>dependency</em> thì dùng <code>@Component</code>)</li>
</ul>
<h3 id="component">@Component<a class="headerlink" href="#component" title="Permanent link">&para;</a></h3>
<p>@Component là một Annotation (chú thích) đánh dấu trên các Class để giúp Spring biết nó là một Bean. </p>
<p>Trong quá trình dò các <em>classes</em>, khi gặp một class được đánh dấu <code>@Component</code> thì nó sẽ tạo ra một instance và đưa vào <code>ApplicationContext</code> để quản lý.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ApplicationContext chính là container, chứa toàn bộ các Bean</span>
<span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="c1">// Khi chạy xong, lúc này context sẽ chứa các Bean có đánh</span>
<span class="c1">// dấu @Component.</span>
<span class="c1">// Lấy Bean ra bằng cách</span>
<span class="n">Outfit</span><span class="w"> </span><span class="n">outfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Outfit</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="c1">// In ra để xem thử nó là gì</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Instance: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">outfit</span><span class="p">);</span>
<span class="c1">// xài hàm wear()</span>
<span class="n">outfit</span><span class="p">.</span><span class="na">wear</span><span class="p">();</span>
<span class="c1">// Output</span>
<span class="c1">// [1] Instance: me.loda.spring.helloworld.Bikini@1e1f6d9d</span>
<span class="c1">// [2] Mặc bikini</span>
</code></pre></div>
<p>Danh sách các bước đơn giản là:</p>
<ol>
<li>Chạy <code>SpringApplication.run(App.class, args);</code></li>
<li>Dò tìm các Classes cùng cấp.</li>
<li>Thấy Class được đánh dấu bằng <code>@Component</code> thì tạo <code>new Customer()</code> chẳng hạn và đưa vào Context (Hay <code>ApplicationContext</code>)</li>
</ol>
<h3 id="autowired">@Autowired<a class="headerlink" href="#autowired" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>@Component
public class TuiXach {

    @Autowired
    Money tien;

    public TuiXach (Money tien) {
        this.tien = tien;
    }
}
</code></pre></div>
<p>Tôi đánh dấu thuộc tính <code>Money</code> (Tiền) của <code>TuiXach</code> (Túi xách) bởi Annotation <code>@Autowired</code>. Điều này nói với Spring Boot hãy tự <em>inject</em> (tiêm) một instance của <code>Money</code> vào thuộc tính này khi khởi tạo <code>TuiXach</code> (Thuộc tính được đánh dấu là <code>@Autowired</code> trong Class được đánh dấu là <code>Component</code>).</p>
<h3 id="singleton">Singleton<a class="headerlink" href="#singleton" title="Permanent link">&para;</a></h3>
<p>Điều đặc biệt là các <code>Bean</code> được quản lý bên trong <code>ApplicationContext</code> đều là singleton.</p>
<p>Tất cả những <code>Bean</code> được quản lý trong <code>ApplicationContext</code> đều chỉ được tạo ra một lần duy nhất và khi có <code>Class</code> yêu cầu <code>@Autowired</code> thì nó sẽ lấy đối tượng có sẵn trong <code>ApplicationContext</code> để <em>inject</em> vào.</p>
<p>Trong trường hợp bạn muốn mỗi lần sử dụng là một instance hoàn toàn mới. Thì hãy đánh dấu <code>@Component</code> đó bằng <code>@Scope("prototype")</code></p>
<h3 id="inject-la-cai-quai-gi-vay">Inject là cái quái gì vậy?<a class="headerlink" href="#inject-la-cai-quai-gi-vay" title="Permanent link">&para;</a></h3>
<p>Đây không phải là phần hướng dẫn của loda, nhưng mình vẫn chưa hiểu <em>inject</em> (về cơ bản nghĩa là tiêm) là gì? Thử lấy ví dụ về truyền dịch.</p>
<p><em>Truyền nước biển còn gọi là truyền dịch là phương pháp đưa nhỏ giọt muối và các chất điện giải vào cơ thể bằng đường tĩnh mạch khi có chỉ định của bác sĩ.</em></p>
<p>Khi đó thành các <em>giọt muối và các chất điện giải</em> sẽ được <em>inject</em> và trở thành <em>thuộc tính</em> trong bạn. Mỗi một Class trong Java cũng như bạn, là một <em>đối tượng</em> (dm giải thích ngu quá mà tính lấy ví dụ Peter Park được nhện chích và thành Spider Man thì có phải hay không???)</p>
<p><em>Dependency Injection</em> cho phép "inject" (tiêm) những dependencies vào một đối tượng. Thay vì đối tượng phải tự tạo ra những Dependencies của chính nó. Điều này sẽ giúp giảm khả năng phụ thuộc giữa những thành phần. # @Autowired - @Primary - @Qualifier</p>
<p>Trong bài viết này chúng ta sẽ cùng tìm hiểu cách <code>@Autowỉed</code> vận hành và cách sử dụng 2 Annotation <code>@Primary</code>, <code>@Qualifier</code>.</p>
<h3 id="cach-inject-bean-cua-spring">Cách inject Bean của Spring<a class="headerlink" href="#cach-inject-bean-cua-spring" title="Permanent link">&para;</a></h3>
<p><code>@Autowired</code> đánh dấu cho Spring biết rằng sẽ tự động inject bean tương ứng vào vị trí được đánh dấu.</p>
<div class="highlight"><pre><span></span><code>@Component
public class Girl {
    // Đánh dấu để Spring inject một đối tượng Outfit vào đây
    @Autowired
    Outfit outfit;

    // public Girl(Outfit outfit) {
    //     this.outfit = outfit;
    // }

    // GET
    // SET
}
</code></pre></div>
<p>Sau khi tìm thấy một class đánh dấu <code>@Component</code>. thì quá trình inject <code>Bean</code> xảy ra theo cách như sau:</p>
<ol>
<li>Nếu <code>Class</code> không có hàm Constructor hay Setter. Thì sẽ sử dụng Java Reflection để đưa đối tượng vào thuộc tính có đánh dấu <code>@Autowired</code>.</li>
<li>Nếu có hàm Constructor thì sẽ inject Bean vào bởi tham số của hàm</li>
<li>Nếu có hàm Setter thì sẽ inject Bean vào bởi tham số của hàm</li>
</ol>
<p>Như ví dụ ở trên tôi đã sử dụng cách Java Reflection để inject <code>Bean</code> vào class <code>Girl</code>. </p>
<p>Bạn cũng có thể gắn <code>@Autowired</code> lên trên method, thay vì thuộc tính, chức năng cũng vẫn tương tự, nó sẽ tìm Bean phù hợp với method đó và truyền vào.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Girl</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Đánh dấu để Spring inject một đối tượng Outfit vào đây</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">Outfit</span><span class="w"> </span><span class="n">outfit</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Spring sẽ inject outfit thông qua Constructor trước</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Girl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Nếu không tìm thấy Constructor thoả mãn, nó sẽ thông qua setter</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOutfit</span><span class="p">(</span><span class="n">Outfit</span><span class="w"> </span><span class="n">outfit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">outfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outfit</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="c1">// Nếu không tìm thấy Constructor thoả mãn, nó sẽ thông qua setter, </span>
<span class="w">    </span><span class="c1">// nếu v thì đừng gắn Autowired ở properties ở trên nha</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOutfit</span><span class="p">(</span><span class="n">Outfit</span><span class="w"> </span><span class="n">outfit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">outfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outfit</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// GET</span>
<span class="w">    </span><span class="c1">// SET</span>
<span class="p">}</span>
</code></pre></div>
<p>Nếu không sử dụng <code>@Autowired</code> thì bạn phải có một Constructor thay thế, hoặc một Setter tương ứng. Khá nhiều các đồng chí gợi ý không dùng <code>@Autowired</code> và thay thế bằng:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Calculator</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">Multiplier</span><span class="w"> </span><span class="n">multiplier</span><span class="p">;</span>
<span class="w">   </span><span class="c1">// Cái lày là constructor</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="nf">Calculator</span><span class="p">(</span><span class="n">Multiplier</span><span class="w"> </span><span class="n">multiplier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">multiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">multiplier</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="van-e-cua-autowired">Vấn đề của @Autowired<a class="headerlink" href="#van-e-cua-autowired" title="Permanent link">&para;</a></h3>
<p>Trong thực tế, sẽ có trường hợp chúng ta sử dụng <code>@Autowired</code> khi <strong>Spring Boot</strong> có chứa 2 Bean cùng loại trong Context. Lúc này thì <strong>Spring</strong> sẽ bối rối và không biết sử dụng Bean nào để inject vào đối tượng.</p>
<h3 id="primary"><strong>@Primary</strong><a class="headerlink" href="#primary" title="Permanent link">&para;</a></h3>
<p>Cách giải quyết thứ nhất là sử dụng Annotation <code>@Primary</code>. <code>@Primary</code> là annotation đánh dấu trên một Bean, giúp nó <strong>luôn được ưu tiên lựa</strong> chọn trong trường hợp có nhiều Bean cùng loại trong Context.</p>
<p>Trong ví dụ ở trên, nếu chúng ta để <code>Suit</code> là primary. Thì chương trình sẽ chạy bình thường. Và hiển nhiên <code>Outfit</code> bên trong <code>Girl</code> sẽ là <code>Suit</code>.</p>
<p>Chạy thử chương trình:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ===========================================================================</span>
<span class="nd">@Component</span>
<span class="nd">@Primary</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Suit</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Outfit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">wear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Đang mặc âu phục&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ===========================================================================</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ApplicationContext chính là container, chứa toàn bộ các Bean</span>
<span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Khi chạy xong, lúc này context sẽ chứa các Bean có đánh</span>
<span class="w">        </span><span class="c1">// dấu @Component.</span>
<span class="w">        </span><span class="n">Girl</span><span class="w"> </span><span class="n">girl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Girl</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Girl Instance: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">girl</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Girl Outfit: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">girl</span><span class="p">.</span><span class="na">outfit</span><span class="p">);</span>
<span class="w">        </span><span class="n">girl</span><span class="p">.</span><span class="na">outfit</span><span class="p">.</span><span class="na">wear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ===========================================================================</span>
<span class="c1">// Output:</span>
<span class="c1">// Girl Instance: me.loda.spring.helloprimaryqualifier.Girl@eb9a089</span>
<span class="c1">// Girl Outfit: me.loda.spring.helloprimaryqualifier.Naked@1688653c</span>
<span class="c1">// Đang mặc âu phục</span>
</code></pre></div>
<h3 id="qualifier"><strong>@Qualifier</strong><a class="headerlink" href="#qualifier" title="Permanent link">&para;</a></h3>
<p>Cách thứ hai, là sử dụng Annotation <code>@Qualifier</code>. <code>@Qualifier</code> xác định tên của một Bean mà bạn muốn chỉ định inject.</p>
<p>Ví dụ:</p>
<p><div class="highlight"><pre><span></span><code><span class="nd">@Component</span><span class="p">(</span><span class="s">&quot;suit&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Suit</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Outfit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">wear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mặc âu phục&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ==============================================</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Girl</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">Outfit</span><span class="w"> </span><span class="n">outfit</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Đánh dấu để Spring inject một đối tượng Outfit vào đây</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Girl</span><span class="p">(</span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;suit&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Outfit</span><span class="w"> </span><span class="n">outfit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Spring sẽ inject outfit thông qua Constructor đầu tiên</span>
<span class="w">        </span><span class="c1">// Ngoài ra, nó sẽ tìm Bean có @Qualifier(&quot;naked&quot;) trong context để ịnject</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">outfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outfit</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// GET</span>
<span class="w">    </span><span class="c1">// SET</span>
<span class="p">}</span>
<span class="err">```#</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Bean</span><span class="w"> </span><span class="n">Life</span><span class="w"> </span><span class="n">Cycle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nd">@PostConstruct</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="nd">@PreDestroy</span>

<span class="n">Tìm</span><span class="w"> </span><span class="n">hiểu</span><span class="w"> </span><span class="n">về</span><span class="w"> </span><span class="n">vòng</span><span class="w"> </span><span class="n">đời</span><span class="w"> </span><span class="n">của</span><span class="w"> </span><span class="n">Bean</span>

<span class="err">###</span><span class="w"> </span><span class="nd">@PostConstruct</span>

<span class="err">`</span><span class="nd">@PostConstruct</span><span class="err">`</span><span class="w"> </span><span class="n">được</span><span class="w"> </span><span class="n">đánh</span><span class="w"> </span><span class="n">dấu</span><span class="w"> </span><span class="n">trên</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">duy</span><span class="w"> </span><span class="n">nhất</span><span class="w"> </span><span class="n">bên</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="err">`</span><span class="n">Bean</span><span class="err">`</span><span class="p">.</span><span class="w"> </span>

<span class="err">`</span><span class="n">IoC</span><span class="w"> </span><span class="n">Container</span><span class="err">`</span><span class="w"> </span><span class="n">hoặc</span><span class="w"> </span><span class="err">`</span><span class="n">ApplicationContext</span><span class="err">`</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">gọi</span><span class="w"> </span><span class="n">hàm</span><span class="w"> </span><span class="n">này</span><span class="w"> </span><span class="n">sau</span><span class="w"> </span><span class="n">khi</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="err">`</span><span class="n">Bean</span><span class="err">`</span><span class="w"> </span><span class="n">được</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">quản</span><span class="w"> </span><span class="n">lý</span><span class="p">.</span>
</code></pre></div>
@Component
public class Girl {</p>
<pre><code>@PostConstruct
public void postConstruct(){
    System.out.println("\t&gt;&gt; Đối tượng Girl sau khi khởi tạo xong sẽ chạy hàm này");
}
</code></pre>
<p>}
```
</p>
<h3 id="predestroy">@PreDestroy<a class="headerlink" href="#predestroy" title="Permanent link">&para;</a></h3>
<p><code>@PreDestroy</code> được đánh dấu trên một method duy nhất bên trong <code>Bean</code>. 

<code>IoC Container</code> hoặc <code>ApplicationContext</code> sẽ gọi hàm này trước khi một <code>Bean</code> bị xóa hoặc không được quản lý nữa.

```
@Component
public class Girl {</p>
<pre><code>@PreDestroy
public void preDestroy(){
    System.out.println("\t&gt;&gt; Đối tượng Girl trước khi bị destroy thì chạy hàm này");
}
</code></pre>
<p>}
```
</p>
<h3 id="bean-life-cycle">Bean Life Cycle<a class="headerlink" href="#bean-life-cycle" title="Permanent link">&para;</a></h3>
<p>Spring Boot từ thời điểm chạy lần đầu tới khi <em>shutdown</em> thì các <code>Bean</code> nó quản lý sẽ có một vòng đời được biểu diễn như ảnh dưới đây.

<img alt="" src="https://images.viblo.asia/2380e7ca-0b97-4be3-9054-27430b29e150.jpg" />

Nhìn có vẻ loằng ngoằng, trong series căn bản này, bạn có lẽ sẽ chỉ cần hiểu như sau:

1. Khi <code>IoC Container</code> (<code>ApplicationContext</code>) tìm thấy một Bean cần quản lý, nó sẽ khởi tạo bằng <code>Constructor</code>.
2. inject dependencies vào <code>Bean</code> bằng Setter, và thực hiện các quá trình cài đặt khác vào <code>Bean</code> như <code>setBeanName</code>, <code>setBeanClassLoader</code>, v.v..
3. Hàm đánh dấu <code>@PostConstruct</code> được gọi
4. Tiền xử lý sau khi <code>@PostConstruct</code> được gọi.
5. <code>Bean</code> sẵn sàng để hoạt động
6. Nếu <code>IoC Container</code> không quản lý bean nữa hoặc bị shutdown nó sẽ gọi hàm <code>@PreDestroy</code> trong <code>Bean</code>
7. Xóa <code>Bean</code>.
</p>
<h3 id="vi-du">Ví dụ<a class="headerlink" href="#vi-du" title="Permanent link">&para;</a></h3>
<p>Chúng ta tạo ra class <code>Girl</code> bao gồm:

<code>java
import org.springframework.stereotype.Component;
import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

@Component
public class Girl {

    @PostConstruct
    public void postConstruct(){
        System.out.println("\t&gt;&gt; Đối tượng Girl sau khi khởi tạo xong sẽ chạy hàm này");
    }

    @PreDestroy
    public void preDestroy(){
        System.out.println("\t&gt;&gt; Đối tượng Girl trước khi bị destroy thì chạy hàm này");
    }
}</code></p>
<p>In ra màn hình quá Spring Boot chạy lần đầu cho tới khi shutdown:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ConfigurableApplicationContext</span><span class="p">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ApplicationContext chính là container, chứa toàn bộ các Bean</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;&gt; Trước khi IoC Container được khởi tạo&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;&gt; Sau khi IoC Container được khởi tạo&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Khi chạy xong, lúc này context sẽ chứa các Bean có đánh</span>
<span class="w">        </span><span class="c1">// dấu @Component.</span>
<span class="w">        </span><span class="n">Girl</span><span class="w"> </span><span class="n">girl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Girl</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;&gt; Trước khi IoC Container destroy Girl&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">((</span><span class="n">ConfigurableApplicationContext</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">).</span><span class="na">getBeanFactory</span><span class="p">().</span><span class="na">destroyBean</span><span class="p">(</span><span class="n">girl</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;&gt; Sau khi IoC Container destroy Girl&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Output:</p>
<div class="highlight"><pre><span></span><code>&gt; Trước khi IoC Container được khởi tạo
&gt; Trước khi IoC Container được khởi tạo
    &gt;&gt; Đối tượng Girl sau khi khởi tạo xong sẽ chạy hàm này
&gt; Sau khi IoC Container được khởi tạo
&gt; Trước khi IoC Container destroy Girl
    &gt;&gt; Đối tượng Girl trước khi bị destroy thì chạy hàm này
&gt; Sau khi IoC Container destroy Girl
</code></pre></div>
<p>Bạn sẽ thấy dòng <em>"Trước khi IoC Container được khởi tạo"</em> được chạy 2 lần. Điều này xảy ra bởi vì hàm App.main(args) được chạy 2 lần!</p>
<p>Lần đầu là do chúng ta chạy. Lần thứ hai là do Spring Boot chạy sau khi nó được gọi <code>SpringApplication.run(App.class, args)</code>. Đây là lúc mà IoC Container (<code>ApplicationContext</code>) được tạo ra và đi tìm <code>Bean</code>.</p>
<h3 id="y-nghia">Ý nghĩa.<a class="headerlink" href="#y-nghia" title="Permanent link">&para;</a></h3>
<p><code>@PostConstruct</code> và <code>@PreDestroy</code> là 2 Annotation cực kỳ ý nghĩa, nếu bạn nắm được vòng đời của một <code>Bean</code>, bạn có thể tận dụng nó để làm các nhiệm vụ riêng như setting, thêm giá trị mặc định trong thuộc tính sau khi tạo, xóa dữ liệu trước khi xóa, v.v.. Rất nhiều chức năng khác tùy theo nhu cầu.# @Component vs @Service vs @Repository</p>
<h3 id="kien-truc-trong-spring-boot">Kiến trúc trong Spring Boot<a class="headerlink" href="#kien-truc-trong-spring-boot" title="Permanent link">&para;</a></h3>
<p>Kiến trúc MVC trong Spring Boot được xây dựng dựa trên tư tưởng "độc lập" kết hợp với các nguyên lý thiết kế hướng đối tượng (một đại diện tiêu biểu là Dependency Inversion). </p>
<p>Độc lập ở đây ám chỉ việc các layer phục vụ các mục đích nhất định, khi muốn thực hiện một công việc ngoài phạm vi thì sẽ đưa công việc xuống các layer thấp hơn.</p>
<p>Kiến trúc Controller - Service - Repository chia project thành 3 lớp:</p>
<ul>
<li>Consumer Layer hay Controller: là tầng giao tiếp với bên ngoài và handler các request từ bên ngoài tới hệ thống.</li>
<li>Service Layer: Thực hiện các nghiệp vụ và xử lý logic</li>
<li>Repository Layer: Chịu trách nhiệm giao tiếp với các DB, thiết bị lưu trữ, xử lý query và trả về các kiểu dữ liệu mà tầng Service yêu cầu.</li>
</ul>
<h3 id="controller-vs-service-vs-repository">@Controller vs @Service vs @Repository<a class="headerlink" href="#controller-vs-service-vs-repository" title="Permanent link">&para;</a></h3>
<p>Để phục vụ cho kiến trúc ở trên, Spring Boot tạo ra 3 Annotation là <code>@Controller</code>, <code>@Service</code>, <code>@Repository</code> để chúng ta có thể đánh dấu các tầng với nhau.</p>
<ul>
<li><code>@Service</code> Đánh dấu một Class là tầng Service, phục vụ các logic nghiệp vụ.</li>
<li><code>@Repository</code> Đánh dấu một Class Là tầng Repository, phục vụ truy xuất dữ liệu.</li>
</ul>
<h3 id="implement">Implement<a class="headerlink" href="#implement" title="Permanent link">&para;</a></h3>
<p>Chạy chương trình:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Lấy ra bean GirlService</span>
<span class="w">        </span><span class="n">GirlService</span><span class="w"> </span><span class="n">girlService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">GirlService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Lấu ra random một cô gái từ tầng service</span>
<span class="w">        </span><span class="n">Girl</span><span class="w"> </span><span class="n">girl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">girlService</span><span class="p">.</span><span class="na">getRandomGirl</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// In ra màn hình</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">girl</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="giai-thich">Giải thích<a class="headerlink" href="#giai-thich" title="Permanent link">&para;</a></h3>
<p>Về bản chất <code>@Service</code> và <code>@Repository</code> cũng chính là <code>@Component</code>. Nhưng đặt tên khác nhau để giúp chúng ta phân biệt các tầng với nhau.</p>
<p>Cùng nhìn vào source code của 2 Annotation này:</p>
<p><em>Service.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Component</span><span class="w"> </span><span class="c1">// Cũng là một @Component</span>
<span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@AliasFor</span><span class="p">(</span>
<span class="w">        </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Component</span><span class="p">.</span><span class="na">class</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">value</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><em>Repository.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Repository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@AliasFor</span><span class="p">(</span>
<span class="w">        </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Component</span><span class="p">.</span><span class="na">class</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">value</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Trong các bài đầu tiên chúng ta đã biết <code>@Component</code> đánh dấu cho Spring Boot biết Class đó là <code>Bean</code>. Và hiển nhiên <code>@Service</code> và <code>@Repository</code> cũng vậy. Vì thế ở ví dụ trên chúng ta có thể lấy <code>GirlService</code> từ <code>ApplicationContext</code>. Về bản chất thì bạn có thể sử dụng thay thế 3 Annotation <code>@Component</code>, <code>@Service</code> và <code>@Repository</code> cho nhau mà không ảnh hưởng gì tới code của bạn cả. Nó vẫn sẽ hoạt động.</p>
<p>Tuy nhiên từ góc độ thiết kế thì chúng ta cần phân rõ 3 Annotation này cho các Class đảm nhiệm đúng nhiệm vụ của nó.</p>
<ul>
<li><code>@Service</code> gắn cho các <code>Bean</code> đảm nhiệm xử lý logic</li>
<li><code>@Repository</code> gắn cho các <code>Bean</code> đảm nhiệm giao tiếp với DB</li>
<li><code>@Component</code> gắn cho các <code>Bean</code> khác.</li>
</ul>
<h2 id="component-scan-la-gi">Component Scan là gì?<a class="headerlink" href="#component-scan-la-gi" title="Permanent link">&para;</a></h2>
<p>Chúng ta sẽ tìm hiểu thêm về cách Spring Boot tìm kiếm <code>Bean</code> trong project của bạn như thế nào.</p>
<h3 id="component-scan">Component Scan<a class="headerlink" href="#component-scan" title="Permanent link">&para;</a></h3>
<p>Trong bài 1 tôi có đề cập một lần về việc Spring Boot khi chạy sẽ dò tìm toàn bộ các <em>Class cùng cấp</em> hoặc ở trong các <em>package thấp hơn</em> và tạo ra Bean từ các Class tìm thấy.</p>
<p>Trong trường hợp bạn muốn tuỳ chỉnh cấu hình cho Spring Boot chỉ tìm kiếm các bean trong một package nhất định thì có các cách sau đây:</p>
<ol>
<li>Sử dụng <code>@ComponentScan</code></li>
<li>Sử dụng <code>scanBasePackages</code> tromg <code>@SpringBootApplication</code>.</li>
</ol>
<p>Bạn có thể cấu hình cho Spring Boot Tìm kiếm các Bean ở nhiều package khác nhau bằng cách</p>
<h3 id="cach-1componentscan">Cách 1:<code>@ComponentScan</code><a class="headerlink" href="#cach-1componentscan" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&quot;me.loda.spring.componentscan.others&quot;</span><span class="p">)</span>
<span class="c1">// Tìm nhiều package khác nhau</span>
<span class="c1">// @ComponentScan({&quot;me.loda.spring.componentscan.others2&quot;,&quot;me.loda.spring.componentscan.others&quot;})</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="cach-2scanbasepackages">Cách 2:<code>scanBasePackages</code><a class="headerlink" href="#cach-2scanbasepackages" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootApplication</span><span class="p">(</span><span class="n">scanBasePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;me.loda.spring.componentscan.others&quot;</span><span class="p">)</span>
<span class="c1">// Tìm nhiều package khác nhau</span>
<span class="c1">// @SpringBootApplication(scanBasePackages = {&quot;me.loda.spring.componentscan.others&quot;, &quot;me.loda.spring.componentscan.others2&quot;})</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>Cả 2 cách đều cho kết quả in ra màn hình như sau:</p>
<div class="highlight"><pre><span></span><code>Bean Girl không tồn tại
Bean: OtherGirl.java
</code></pre></div>
<p>Lúc này, Spring Boot chỉ tìm kiếm các bean trong package <code>others</code> mà thôi. Nên khi lấy ra <code>Girl</code> thì nó không tồn tại trong <code>Context</code>.</p>
<h2 id="configuration-va-bean">@Configuration và @Bean<a class="headerlink" href="#configuration-va-bean" title="Permanent link">&para;</a></h2>
<h3 id="configuration-va-bean_1">@Configuration và @Bean<a class="headerlink" href="#configuration-va-bean_1" title="Permanent link">&para;</a></h3>
<p><code>@Configuration</code> là một Annotation đánh dấu trên một <code>Class</code> cho phép Spring Boot biết được đây là nơi định nghĩa ra các <em>Bean</em>.</p>
<p><code>@Bean</code> là một Annotation được đánh dấu trên các <code>method</code> cho phép Spring Boot biết được đây là <em>Bean</em> và sẽ thực hiện đưa <em>Bean</em> này vào <code>Context</code>.</p>
<p><code>@Bean</code> sẽ nằm trong các class có đánh dấu <code>@Configuration</code>.</p>
<p>Ví dụ:</p>
<p><em>SimpleBean.java</em></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Một class cơ bản, không sử dụng `@Component`</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SimpleBean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SimpleBean</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">setUsername</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;This is a simple bean, name: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><em>AppConfig.java</em></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="n">SimpleBean</span><span class="w"> </span><span class="nf">simpleBeanConfigure</span><span class="p">(){</span>
<span class="w">        </span><span class="c1">// Khởi tạo một instance của SimpleBean và trả ra ngoài</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleBean</span><span class="p">(</span><span class="s">&quot;loda&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><em>App.java</em></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Lấy ra bean SimpleBean trong Context</span>
<span class="w">        </span><span class="n">SimpleBean</span><span class="w"> </span><span class="n">simpleBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">SimpleBean</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// In ra màn hình</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Simple Bean Example: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">simpleBean</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// OUTPUT: Simple Bean Example: This is a simple bean, name: loda</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Bạn sẽ thấy là <code>SimpleBean</code> là một object được quản lý trong <code>Context</code> của Spring Boot, mặc dù trong bài này, chúng ta không hề sử dụng tới các khái niệm <code>@Component</code>.</p>
<h3 id="hoat-ong-nen">Hoạt động nền<a class="headerlink" href="#hoat-ong-nen" title="Permanent link">&para;</a></h3>
<p>Đằng sau chương trình, Spring Boot lần đầu khởi chạy, ngoài việc đi tìm các <code>@Component</code> thì nó còn làm một nhiệm vụ nữa là tìm các class <code>@Configuration</code>.</p>
<ol>
<li>Đi tìm class có đánh dấu <code>@Configuration</code></li>
<li>Tạo ra đối tượng từ class có đánh dấu <code>@Configuration</code></li>
<li>tìm các method có đánh dấu <code>@Bean</code> trong đối tượng vừa tạo</li>
<li>Thực hiện gọi các method có đánh dấu <code>@Bean</code> để lấy ra các <em>Bean</em> và đưa vào `Context.</li>
</ol>
<p>Ngoài ra, về bản chất, <code>@Configuration</code> cũng là <code>@Component</code>. Nó chỉ khác ở ý nghĩa sử dụng. (Giống với việc class được đánh dấu <code>@Service</code> chỉ nên phục vụ logic vậy).</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Component</span><span class="w"> </span><span class="c1">// Nó được đánh dấu là Component</span>
<span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@AliasFor</span><span class="p">(</span>
<span class="w">        </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Component</span><span class="p">.</span><span class="na">class</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">value</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="co-y-nghia-gi">Có ý nghĩa gì?<a class="headerlink" href="#co-y-nghia-gi" title="Permanent link">&para;</a></h3>
<p>Nhiều bạn sẽ tự hỏi rằng <code>@Configuration</code> và <code>@Bean</code> sẽ có ý nghĩa gì khi chúng ta đã có <code>@Component</code>? Sao không đánh dấu <code>SimpleBean</code> là <code>@Component</code> cho nhanh?</p>
<p>Các bạn thắc mắc rất đúng, và việc sử dụng <code>@Component</code> cũng hoàn toàn ổn.</p>
<p>Thông thường thì các class được đánh dấu <code>@Component</code> đều có thể tạo tự động và inject tự động được.</p>
<p>Tuy nhiên trong thực tế, nếu một <code>Bean</code> có quá nhiều logic để khởi tạo và cấu hình, thì chúng ta sẽ sử dụng <code>@Configuration</code> và <code>@Bean</code> để tự tay tạo ra <code>Bean</code>. Việc tự tay tạo ra <code>Bean</code> như này có thể hiểu phần nào là chúng ta đang <em>config</em> cho chương trình.</p>
<h3 id="vi-du_1">Ví dụ<a class="headerlink" href="#vi-du_1" title="Permanent link">&para;</a></h3>
<p><a href="https://viblo.asia/p/spring-boot-6-atconfiguration-va-atbean-bJzKmyprK9N#_vi-du-5">Đọc trong trang bài viết</a></p>
<h3 id="bean-co-tham-so">@Bean có tham số<a class="headerlink" href="#bean-co-tham-so" title="Permanent link">&para;</a></h3>
<p>Nếu method được đánh dấu bởi <code>@Bean</code> có tham số truyền vào, thì Spring Boot sẽ tự inject các Bean đã có trong <code>Context</code> vào làm tham số.</p>
<p>Ví dụ:</p>
<p><em>AppConfig.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="n">SimpleBean</span><span class="w"> </span><span class="nf">simpleBeanConfigure</span><span class="p">(){</span>
<span class="w">        </span><span class="c1">// Khởi tạo một instance của SimpleBean và trả ra ngoài</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleBean</span><span class="p">(</span><span class="s">&quot;loda&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;mysqlConnector&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">DatabaseConnector</span><span class="w"> </span><span class="nf">mysqlConfigure</span><span class="p">(</span><span class="n">SimpleBean</span><span class="w"> </span><span class="n">simpleBean</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// SimpleBean được tự động inject vào.</span>
<span class="w">        </span><span class="n">DatabaseConnector</span><span class="w"> </span><span class="n">mySqlConnector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MySqlConnector</span><span class="p">();</span>
<span class="w">        </span><span class="n">mySqlConnector</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="s">&quot;jdbc:mysql://host1:33060/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">simpleBean</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// Set username, password, format, v.v...</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mySqlConnector</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="thuc-te">Thực tế<a class="headerlink" href="#thuc-te" title="Permanent link">&para;</a></h3>
<p>Trong thực tế, việc sử dụng <code>@Configuration</code> là hết sức cần thiết, và nó đóng vai trò là nơi cấu hình cho toàn bộ ứng dụng của bạn. Một Ứng dụng sẽ có nhiều class chứa <code>@Configuration</code> và mỗi class sẽ đảm nhận cấu hình một bộ phận gì đó trong ứng dụng.</p>
<h2 id="application-config-va-value">Application Config và @Value<a class="headerlink" href="#application-config-va-value" title="Permanent link">&para;</a></h2>
<p>Trong thực tế không phải lúc nào chúng ta cũng nên để mọi thứ trong code của mình. Có những thông số tốt hơn hết nên được truyền từ bên ngoài vào ứng dụng, để giúp ứng dụng của bạn dễ dàng thay đổi giữa các môi trường khác nhau. Để phục vụ điều này, chúng ta sẽ tìm hiểu về khái niệm config ứng dụng Spring Boot với <code>application.properties</code></p>
<h3 id="applicationproperties">application.properties<a class="headerlink" href="#applicationproperties" title="Permanent link">&para;</a></h3>
<p>Trong Spring Boot, các thông tin cấu hình mặc định được lấy từ file <code>resources/applications.properties</code>. Ví dụ, bạn muốn Spring Boot chạy trên port 8081 thay vì 8080 thì <code>server.port = 8081</code></p>
<p>Hoặc bạn muốn log của chương trình chi tiết hơn. Hãy chuyển nó sang dậng Debug bằng cách config như sau: <code>logging.level.root=DEBUG</code></p>
<h3 id="value">@Value<a class="headerlink" href="#value" title="Permanent link">&para;</a></h3>
<p>Trong trường hợp, bạn muốn tự config những giá trị của riêng mình, thì Spring Boot hỗ trợ bạn với annotation <code>@Value</code></p>
<p>Ví dụ, tôi muốn cấu hình cho thông tin database của tôi từ bên ngoài ứng dụng</p>
<p><em>application.properties</em></p>
<div class="highlight"><pre><span></span><code>loda.mysql.url=jdbc:mysql://host1:33060/loda
</code></pre></div>
<p><code>@Value</code> được sử dụng trên thuộc tính của class, Có nhiệm vụ lấy thông tin từ file properties và gán vào biến.</p>
<div class="highlight"><pre><span></span><code>public class AppConfig {
    // Lấy giá trị config từ file application.properties
    @Value(&quot;${loda.mysql.url}&quot;)
    String mysqlUrl;
}
</code></pre></div>
<p>Thông tin truyền vào annottaion <code>@Value</code> chính là tên của cấu hình đặt trong dấu <code>${name}</code></p>
<h3 id="vi-du-va-oc-them">Ví dụ và đọc thêm<a class="headerlink" href="#vi-du-va-oc-them" title="Permanent link">&para;</a></h3>
<p><a href="https://viblo.asia/p/spring-boot-7-spring-boot-application-config-va-atvalue-RQqKLwr657z#_vi-du-4">Phần ví dụ đầy đủ cho bài viết này</a></p>
<p>Sau bài này bạn có thể xem thêm nội dung sau:</p>
<ol>
<li><a href="https://www.baeldung.com/configuration-properties-in-spring-boot">Hướng dẫn sử dụng Spring Properties với <code>@ConfigurationProperties</code></a></li>
<li>Hướng dẫn sử dụng Spring Profiles# @Controller + Thymeleaf</li>
</ol>
<h3 id="controller"><strong>@Controller</strong><a class="headerlink" href="#controller" title="Permanent link">&para;</a></h3>
<p>Trong bài viết số 4, khi nói về <code>@Service</code> và <code>@Repository</code> tôi đã đề cập tới kiến trúc trong <strong>Spring Boot</strong>.</p>
<p>Để xây dựng một trang web với <strong>Spring Boot</strong>, bạn sẽ cần tuân theo quy trình như hình dưới đây:</p>
<p><img alt="" src="https://images.viblo.asia/95ff7fc2-b915-419a-bb14-38bfdf5bf250.png" /></p>
<p><code>@Controller</code> là nơi tiếp nhận các thông tin request từ phía người dùng. Nó có nhiệm vụ đón nhận các yêu cầu (kèm theo thông tin request) và chuyển các yêu cầu này xuống cho tầng <code>@Serivce</code> xử lý logic.</p>
<h3 id="html"><strong>HTML</strong><a class="headerlink" href="#html" title="Permanent link">&para;</a></h3>
<p>Để tạo ra một trang Web, bạn sẽ cần tạo ra các trang html để trả về cho người dùng. Mặc định trong <strong>Spring Boot</strong>, các file html này sẽ được lưu trữ trong thư mục <code>resources/templates</code>. <strong>Spring Boot + Thymeleaf</strong> sẽ tìm kiếm các file này theo tên. Ví dụ "index" sẽ tương ứng với "index.html".</p>
<h3 id="giai-thich-1">Giải thích 1<a class="headerlink" href="#giai-thich-1" title="Permanent link">&para;</a></h3>
<p>Bản thân <code>@Controller</code> Cũng là một <code>@Component</code> nên nó sẽ được <strong>Spring Boot</strong> quản lý.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@AliasFor</span><span class="p">(</span>
<span class="w">        </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Component</span><span class="p">.</span><span class="na">class</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">value</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Spring Boot</strong> sẽ lắng nghe các request từ phía người dùng. và tùy theo đường dẫn <code>path</code> là gì, nó sẽ mapping tới hàm xử lý tương ứng trong <code>@Controller</code>.</p>
<p>Như ví dụ trên, tôi sử dụng <code>GET</code> vào địa chỉ <code>localhost:8080/</code> ( đường dẫn là <code>/</code>). <strong>Spring Boot</strong> sẽ gọi tới hàm có gắn <code>@GetMapping("/")</code> và yêu cầu hàm này xử lý request này.</p>
<h3 id="giai-thich-2">Giải thích 2<a class="headerlink" href="#giai-thich-2" title="Permanent link">&para;</a></h3>
<p>Tới đây bạn hãy tham chiếu đường dẫn request với hàm xử lý nó:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// http://localhost:8080/hello?name=Loda</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">            </span><span class="c1">// Request param &quot;name&quot; sẽ được gán giá trị vào biến String</span>
<span class="w">            </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">            </span><span class="c1">// Model là một object của Spring Boot, được gắn vào trong mọi request.</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Gắn vào model giá trị name nhận được</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// trả về file hello.html cùng với thông tin trong object Model</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>Khi request lên, chúng ta nhận được giá trị của <code>name</code> và tiếp tục gán nó vào <code>Model</code>.</p>
<p><img alt="" src="https://images.viblo.asia/c1490e7d-3093-430e-b22e-32ab1395c199.png" /></p>
<p><code>Model</code> ở đây là một object được <strong>Spring Boot</strong> đính kém trong mỗi response. <code>Model</code> chứa các thông tin mà bạn muốn trả về và <strong>Template Engine</strong> sẽ trích xuất thông tin này ra thành html và đưa cho người dùng. Trong file <code>hello.html</code> tôi lấy giá trị của <code>name</code> trong <code>Model</code> ra bằng cách sử dụng cú pháp của <code>Thymeleaf</code></p>
<div class="highlight"><pre><span></span><code>&lt;h1 th:text=&quot;&#39;Hello, &#39; + ${name}&quot;&gt;&lt;/h1&gt;
</code></pre></div>
<h2 id="giai-thich-cach-thymeleaf-van-hanh-expression">Giải thích cách Thymeleaf vận hành + Expression<a class="headerlink" href="#giai-thich-cach-thymeleaf-van-hanh-expression" title="Permanent link">&para;</a></h2>
<h3 id="thymeleaf">Thymeleaf<a class="headerlink" href="#thymeleaf" title="Permanent link">&para;</a></h3>
<p>Thymeleaf là một Java Template Engine. Có nhiệm vụ xử lý và generate ra các file HTML, XML, v.v.. Các file HMTL do Thymeleaf tạo ra là nhờ kết hợp dữ liệu và template + quy tắc để sinh ra một file HTML chứa đầy đủ thông tin. Việc của bạn là cung cấp dữ liệu và quy định template như nào, còn việc dùng các thông tin đó để render ra HTML sẽ do Thymeleaf giải quyết.</p>
<h3 id="cu-phap">Cú pháp<a class="headerlink" href="#cu-phap" title="Permanent link">&para;</a></h3>
<p>Cú pháp của Thymeleaf sẽ là một attributes (Thuộc tính) của thẻ HTML và bắt đầu bằng chữ <code>th:</code>.</p>
<p>Ví dụ: Để truyền dữ liệu từ biến <code>name</code> trong Java vào một thẻ <code>H1</code> của HTML.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</code></pre></div>
<p>Chúng ta viết thẻ h1 như bình thường, nhưng không chứa bất cứ text nào trong thẻ. Mà sử dụng cú pháp <code>th:text="${name}"</code> để Thymeleaf lấy thông tin từ biến <code>name</code> và đưa vào thẻ <code>H1</code>.</p>
<p>Kết quả khi render ra, thuộc tính <code>th:text</code> biến mất và giá trị biến <code>name</code> được đưa vào trong thẻ <code>H1</code>. Đó là cách Thymeleaf hoạt động:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Giả sử String name = &quot;loda&quot;</span>
<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Loda</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</code></pre></div>
<h3 id="model-view-trong-spring-boot">Model &amp; View Trong Spring Boot<a class="headerlink" href="#model-view-trong-spring-boot" title="Permanent link">&para;</a></h3>
<p><code>Model</code> là đối tượng lưu giữ thông tin và được sử dụng bởi Template Engine để generate ra webpage. Có thể hiểu nó là <code>Context</code> của Thymeleaf. <code>Model</code> lưu giữ thông tin dưới dạng key-value.</p>
<p>Trong template thymeleaf, để lấy các thông tin trong <code>Model</code>. bạn sẽ sử dụng <code>Thymeleaf Standard Expression</code>.</p>
<ol>
<li><code>${...}</code>: Giá trị của một biến.</li>
<li><code>*{...}</code>: Giá trị của một biến được chỉ định.</li>
</ol>
<p>Ngoài ra, để lấy thông tin đặc biệt hơn:</p>
<ol>
<li><code>#{...}</code>: Lấy message</li>
<li><code>@{...}</code>: Lấy đường dẫn URL dựa theo context của server</li>
</ol>
<p>Nói tới đây có lẽ hơi khó hiểu, chúng ta sẽ dùng ví dụ để hiểu rõ từng loại Expression.</p>
<h3 id="-variables-expressions"><code>${...}</code> - Variables Expressions<a class="headerlink" href="#-variables-expressions" title="Permanent link">&para;</a></h3>
<p>Trên Controller bạn đưa vào một số giá trị:</p>
<div class="highlight"><pre><span></span><code>model.addAttribute(&quot;today&quot;, &quot;Monday&quot;);
</code></pre></div>
<p>Để lấy giá trị của biến <code>today</code>, tôi sử dụng <code>${...}</code></p>
<div class="highlight"><pre><span></span><code>&lt;p&gt;Today is: &lt;span th:text=&quot;${today}&quot;&gt;&lt;/span&gt;.&lt;/p&gt;
</code></pre></div>
<h3 id="-variables-expressions-on-selections"><code>*{...}</code> - Variables Expressions on selections<a class="headerlink" href="#-variables-expressions-on-selections" title="Permanent link">&para;</a></h3>
<p>Dấu <code>*</code> còn gọi là <code>asterisk syntax</code>. Chức năng của nó giống với <code>${...}</code> là lấy giá trị của một biến. Điểm khác biệt là nó sẽ lấy ra giá trị của một biến cho trước bởi <code>th:object</code></p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${session.user}&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- th:object tồn tại trong phạm vi của thẻ div này --&gt;</span>
    <span class="cm">&lt;!-- Lấy ra tên của đối tượng session.user --&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Name: <span class="p">&lt;</span><span class="nt">spanth:text</span><span class="err">=&quot;*{</span><span class="na">firstName</span><span class="err">}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span><span class="cm">&lt;!-- Lấy ra lastName của đối tượng session.user --&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Surname: <span class="p">&lt;</span><span class="nt">spanth:text</span><span class="err">=&quot;*{</span><span class="na">lastName</span><span class="err">}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>Vậy đoạn code ở trên tương đương với:</p>
<div class="highlight"><pre><span></span><code>&lt;div&gt;&lt;p&gt;Name: &lt;spanth:text=&quot;${session.user.firstName}&quot;&gt;&lt;/span&gt;.&lt;/p&gt;&lt;p&gt;Surname: &lt;spanth:text=&quot;${session.user.lastName}&quot;&gt;&lt;/span&gt;.&lt;/p&gt;&lt;/div&gt;
</code></pre></div>
<p>Còn <code>${...}</code> sẽ lấy ra giá trị cục bộ trong <code>Context</code> hay <code>Model</code>.</p>
<h3 id="-message-expression"><code>#{...}</code> - Message Expression<a class="headerlink" href="#-message-expression" title="Permanent link">&para;</a></h3>
<p>Ví dụ, trong file config <code>.properties</code> của tôi có một message chào người dùng bằng nhiều ngôn ngữ.</p>
<div class="highlight"><pre><span></span><code>home.welcome=¡Bienvenido a nuestra tienda de comestibles!
</code></pre></div>
<p>Thì cách lấy nó ra nhanh nhất là:</p>
<div class="highlight"><pre><span></span><code>&lt;p th:utext=&quot;#{home.welcome}&quot;&gt;Xin chào các bạn!&lt;/p&gt;
</code></pre></div>
<p>Đoạn text tiếng việt bên trong thẻ <code>p</code> sẽ bị thay thế bởi thymeleaf khi render <code>#{home.welcome}</code>.</p>
<h3 id="-url-expression"><code>@{...}</code> - URL Expression<a class="headerlink" href="#-url-expression" title="Permanent link">&para;</a></h3>
<p><code>@{...}</code> xử lý và trả ra giá trị URL theo context của máy chủ cho chúng ta.</p>
<p>Ví dụ:</p>
<div class="highlight"><pre><span></span><code>// &lt;a th:href=&quot;@{/order/list}&quot;&gt;
// If our app is installed at http://localhost:8080/myapp, this URL will output:
// &lt;a href=&quot;/myapp/order/list&quot;&gt;
&lt;a href=&quot;details.html&quot; th:href=&quot;@{/order/details(orderId=${o.id})}&quot;&gt;view&lt;/a&gt;
&lt;ahref=&quot;details.html&quot;th:href=&quot;@{/order/{orderId}/details(orderId=${o.id})}&quot;&gt;view&lt;/a&gt;
</code></pre></div>
<p>Nếu bắt dầu bằng dấu <code>/</code> thì nó sẽ là Relative URL và sẽ tương ứng theo context của máy chủ của bạn.# @RequestMapping + @PostMapping + @ModelAttribute + @RequestParam</p>
<h3 id="postmapping"><strong>@PostMapping</strong><a class="headerlink" href="#postmapping" title="Permanent link">&para;</a></h3>
<p><code>@PostMapping</code> có nhiệm vụ đánh dấu hàm xử lý POST request trong Controller.</p>
<p>Ví dụ:</p>
<p>Tôi có 2 hàm xử lý, một cho <code>GET</code> method và một cho <code>POST</code>.</p>
<p>Cả hai đều chung đường dẫn nhưng bạn nên biết rằng cùng một <code>path</code> nhưng khác <code>method</code> thì sẽ xử lý khác nhau.</p>
<div class="highlight"><pre><span></span><code>@Controller
public class WebController {
    @GetMapping(&quot;/addTodo&quot;)
    public String addTodo(Model model) {
        return &quot;addTodo&quot;;
    }

    @PostMapping(&quot;/addTodo&quot;)
    public String addTodo(Model model) {
        return &quot;success&quot;;
    }
}
</code></pre></div>
<h3 id="requestmapping"><strong>@RequestMapping</strong><a class="headerlink" href="#requestmapping" title="Permanent link">&para;</a></h3>
<p>Trong trường hợp bạn muốn tất cả các method đều dùng chung một cách xử lý thì có thể sử dụng Annotation <code>@RequestMapping</code>. @RequestMapping là một annotation có ý nghĩa và mục đích sử dụng rộng hơn các loại @GetMapping, @PostMapping,v.v.. Nếu không chỉ định method cho <code>@RequestMapping</code> thì nó sẽ nhận toàn bộ các method.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;api/v1&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Đường dẫn lúc này là: /api/v1/addTodo và method GET</span>
<span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/addTodo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addTodo</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;addTodo&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Đường dẫn lúc này là: /api/v1/addTodo và method POST</span>
<span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/addTodo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addTodo</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="getmapping">GetMapping<a class="headerlink" href="#getmapping" title="Permanent link">&para;</a></h3>
<p>Khi tôi request lên server như này <code>http://localhost:8080/listTodo?limit=2</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/listTodo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Trả về đối tượng todoList.</span>
<span class="w">    </span><span class="c1">// Nếu người dùng gửi lên param limit thì trả về sublist của todoList</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todoList&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">todoList</span><span class="p">.</span><span class="na">subList</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">todoList</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Trả về template &quot;listTodo.html&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;listTodo&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">```#</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">JPA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MySQL</span>

<span class="err">###</span><span class="w"> </span><span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">JPA</span><span class="o">**</span>

<span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">JPA</span><span class="o">**</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">phần</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">hệ</span><span class="w"> </span><span class="n">sinh</span><span class="w"> </span><span class="n">thái</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">nó</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="n">ở</span><span class="w"> </span><span class="n">giữa</span><span class="w"> </span><span class="n">tầng</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="n">giúp</span><span class="w"> </span><span class="n">chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">thao</span><span class="w"> </span><span class="n">tác</span><span class="w"> </span><span class="n">với</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">cách</span><span class="w"> </span><span class="n">dễ</span><span class="w"> </span><span class="n">dàng</span><span class="w"> </span><span class="n">hơn</span><span class="p">,</span><span class="w"> </span><span class="n">tự</span><span class="w"> </span><span class="n">động</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">giảm</span><span class="w"> </span><span class="n">thiểu</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">thừa</span><span class="w"> </span><span class="n">thãi</span><span class="p">.</span>

<span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">JPA</span><span class="o">**</span><span class="w"> </span><span class="n">đã</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">Hibernate</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">mạnh</span><span class="w"> </span><span class="n">mẽ</span><span class="p">.</span><span class="w"> </span><span class="n">Nếu</span><span class="w"> </span><span class="n">như</span><span class="w"> </span><span class="n">bạn</span><span class="w"> </span><span class="n">gặp</span><span class="w"> </span><span class="n">khó</span><span class="w"> </span><span class="n">khăn</span><span class="w"> </span><span class="n">khi</span><span class="w"> </span><span class="n">làm</span><span class="w"> </span><span class="n">việc</span><span class="w"> </span><span class="n">với</span><span class="w"> </span><span class="n">Hibernate</span><span class="w"> </span><span class="n">thì</span><span class="w"> </span><span class="n">đừng</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="w"> </span><span class="n">bạn</span><span class="w"> </span><span class="n">hãy</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">JPA</span><span class="o">**</span><span class="w"> </span><span class="n">làm</span><span class="w"> </span><span class="n">hộ</span><span class="p">.</span>

<span class="err">###</span><span class="w"> </span><span class="o">**</span><span class="n">Tạo</span><span class="w"> </span><span class="n">Table</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">dữ</span><span class="w"> </span><span class="n">liệu</span><span class="o">**</span>

<span class="n">Trước</span><span class="w"> </span><span class="n">khi</span><span class="w"> </span><span class="n">bắt</span><span class="w"> </span><span class="n">đầu</span><span class="p">,</span><span class="w"> </span><span class="n">chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">cần</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">dữ</span><span class="w"> </span><span class="n">liệu</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">Database</span><span class="p">.</span><span class="w"> </span><span class="n">Ở</span><span class="w"> </span><span class="n">đây</span><span class="w"> </span><span class="n">tôi</span><span class="w"> </span><span class="n">chọn</span><span class="w"> </span><span class="err">`</span><span class="n">MySQL</span><span class="err">`</span><span class="p">.</span><span class="w"> </span><span class="n">Dưới</span><span class="w"> </span><span class="n">đây</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">Script</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">DATABASE</span><span class="w"> </span><span class="err">`</span><span class="n">micro_db</span><span class="err">`</span><span class="p">.</span><span class="w"> </span><span class="n">Chứa</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="n">duy</span><span class="w"> </span><span class="n">nhất</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="err">`</span><span class="n">User</span><span class="err">`</span><span class="p">.</span>

<span class="err">###</span><span class="w"> </span><span class="o">**</span><span class="n">Tạo</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">User</span><span class="o">**</span>

<span class="n">Khi</span><span class="w"> </span><span class="n">đã</span><span class="w"> </span><span class="n">có</span><span class="w"> </span><span class="n">dữ</span><span class="w"> </span><span class="n">liệu</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">Database</span><span class="p">.</span><span class="w"> </span><span class="n">Chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">Java</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="n">thông</span><span class="w"> </span><span class="n">tin</span><span class="p">.</span><span class="w"> </span><span class="n">Cần</span><span class="w"> </span><span class="n">biết</span><span class="w"> </span><span class="n">thêm</span><span class="w"> </span><span class="n">về</span><span class="w"> </span><span class="n">Hibernate</span><span class="p">.</span><span class="w"> </span><span class="n">Đây</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">_User</span><span class="p">.</span><span class="na">java_</span><span class="p">:</span>

<span class="err">```</span><span class="n">java</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">)</span>
<span class="nd">@Data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">297553281792804396L</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Mapping thông tin biến với tên cột trong Database</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hp&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hp</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Nếu không đánh dấu @Column thì sẽ mapping tự động theo tên biến</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">atk</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="van-e-cua-hibernate-truyen-thong"><strong>Vấn đề của Hibernate truyền thống</strong><a class="headerlink" href="#van-e-cua-hibernate-truyen-thong" title="Permanent link">&para;</a></h3>
<p>Thông thường, khi bạn đã định nghĩa <code>Entity</code> tương ứng với <code>Table</code> trong DB thông qua Hibernate. Thì nhiệm vụ tiếp theo sẽ là tạo ra các class thao tác với DB.</p>
<p>Ví dụ muốn query lấy tất cả <code>User</code> bằng Hibernate truyền thống sẽ như sau. Nó sẽ rất dài nên khi nắm được vấn đề này, Spring Data đã wrapper lên Hibernate một lớp nữa gọi là Spring JPA.</p>
<h3 id="jparepository"><strong>JpaRepository</strong><a class="headerlink" href="#jparepository" title="Permanent link">&para;</a></h3>
<p>Để sử dụng <strong>Spring JPA</strong>, bạn cần sử dụng interface <code>JpaRepository</code>.</p>
<p>Yêu cầu của interface này đó là bạn phải cung cấp 2 thông tin:</p>
<ol>
<li>Entity (Đối tượng tương ứng với Table trong DB)</li>
<li>Kiểu dữ liệu của khóa chính (PrimaryKey)</li>
</ol>
<p>Ví dụ: Tôi muốn lấy thông tin của bảng <code>User</code> thì làm như sau:</p>
<div class="highlight"><pre><span></span><code>import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {

}
</code></pre></div>
<p>Vậy thôi, <code>@Repository</code> đánh dấu <code>UserRepository</code> là một Bean và chịu trách nhiệm giao tiếp với DB. <strong>Spring Boot</strong> sẽ tự tìm thấy và khởi tạo ra đối tượng <code>UserRepository</code> trong Context. Việc tạo ra <code>UserRepository</code> hoàn toàn tự động và tự config, vì chúng ta đã kế thừa <code>JpaRepository</code>. Bây giờ, việc lấy ra toàn bộ <code>User</code> sẽ như sau:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span>
<span class="n">UserRepository</span><span class="w"> </span><span class="n">userRepository</span><span class="p">;</span>

<span class="n">userRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span><span class="p">);</span>
</code></pre></div>
<p>Nếu bạn tìm kiếm thì sẽ thấy <code>UserRepository</code> có hàng chục method mà chúng ta không cần viết lại nữa. Vì nó kế thừa <code>JpaRepository</code> rồi.</p>
<h2 id="spring-jpa-method-query">Spring JPA Method + @Query<a class="headerlink" href="#spring-jpa-method-query" title="Permanent link">&para;</a></h2>
<h3 id="query-creation"><strong>Query Creation</strong><a class="headerlink" href="#query-creation" title="Permanent link">&para;</a></h3>
<p>Trong <strong>Spring JPA</strong>, có một cơ chế giúp chúng ta tạo ra các câu Query mà không cần viết thêm code. Cơ chế này xây dựng Query từ tên của method. Ví dụ: Chúng ta có đối tượng <code>User</code>.</p>
<p><em>User.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">)</span>
<span class="nd">@Data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">297553281792804396L</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Mapping thông tin biến với tên cột trong Database</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hp&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hp</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;stamina&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">stamina</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Nếu không đánh dấu @Column thì sẽ mapping tự động theo tên biến</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">atk</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">def</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">agi</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Khi chúng ta đặt tên method là: <code>findByAtk(int atk)</code>. Thì <strong>Spring JPA</strong> sẽ tự định nghĩa câu Query cho method này, bằng cách xử lý tên method. Vậy là chúng ta đã có thể truy vấn dữ liệu mà chỉ mất thêm 1 dòng code.</p>
<h3 id="quy-tac-at-ten-method-trong-spring-jpa"><strong>Quy tắc đặt tên method trong Spring JPA</strong><a class="headerlink" href="#quy-tac-at-ten-method-trong-spring-jpa" title="Permanent link">&para;</a></h3>
<p>Trong <strong>Spring JPA</strong>, cơ chế xây dựng truy vấn thông qua tên của method được quy định bởi các tiền tố sau:</p>
<p><code>find…By</code>, <code>read…By</code>, <code>query…By</code>, <code>count…By</code>, và <code>get…By</code>.</p>
<p>phần còn lại sẽ được parse theo tên của thuộc tính (viết hoa chữ cái đầu). Nếu chúng ta có nhiều điều kiện, thì các thuộc tính có thể kết hợp với nhau bằng chữ <code>And</code> hoặc <code>Or</code>. Bạn có thể đọc thêm <a href="https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html#jpa.query-methods.query-creation">trong Docs của Spring: Query Creation</a></p>
<p>Ví dụ:</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">PersonRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Dễ</span>
<span class="w">    </span><span class="c1">// version rút gọn</span>
<span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="nf">findByLastname</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// verson đầy đủ</span>
<span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="nf">findPersonByLastname</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="nf">findAllByLastname</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Trung bình</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByEmailAddressAndLastname</span><span class="p">(</span><span class="n">EmailAddress</span><span class="w"> </span><span class="n">emailAddress</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// findDistinct là tìm kiếm và loại bỏ đi các đối tượng trùng nhau</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findDistinctPeopleByLastnameOrFirstname</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstname</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findPeopleDistinctByLastnameOrFirstname</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// IgnoreCase là tìm kiếm không phân biệt hoa thường, ví dụ ở đây tìm kiếm lastname</span>
<span class="w">    </span><span class="c1">// lastname sẽ không phân biệt hoa thường</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByLastnameIgnoreCase</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// AllIgnoreCase là không phân biệt hoa thường cho tất cả thuộc tính</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByLastnameAndFirstnameAllIgnoreCase</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// OrderBy là cách sắp xếp thứ tự trả về</span>
<span class="w">    </span><span class="c1">// Sắp xếp theo Firstname ASC</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByLastnameOrderByFirstnameAsc</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Sắp xếp theo Firstname Desc</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByLastnameOrderByFirstnameDesc</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastname</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Các thuộc tính trong tên method phải thuộc về Class đó, nếu không sẽ gây ra lỗi. Tuy nhiên, trong một số trường hợp bạn có thể query bằng thuộc tính con. Ví dụ: Đói tượng <code>Person</code> có thuộc tính là <code>Address</code> và trong <code>Address</code> lại có <code>ZipCode</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// person.address.zipCode</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByAddressZipCode</span><span class="p">(</span><span class="n">ZipCode</span><span class="w"> </span><span class="n">zipCode</span><span class="p">);</span>
</code></pre></div>
<h3 id="query"><strong>@Query</strong><a class="headerlink" href="#query" title="Permanent link">&para;</a></h3>
<p>Với cách sử dụng <code>@Query</code>, bạn sẽ có thể sử dụng câu truy vấn <a href="https://en.wikipedia.org/wiki/Jakarta_Persistence_Query_Language">JPQL</a> (Hibernate) hoặc SQL thuần (raw SQL). Ví dụ:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Khi được gắn @Query, thì tên của method không còn tác dụng nữa</span>
<span class="w">    </span><span class="c1">// Đây là JPQL</span>
<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;select u from User u where u.emailAddress = ?1&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">myCustomQuery</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">emailAddress</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Đây là Native SQL</span>
<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;select * from User u where u.email_address = ?1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nativeQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">myCustomQuery2</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">emailAddress</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Cách truyền tham số là gọi theo thứ tự các tham số của method bên dưới <code>?1</code>, <code>?2</code>. Nếu bạn không thích sử dụng <code>?{number}</code> thì có thể đặt tên cho tham số.</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// JPQL</span>
<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT u FROM User u WHERE u.status = :status and u.name = :name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">findUserByNamedParams</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Native SQL</span>
<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM Users u WHERE u.status = :status and u.name = :name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nativeQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">findUserByNamedParamsNative</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="chi-tiet-spring-boot-thymeleaf-mysql-i18n">Chi tiết Spring Boot + Thymeleaf + MySQL + i18n<a class="headerlink" href="#chi-tiet-spring-boot-thymeleaf-mysql-i18n" title="Permanent link">&para;</a></h2>
<h3 id="tao-database">Tạo Database<a class="headerlink" href="#tao-database" title="Permanent link">&para;</a></h3>
<p><em>script.sql</em></p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">todo_db</span><span class="o">`</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">todo_db</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">todo</span><span class="o">`</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">title</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">detail</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span>
<span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span>
<span class="k">DEFAULT</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span>
</code></pre></div>
<p>Thêm 1 record vào DB</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">todo_db</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">todo</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">title</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">detail</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Làm bài tập&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Hoàn thiện bài viết Spring Boot #13&#39;</span><span class="p">);</span>
</code></pre></div>
<h3 id="cau-hinh-ung-dung">Cấu hình ứng dụng<a class="headerlink" href="#cau-hinh-ung-dung" title="Permanent link">&para;</a></h3>
<p>Cấu hình là phần cực kì quan trọng rồi, chúng ta phải cung cấp cho Spring Boot các thông tin về Database và Thymeleaf. Ngoài ra, tùy chỉnh một số thông tin để giúp chúng ta lập trình đơn giản hơn.
(Có thể đọc qua và tham khảo một số thông số có thể được sử dụng). Đây là <em>application.properties</em></p>
<div class="highlight"><pre><span></span><code><span class="c1">#Chạy ứng dụng trên port 8085</span>
<span class="l l-Scalar l-Scalar-Plain">server.port=8085</span>

<span class="l l-Scalar l-Scalar-Plain">## Bỏ tính năng cache của thymeleaf để lập trình cho nhanh</span>
<span class="l l-Scalar l-Scalar-Plain">spring.thymeleaf.cache=false</span>

<span class="l l-Scalar l-Scalar-Plain">## Các message tĩnh sẽ được lưu tại thư mục i18n</span>
<span class="l l-Scalar l-Scalar-Plain">spring.messages.basename=i18n/messages</span>

<span class="l l-Scalar l-Scalar-Plain">## Bỏ properties này đi khi deploy</span>

<span class="l l-Scalar l-Scalar-Plain">## Nó có tác dụng cố định ngôn ngữ hiện tại chỉ là Tiếng Việt</span>
<span class="l l-Scalar l-Scalar-Plain">spring.mvc.locale-resolver=fixed</span>

<span class="l l-Scalar l-Scalar-Plain">## Mặc định ngôn ngữ là tiếng việt</span>
<span class="l l-Scalar l-Scalar-Plain">spring.mvc.locale=vi_VN</span>

<span class="l l-Scalar l-Scalar-Plain">## Đổi thành tiếng anh bằng cách bỏ comment ở dứoi</span>
<span class="l l-Scalar l-Scalar-Plain">#spring.mvc.locale=en_US</span>
<span class="l l-Scalar l-Scalar-Plain">spring.datasource.url=jdbc:mysql://localhost:3306/todo_db?useSSL=false</span>
<span class="l l-Scalar l-Scalar-Plain">spring.datasource.username=root</span>
<span class="l l-Scalar l-Scalar-Plain">spring.datasource.password=root</span>
<span class="l l-Scalar l-Scalar-Plain">## Hibernate Properties</span>

<span class="l l-Scalar l-Scalar-Plain">## The SQL dialect makes Hibernate generate better SQL for the chosen database</span>
<span class="l l-Scalar l-Scalar-Plain">spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL5InnoDBDialect</span>

<span class="l l-Scalar l-Scalar-Plain">## Hibernate ddl auto (create, create-drop, validate, update)</span>
<span class="l l-Scalar l-Scalar-Plain">spring.jpa.hibernate.ddl-auto = update</span>
</code></pre></div>
<h3 id="tao-model">Tạo Model<a class="headerlink" href="#tao-model" title="Permanent link">&para;</a></h3>
<p>Tạo model <code>Todo</code> liên kết tới bảng <code>todo</code> trong Database.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Id</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Todo</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>
</code></pre></div>
<p>Ngoài ra, chúng ta tạo thêm một đối tượng là <code>TodoValidator</code>, có trách nhiệm kiểm tra xem một object <code>Todo</code> là hợp lệ hay không.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.util.StringUtils</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">Đối tượng này dùng để kiểm tra xem một Object Todo có hợp lệ không</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoValidator</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="o">/</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Kiểm</span><span class="w"> </span><span class="n">tra</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">có</span><span class="w"> </span><span class="n">hợp</span><span class="w"> </span><span class="n">lệ</span><span class="w"> </span><span class="n">không</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="nd">@param</span><span class="w"> </span><span class="n">todo</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="nd">@return</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isValid</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span>
<span class="w">                       </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">getTitle</span><span class="p">()))</span><span class="w"> </span><span class="c1">// Kiểm tra title khác rỗng</span>
<span class="w">                       </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">getDetail</span><span class="p">()))</span><span class="w"> </span><span class="c1">// Kiểm tra detail khác rỗng</span>
<span class="w">                       </span><span class="p">.</span><span class="na">isPresent</span><span class="p">();</span><span class="w"> </span><span class="c1">// Trả về true nếu hợp lệ, ngược lại false</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Vậy là xong phần chuẩn bị <code>Model</code>.</p>
<h3 id="todoconfig">TodoConfig<a class="headerlink" href="#todoconfig" title="Permanent link">&para;</a></h3>
<p>Trong ứng dụng của mình, tôi muốn tự tạo ra Bean <code>TodoValidator</code>. Đây là lúc sử dụng <code>@Configuration</code> và <code>@Bean</code> đã học tại bài Spring Boot #6</p>
<p><em>config/TodoConfig.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">/</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Tạo</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">Bean</span><span class="w"> </span><span class="n">TodoValidator</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">sử</span><span class="w"> </span><span class="n">dụng</span><span class="w"> </span><span class="n">sau</span><span class="w"> </span><span class="n">này</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="nd">@return</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoValidator</span><span class="w"> </span><span class="nf">validator</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoValidator</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="tang-repository">Tầng Repository<a class="headerlink" href="#tang-repository" title="Permanent link">&para;</a></h3>
<p>Tầng Repository, chịu trách nhiệm giao tiếp với Database. Chúng ta sử dụng Spring JPA. <em>repository/TodoRepository.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Todo</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="tang-service">Tầng Service<a class="headerlink" href="#tang-service" title="Permanent link">&para;</a></h3>
<p>Tầng Service, chị trách nhiệm thực hiện các xử lý logic, business, hỗ trợ cho tầng Controller. <em>service/TodoService.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TodoRepository</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TodoValidator</span><span class="w"> </span><span class="n">validator</span><span class="p">;</span>

<span class="w">    </span><span class="o">/</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Lấy</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">danh</span><span class="w"> </span><span class="n">sách</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span>
<span class="w">     </span><span class="o">*</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="nd">@param</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Giới</span><span class="w"> </span><span class="n">hạn</span><span class="w"> </span><span class="n">số</span><span class="w"> </span><span class="n">lượng</span><span class="w"> </span><span class="n">lấy</span><span class="w"> </span><span class="n">ra</span>
<span class="w">     </span><span class="o">*</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="nd">@return</span><span class="w"> </span><span class="n">Trả</span><span class="w"> </span><span class="n">về</span><span class="w"> </span><span class="n">danh</span><span class="w"> </span><span class="n">sách</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dựa</span><span class="w"> </span><span class="n">theo</span><span class="w"> </span><span class="n">limit</span><span class="p">,</span><span class="w"> </span><span class="n">nếu</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="n">thì</span><span class="w"> </span><span class="n">trả</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
<span class="w">                       </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)).</span><span class="na">getContent</span><span class="p">())</span>
<span class="w">                       </span><span class="p">.</span><span class="na">orElseGet</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Thêm</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">mới</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">danh</span><span class="w"> </span><span class="n">sách</span><span class="w"> </span><span class="n">công</span><span class="w"> </span><span class="n">việc</span><span class="w"> </span><span class="n">cần</span><span class="w"> </span><span class="n">làm</span>
<span class="w">     </span><span class="o">*</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="nd">@return</span><span class="w"> </span><span class="n">Trả</span><span class="w"> </span><span class="n">về</span><span class="w"> </span><span class="n">đối</span><span class="w"> </span><span class="n">tượng</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">sau</span><span class="w"> </span><span class="n">khi</span><span class="w"> </span><span class="n">lưu</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">DB</span><span class="p">,</span><span class="w"> </span><span class="n">trả</span><span class="w"> </span><span class="n">về</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="n">nếu</span><span class="w"> </span><span class="n">không</span><span class="w"> </span><span class="n">thành</span><span class="w"> </span><span class="n">công</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validator</span><span class="p">.</span><span class="na">isValid</span><span class="p">(</span><span class="n">todo</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="tang-controller">Tầng Controller<a class="headerlink" href="#tang-controller" title="Permanent link">&para;</a></h3>
<p>Tầng Controller, nơi đón nhận các request từ phía người dùng, và chuyển tiếp xử lý xuống tầng Service.</p>
<p><em>controller/TodoController.java</em></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    @RequestParam dùng để đánh dấu một biến là request param trong request gửi lên server.</span>
<span class="cm">    Nó sẽ gán dữ liệu của param-name tương ứng vào biến</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/listTodo&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Trả về đối tượng todoList.</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todoList&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">limit</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// Trả về template &quot;listTodo.html&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;listTodo&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/addTodo&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addTodo</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Todo</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;addTodo&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    @ModelAttribute đánh dấu đối tượng Todo được gửi lên bởi Form Request</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/addTodo&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addTodo</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">todoService</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">todo</span><span class="p">))</span>
<span class="w">                       </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Trả về success nếu save thành công</span>
<span class="w">                       </span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="s">&quot;failed&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Trả về failed nếu không thành công</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="templates">Templates<a class="headerlink" href="#templates" title="Permanent link">&para;</a></h3>
<p>Tầng Controller đã trả về templates, nhiệm vụ tiếp theo là sử dụng Template Engine để xử lý các templates này và trả về webpage cho người dùng.</p>
<h3 id="i18n">i18n<a class="headerlink" href="#i18n" title="Permanent link">&para;</a></h3>
<p>Trong các template, tôi có sử dụng các message tĩnh, những message này hỗ trợ đa ngôn ngữ. Chúng ta định nghĩa các message này tại thư mục <code>i18n</code>.</p>
<p><em>i18n/messages_vi.properties</em></p>
<div class="highlight"><pre><span></span><code>loda.message.hello=Welcome to TodoApp
loda.message.success=Thêm Todo thành công!
loda.message.failed=Thêm Todo không thành công!

loda.value.addTodo=Thêm công việc
loda.value.viewListTodo=Xem danh sách công việc
loda.value.listTodo=Danh sách công việc
</code></pre></div>
<p><em>i18n/messages_en.properties</em></p>
<p><div class="highlight"><pre><span></span><code>loda.message.hello=Welcome to TodoApp
loda.message.success=Add To-do Successfully!
loda.message.failed=Add To-do Failed!

loda.value.addTodo=Add To-do
loda.value.viewListTodo=View To-do list
loda.value.listTodo=To-do list
```# Restful API + @RestController + @PathVariable + @RequestBody

### Restful API

Bạn có thể đọc [dwyl/learn-api-design](https://github.com/dwyl/learn-api-design)

### @RestController

Khác với `@Controller` là sẽ trả về một template.

`@RestController` trả về dữ liệu dưới dạng JSON.
</code></pre></div>
@RestController
@RequestMapping("/api/v1")
public class RestApiController{</p>
<pre><code>@GetMapping("/todo")
public List&lt;Todo&gt; getTodoList() {
    return todoList;
}
</code></pre>
<p>}
<code>``

Các đối tượng trả về dưới dạng Object sẽ được Spring Boot chuyển thành JSON. Các đối tượng trả về rất đa dạng, bạn có thể trả về</code>List<code>,</code>Map<code>, v.v.. Spring Boot sẽ convert hết chúng thành JSON, mặc định sẽ dùng Jackson converter để làm điều đó. Nếu bạn muốn API tùy biến được kiểu dữ liệu trả về, bạn có thể trả về đối tượng</code>ResponseEntity` của Spring cung cấp. Đây là đối tượng cha của mọi response và sẽ wrapper các object trả về. Cái này bạn xem tiếp phần dưới sẽ rõ.
</p>
<h3 id="requestbody">@RequestBody<a class="headerlink" href="#requestbody" title="Permanent link">&para;</a></h3>
<p>Vì bây giờ chúng ta xây dựng API, nên các thông tin từ phía Client gửi lên Server sẽ nằm trong <code>Body</code>, và cũng dưới dạng <code>JSON</code> luôn.

<code>java
@RestController
@RequestMapping("/api/v1")
public class RestApiController {

    List&lt;Todo&gt; todoList = new CopyOnWriteArrayList&lt;&gt;();

    @PostMapping("/todo")
    public ResponseEntity addTodo(@RequestBody Todo todo) {
        todoList.add(todo);
        // Trả về response với STATUS CODE = 200 (OK)
        // Body sẽ chứa thông tin về đối tượng todo vừa được tạo.
        return ResponseEntity.ok().body(todo);
    }
}</code></p>
<p>Tất nhiên là Spring Boot sẽ làm giúp chúng ta các phần nặng nhọc, nó chuyển chuỗi JSON trong request thành một Object Java. bạn chỉ cần cho nó biết cần chuyển JSON thành Object nào bằng Annotation <code>@RequestBody</code></p>
<h3 id="pathvariable">@PathVariable<a class="headerlink" href="#pathvariable" title="Permanent link">&para;</a></h3>
<p><code>RESTful API</code> là một tiêu chuẩn dùng trong việc thết kế các thiết kế API cho các ứng dụng web để quản lý các resource.</p>
<p>Và với cách thống nhất này, thì sẽ có một phần thông tin quan trọng sẽ nằm ngay trong chính URL của api.</p>
<p>Ví dụ:</p>
<ol>
<li>URL tạo To-do: https://loda.me/todo. Tương ứng với HTTP method là POST</li>
<li>URL lấy thông tin To-do số 12: https://loda.me/todo/12. Tương ứng với HTTP method là GET</li>
<li>URL sửa thông tin To-do số 12: https://loda.me/todo/12. Tương ứng với HTTP method là PUT</li>
<li>URL xoá To-do số 12: https://loda.me/todo/12. Tương ứng với HTTP method là DELETE</li>
</ol>
<p>Ngoài thông tin trong <code>Body</code> của request, thì cái chúng ta cần chính là cái con số 12 nằm trong URL. Phải lấy được con số đó thì mới biết được đối tượng To-do cần thao tác là gì.</p>
<p><code>@PathVariable</code> tham chiến.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/v1&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RestApiController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    phần path URL bạn muốn lấy thông tin sẽ để trong ngoặc kép {}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/todo/{todoId}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">getTodo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todoId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">todoId</span><span class="p">){</span>
<span class="w">        </span><span class="c1">// @PathVariable lấy ra thông tin trong URL</span>
<span class="w">        </span><span class="c1">// dựa vào tên của thuộc tính đã định nghĩa trong ngoặc kép /todo/{todoId}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="err">```#</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">Handling</span><span class="w"> </span><span class="nd">@ExceptionHandler</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nd">@RestControllerAdvice</span><span class="o">/</span><span class="nd">@ControllerAdvice</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nd">@ResponseStatus</span>

<span class="err">###</span><span class="w"> </span><span class="nd">@RestControllerAdvice</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nd">@ControllerAdvice</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nd">@ExceptionHandler</span>

<span class="err">`</span><span class="nd">@RestControllerAdvice</span><span class="err">`</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">một</span><span class="w"> </span><span class="n">Annotation</span><span class="w"> </span><span class="n">gắn</span><span class="w"> </span><span class="n">trên</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="w"> </span><span class="n">Có</span><span class="w"> </span><span class="n">tác</span><span class="w"> </span><span class="n">dụng</span><span class="w"> </span><span class="n">xen</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">quá</span><span class="w"> </span><span class="n">trình</span><span class="w"> </span><span class="n">xử</span><span class="w"> </span><span class="n">lý</span><span class="w"> </span><span class="n">của</span><span class="w"> </span><span class="n">các</span><span class="w"> </span><span class="err">`</span><span class="nd">@RestController</span><span class="err">`</span><span class="p">.</span><span class="w"> </span><span class="n">Tương</span><span class="w"> </span><span class="n">tự</span><span class="w"> </span><span class="n">với</span><span class="w"> </span><span class="err">`</span><span class="nd">@ControllerAdvice</span><span class="err">`</span><span class="p">.</span><span class="w"> </span><span class="err">`</span><span class="nd">@RestControllerAdvice</span><span class="err">`</span><span class="w"> </span><span class="n">thường</span><span class="w"> </span><span class="n">được</span><span class="w"> </span><span class="n">kết</span><span class="w"> </span><span class="n">hợp</span><span class="w"> </span><span class="n">với</span><span class="w"> </span><span class="err">`</span><span class="nd">@ExceptionHandler</span><span class="err">`</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">cắt</span><span class="w"> </span><span class="n">ngang</span><span class="w"> </span><span class="n">quá</span><span class="w"> </span><span class="n">trình</span><span class="w"> </span><span class="n">xử</span><span class="w"> </span><span class="n">lý</span><span class="w"> </span><span class="n">của</span><span class="w"> </span><span class="n">Controller</span><span class="p">,</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">xử</span><span class="w"> </span><span class="n">lý</span><span class="w"> </span><span class="n">các</span><span class="w"> </span><span class="n">ngoại</span><span class="w"> </span><span class="n">lệ</span><span class="w"> </span><span class="n">xảy</span><span class="w"> </span><span class="n">ra</span><span class="p">.</span>

<span class="err">```</span><span class="n">java</span>
<span class="nd">@RestControllerAdvice</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApiExceptionHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">IndexOutOfBoundsException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="nf">TodoException</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span><span class="w">  </span><span class="n">WebRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ErrorMessage</span><span class="p">(</span><span class="mi">10100</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Đối tượng không tồn tại&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Hiểu đơn giản là Controller đang hoạt động bình thường, chẳng may có một Exception được ném ra, thì thay vì báo lỗi hệ thống, thì nó sẽ được thằng <code>@RestControllerAdvice</code> và <code>@ExceptionHandler</code> đón lấy và xử lý. Sau đó trả về cho người dùng thông tin hữu ích hơn.</p>
<h3 id="responsestatus">@ResponseStatus<a class="headerlink" href="#responsestatus" title="Permanent link">&para;</a></h3>
<p><code>@ResponseStatus</code> là một cách định nghĩa HttpStatus trả về cho người dùng. Nếu bạn không muốn sử dụng <code>ResponseEntity</code> thì có thể dùng <code>@ResponseStatus</code> đánh dấu trên <code>Object</code> trả về.</p>
<h2 id="huong-dan-su-dung-configurationproperties">Hướng dẫn sử dụng @ConfigurationProperties<a class="headerlink" href="#huong-dan-su-dung-configurationproperties" title="Permanent link">&para;</a></h2>
<h3 id="cau-hinh-on-gian"><strong>Cấu hình đơn giản</strong><a class="headerlink" href="#cau-hinh-on-gian" title="Permanent link">&para;</a></h3>
<p>Giả sử, ứng dụng của tôi sẽ yêu cầu có một số giá trị toàn cục, mà thay vì cấu hình ở trong code, tôi muốn lưu nó ở bên ngoài, để tiện thay đổi mỗi khi cần.</p>
<p>Thì tôi sẽ làm như sau, tạo ra một class chứa các thông tin:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Data</span><span class="w"> </span><span class="c1">// Lombok (Tạo Getter, Setter các thứ)</span>
<span class="nd">@Component</span><span class="w"> </span><span class="c1">// Là 1 Spring Bean</span>
<span class="c1">// Đánh dấu để lấy config từ trong file loda.yml</span>
<span class="c1">// @PropertySource(&quot;classpath:loda.yml&quot;)</span>
<span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;loda&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Chỉ lấy các config có tiền tố là &quot;loda&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LodaAppProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">googleAnalyticsId</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// standard getters and setters</span>
<span class="p">}</span>
</code></pre></div>
<p>Sử dụng <code>@PropertySource</code> để định nghĩa tên của file config. Nếu không có annotation này, Spring sẽ sử dụng file mặc định (<em>classpath:application.yml</em> trong thư mục <em>resources</em>)</p>
<p>Cuối cùng là <code>@ConfigurationProperties</code>, Annotation này đánh dấu class bên dưới nó là properties, các thuộc tính sẽ được tự động nạp vào khi Spring khởi tạo. Lưu ý: các thuộc tính này được xác định bởi <code>prefix=loda</code>. Cái này bạn xem file <em>application.yml</em> ở dưới sẽ hiểu.</p>
<p>Spring sẽ tự tìm các hàm setter để set giá trị cho các thuộc tính này, nên quan trọng là bạn phải tạo ra các setter method. (Ở đây tôi nhường việc đó cho lombok).</p>
<p>Ngoài ra, để chạy được tính năng này, bạn cần kích hoạt nó bằng cách gắn <code>@EnableConfigurationProperties</code> lên một Configuration nào đó. Ở đây tôi gắn lên hàm main luôn.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableConfigurationProperties</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Bây giờ, Spring sẽ tự động bind toàn bộ giá trị từ trong file application.yml vào bean LodaAppProperties cho chúng ta. Tạo ra file <em>application.yml</em> tại thư mục resources. Thêm các thông tin chúng ta cần. Chúng ta phải đặt các thuộc tính này sau prefix <em>loda</em>:</p>
<div class="highlight"><pre><span></span><code>loda:
  email: loda.namnh@gmail.com
  googleAnalyticsId: U-xxxxx
</code></pre></div>
<h3 id="chay-thu"><strong>Chạy thử</strong><a class="headerlink" href="#chay-thu" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableConfigurationProperties</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CommandLineRunner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span><span class="w"> </span><span class="n">LodaAppProperties</span><span class="w"> </span><span class="n">lodaAppProperties</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">String</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Global variable:&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t Email: &quot;</span><span class="o">+</span><span class="n">lodaAppProperties</span><span class="p">.</span><span class="na">getEmail</span><span class="p">());</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t GA ID: &quot;</span><span class="o">+</span><span class="n">lodaAppProperties</span><span class="p">.</span><span class="na">getGoogleAnalyticsId</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Kết quả:</p>
<div class="highlight"><pre><span></span><code>Global variable:
     Email: loda.namnh@gmail.com
     GA ID: U-xxxxx
</code></pre></div>
<p>Bây giờ, ở bất kỳ đâu trong chương trình, khi cần lấy các thông tin config, tôi chỉ cần:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span><span class="w"> </span><span class="n">LodaAppProperties</span><span class="w"> </span><span class="n">lodaAppProperties</span><span class="p">;</span>
</code></pre></div>
<h3 id="nested-properties"><strong>Nested Properties</strong><a class="headerlink" href="#nested-properties" title="Permanent link">&para;</a></h3>
<p>Chúng ta có thể config các thuộc tính bên trong Class kể cả khi nó là <code>Lists</code>, <code>Maps</code> hay một class khác.</p>
<p>Bổ sung thêm thuộc tính:</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;loda&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Chỉ lấy các config có tiền tố là &quot;loda&quot;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LodaAppProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">authors</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exampleMap</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Sửa file <em>application.yml</em>:</p>
<div class="highlight"><pre><span></span><code>loda:
  email: loda.namnh@gmail.com
  googleAnalyticsId: U-xxxxx
  authors:
    - loda
    - atom
  exampleMap:
    key1: hello
    key2: world
</code></pre></div>
<p>Chạy lại chương trình:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">String</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Global variable:&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t Email: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lodaAppProperties</span><span class="p">.</span><span class="na">getEmail</span><span class="p">());</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t GA ID: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lodaAppProperties</span><span class="p">.</span><span class="na">getGoogleAnalyticsId</span><span class="p">());</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t Authors: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lodaAppProperties</span><span class="p">.</span><span class="na">getAuthors</span><span class="p">());</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t Example Map: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lodaAppProperties</span><span class="p">.</span><span class="na">getExampleMap</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>Kết quả:</p>
<div class="highlight"><pre><span></span><code>Global variable:
     Email: loda.namnh@gmail.com
     GA ID: U-xxxxx
     Authors: [loda, atom]
     Example Map: {key1=hello, key2=world}
```# Chạy nhiều môi trường với Spring Profile

### 1. Tạo file config

`Spring Profiles` có sẵn trong Framework rồi nên bạn không cần thêm bất kì thư viện nào khác. Để sử dụng, các bạn tạo file config tại thư mục `resources` trong project. Mặc định Spring sẽ nhận các file có tên như sau:

```yaml
application.properties
application.yml
application-{profile-name}.yml // .properties
</code></pre></div>
<p>ví dụ mình có 2 môi trường là <code>local</code> và <code>aws</code>, thì mình sẽ tạo ra các file như thế này:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">application.yml</span>
<span class="l l-Scalar l-Scalar-Plain">application-local.yml</span>
<span class="l l-Scalar l-Scalar-Plain">application-aws.yml</span>
<span class="l l-Scalar l-Scalar-Plain">application-common.yml</span>
</code></pre></div>
<ul>
<li><code>application</code> là file config chính khai báo các enviroment.</li>
<li><code>application-local</code> chỉ sử dụng khi chạy chương trình ở local</li>
<li><code>application-aws</code> chỉ sử dụng khi chạy ở AWS</li>
<li><code>application-common</code> là những config dùng chung, môi trường nào cũng cần.</li>
</ul>
<p>Bây giờ, mình sẽ khai báo trong từng file như sau (Xóa bớt nội dung từng tệp rùi cho ngắn gọn):</p>
<p><em>application.yml</em></p>
<div class="highlight"><pre><span></span><code>#application.yml
---
spring.profiles: local
spring.profiles.include: common, local
---
spring.profiles: aws
spring.profiles.include: common, aws
---
</code></pre></div>
<p><em>application-aws.yml</em></p>
<div class="highlight"><pre><span></span><code>spring:
  datasource:
    username: xxx
    password: xxx
</code></pre></div>
<p><em>application-local.yml</em></p>
<div class="highlight"><pre><span></span><code>spring:
  datasource:
    username: root
    password:
    url: jdbc:mysql://localhost:3306/news?useSSL=false&amp;characterEncoding=UTF-8
</code></pre></div>
<p><em>application-common.yml</em></p>
<div class="highlight"><pre><span></span><code>spring:
  jpa:
    properties:
</code></pre></div>
<p>Tadaa, xong, mình giải thích chút. bạn để ý trong file <code>application.yml</code> mình có khai báo 2 môi trường là <code>local</code> và <code>aws</code>. Tại mỗi môi trường sẽ <code>include</code> (bao gồm) các file config như kia. Khi mình kích hoạt <code>aws</code> chẳng hạn, <em>Spring</em> sẽ load tất cả config có trong <code>application-common.yml</code> và <code>application-aws.yml</code>.</p>
<h3 id="2-kich-hoat-config">2. Kích hoạt config<a class="headerlink" href="#2-kich-hoat-config" title="Permanent link">&para;</a></h3>
<p>Để sử dụng một <code>Profiles</code> bạn có các cách sau:</p>
<h4 id="su-dung-springprofilesactive-trong-file-applicationproperties-hoac-applicationyml">Sử dụng <code>spring.profiles.active</code> trong file <code>application.properties</code> hoặc <code>application.yml</code><a class="headerlink" href="#su-dung-springprofilesactive-trong-file-applicationproperties-hoac-applicationyml" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>spring.profiles.active=aws
</code></pre></div>
<h4 id="3-su-dung-jvm-system-parameter-nen-dung">3: Sử dụng JVM System Parameter (nên dùng)<a class="headerlink" href="#3-su-dung-jvm-system-parameter-nen-dung" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>-Dspring.profiles.active=aws
</code></pre></div>
<h4 id="4-environment-variable-unix-nen-dung">4: Environment Variable (Unix) (nên dùng)<a class="headerlink" href="#4-environment-variable-unix-nen-dung" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>export SPRING_PROFILES_ACTIVE=aws
</code></pre></div>
<h3 id="3-cach-su-dung-profile">3. Cách sử dụng @Profile<a class="headerlink" href="#3-cach-su-dung-profile" title="Permanent link">&para;</a></h3>
<p>Khi đã có <code>Profile</code> rồi, ngoài các biến toàn cục được thay đổi theo môi trường, bạn cũng có thể toàn quyền quyết định xem trong code rằng <code>Bean</code> hay <code>Class</code> nào sẽ được quyền chạy ở môi trường nào. Bằng cách sử dụng annotation <code>@Profile</code></p>
<p><div class="highlight"><pre><span></span><code><span class="c1">// Bean này Spring chỉ khởi tạo và quản lý khi môi trường là `local`</span>
<span class="nd">@Component</span>
<span class="nd">@Profile</span><span class="p">(</span><span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LocalDatasourceConfig</span><span class="w"> </span><span class="p">{}</span>
<span class="c1">// Ngoài ra bạn có thể sử dụng toàn tử logic ở đây, ví dụ:</span>
<span class="nd">@Component</span>
<span class="nd">@Profile</span><span class="p">(</span><span class="s">&quot;!local&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LocalDatasourceConfig</span><span class="w"> </span><span class="p">{}</span>
<span class="err">```#</span><span class="w"> </span><span class="n">Hướng</span><span class="w"> </span><span class="n">dẫn</span><span class="w"> </span><span class="n">chi</span><span class="w"> </span><span class="n">tiết</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span>

<span class="n">Hôm</span><span class="w"> </span><span class="n">nay</span><span class="w"> </span><span class="n">chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">tìm</span><span class="w"> </span><span class="n">hiểu</span><span class="w"> </span><span class="n">cách</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">viết</span><span class="w"> </span><span class="n">TestCase</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="o">**</span><span class="p">.</span><span class="w"> </span><span class="n">Yêu</span><span class="w"> </span><span class="n">cầu</span><span class="w"> </span><span class="n">tối</span><span class="w"> </span><span class="n">thiếu</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">đi</span><span class="w"> </span><span class="n">tiếp</span><span class="w"> </span><span class="n">phần</span><span class="w"> </span><span class="n">này</span><span class="w"> </span><span class="n">đó</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">bạn</span><span class="w"> </span><span class="n">phải</span><span class="w"> </span><span class="n">có</span><span class="w"> </span><span class="n">nền</span><span class="w"> </span><span class="n">tảng</span><span class="w"> </span><span class="n">với</span><span class="w"> </span><span class="err">`</span><span class="n">JUnit</span><span class="err">`</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="err">`</span><span class="n">Mockito</span><span class="err">`</span><span class="p">.</span>

<span class="err">###</span><span class="w"> </span><span class="o">**</span><span class="n">Vấn</span><span class="w"> </span><span class="n">đề</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Spring</span><span class="o">**</span>

<span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="o">**</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">phải</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">tìm</span><span class="w"> </span><span class="n">kiếm</span><span class="w"> </span><span class="n">các</span><span class="w"> </span><span class="n">Bean</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">nhét</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">đó</span><span class="p">.</span><span class="w"> </span><span class="n">Sau</span><span class="w"> </span><span class="n">tất</span><span class="w"> </span><span class="n">cả</span><span class="w"> </span><span class="n">các</span><span class="w"> </span><span class="n">bước</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">khởi</span><span class="w"> </span><span class="n">tạo</span><span class="w"> </span><span class="n">thì</span><span class="w"> </span><span class="n">chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">sử</span><span class="w"> </span><span class="n">dụng</span><span class="w"> </span><span class="err">`</span><span class="nd">@Autowired</span><span class="err">`</span><span class="w"> </span><span class="n">để</span><span class="w"> </span><span class="n">lấy</span><span class="w"> </span><span class="n">đối</span><span class="w"> </span><span class="n">tượng</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">sử</span><span class="w"> </span><span class="n">dụng</span><span class="p">.</span><span class="w"> </span><span class="n">Vấn</span><span class="w"> </span><span class="n">đề</span><span class="w"> </span><span class="n">đầu</span><span class="w"> </span><span class="n">tiên</span><span class="w"> </span><span class="n">bạn</span><span class="w"> </span><span class="n">nghĩ</span><span class="w"> </span><span class="n">tới</span><span class="w"> </span><span class="n">khi</span><span class="w"> </span><span class="n">viết</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">làm</span><span class="w"> </span><span class="n">sao</span><span class="w"> </span><span class="err">`</span><span class="nd">@Autowired</span><span class="err">`</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="n">được</span><span class="w"> </span><span class="n">và</span><span class="w"> </span><span class="n">làm</span><span class="w"> </span><span class="n">sao</span><span class="w"> </span><span class="n">cho</span><span class="w"> </span><span class="err">`</span><span class="n">JUnit</span><span class="err">`</span><span class="w"> </span><span class="n">hiểu</span><span class="w"> </span><span class="err">`</span><span class="nd">@Autowired</span><span class="err">`</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">gì</span><span class="p">.</span><span class="w"> </span><span class="n">Hướng</span><span class="w"> </span><span class="n">giải</span><span class="w"> </span><span class="n">quyết</span><span class="w"> </span><span class="n">là</span><span class="w"> </span><span class="n">tích</span><span class="w"> </span><span class="n">hợp</span><span class="w"> </span><span class="err">`</span><span class="n">Spring</span><span class="err">`</span><span class="w"> </span><span class="n">vào</span><span class="w"> </span><span class="n">với</span><span class="w"> </span><span class="err">`</span><span class="n">JUnit</span><span class="err">`</span><span class="p">.</span>

<span class="err">###</span><span class="w"> </span><span class="o">**</span><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="o">**</span>

<span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="o">**</span><span class="w"> </span><span class="n">đã</span><span class="w"> </span><span class="n">thiết</span><span class="w"> </span><span class="n">kế</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="n">lớp</span><span class="w"> </span><span class="err">`</span><span class="n">SpringRunner</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">giúp</span><span class="w"> </span><span class="n">chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">tích</span><span class="w"> </span><span class="n">hợp</span><span class="w"> </span><span class="o">**</span><span class="n">Spring</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">JUnit</span><span class="o">**</span><span class="p">.</span>

<span class="n">Để</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">Spring</span><span class="p">,</span><span class="w"> </span><span class="n">trong</span><span class="w"> </span><span class="n">mọi</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="n">chúng</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">sẽ</span><span class="w"> </span><span class="n">thêm</span><span class="w"> </span><span class="err">`</span><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="n">lên</span><span class="w"> </span><span class="n">đầu</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">đó</span><span class="p">.</span>
</code></pre></div>
@RunWith(SpringRunner.class)
public class TodoServiceTest {
    ...
}
<div class="highlight"><pre><span></span><code>Khi bạn chạy `TodoServiceTest` nó sẽ tạo ra một `Context` riêng để chứa `bean` trong đó, vậy là chúng ta có thể `@Autowired` thoải mái trong nội hàm Class này.

Vấn đề tiếp theo là làm sao đưa `Bean` vào trong `Context`.

Có 2 cách

1. `@SpringBootTest`
2. `@TestConfiguration`

### **@SpringBootTest**

`@SpringBootTest` sẽ đi tìm kiếm class có gắn `@SpringBootApplication` và từ đó đi tìm toàn bộ `Bean` và nạp vào `Context`.

Cái này chỉ nên sử dụng trong trường hợp muốn Integration Tests, vì nó sẽ tạo toàn bộ `Bean`, không khác gì bạn chạy cả cái `SpringApplication.run(App.class, args);`, rất tốn thời gian mà rất nhiều `Bean` thừa thãi, không cần dùng đến cũng khởi tạo.
</code></pre></div>
@RunWith(SpringRunner.class)
@SpringBootTest
public class TodoServiceTest {</p>
<pre><code>/**
 * Cách này sử dụng @SpringBootTest
 * Nó sẽ load toàn bộ Bean trong app của bạn lên,
 * Giống với việc chạy App.java vậy
 */

@Autowired
private TodoService todoService;
</code></pre>
<p>}
```
</p>
<h3 id="testconfiguration"><strong>@TestConfiguration</strong><a class="headerlink" href="#testconfiguration" title="Permanent link">&para;</a></h3>
<p><code>@TestConfiguration</code> giống với <code>@Configuration</code>, chúng ta tự định nghĩa ra <code>Bean</code>.

Các Bean được tạo bởi <code>@TestConfiguration</code> chỉ tồn tại trong môi trường Test. Rất phụ hợp với việc viết UnitTest.

Class Test nào, cần Bean gì, thì tự tạo ra trong <code>@TestConfiguration</code>

```
@RunWith(SpringRunner.class)
public class TodoServiceTest2 {</p>
<pre><code>/**
 * Cách này sử dụng @TestConfiguration
 * Nó chỉ tạo ra Bean trong Context test này mà thôi
 * Tiết kiệm thời gian hơn khi sử dụng @SpringBootTest (vì phải load hết Bean lên mà không dùng đến)
 */
@TestConfiguration
public static class TodoServiceTest2Configuration{

    /*
    Tạo ra trong Context một Bean TodoService
     */
    @Bean
    TodoService todoService(){
        return new TodoService();
    }
}

@Autowired
private TodoService todoService;
</code></pre>
<p>```
</p>
<h3 id="mockbean"><strong>@MockBean</strong><a class="headerlink" href="#mockbean" title="Permanent link">&para;</a></h3>
<p><strong>Spring</strong> hỗ trợ mock với annotation <code>@MockBean</code>, chúng ta có thể mock lấy ra một <code>Bean</code> "giả" mà không thèm để ý tới thằng <code>Bean</code> "thật". (Kể cả thằng "thật" có ở trong Context đi nữa, cũng không quan tâm).

```
@RunWith(SpringRunner.class)
public class TodoServiceTest2 {</p>
<pre><code>/**
 * Đối tượng TodoRepository sẽ được mock, chứ không phải bean trong context
 */
@MockBean
TodoRepository todoRepository;
</code></pre>
<p>```
</p>
<h3 id="demo-1"><strong>Demo 1</strong><a class="headerlink" href="#demo-1" title="Permanent link">&para;</a></h3>
<p>Chúng ta sẽ học cách sử dụng các Annotation ở trên.
</p>
<h3 id="cai-at"><strong>Cài đặt</strong><a class="headerlink" href="#cai-at" title="Permanent link">&para;</a></h3>
<p><em>pom.xml</em>

```</p>
<?xml version="1.0" encoding="UTF-8"?>
<p><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.5.RELEASE</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>me.loda.spring</groupId>
    <artifactId>spring-boot-learning</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>spring-boot-learning</name>
    <description>Everything about Spring Boot</description></p>
<pre><code>&lt;properties&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;

    &lt;!--spring mvc, rest--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!--for test--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
    &lt;plugins&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
    &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p></project>
<div class="highlight"><pre><span></span><code>Cấu trúc thư mục:

!image

### **Tạo Model, Service, Repository**

Chúng ta sử dụng Lombok cho tiện nhé.

_Todo.java_
</code></pre></div>
@Data
@AllArgsConstructor
public class Todo {
    private int id;
    private String title;
    private String detail;
}
<div class="highlight"><pre><span></span><code>Vì phục vụ mục đích demo, chúng ta sẽ không cần sử dụng tới **Spring JPA** mà sẽ tự viết.

_TodoRepository.java_
</code></pre></div>
public interface TodoRepository {
    List<Todo> findAll();</p>
<pre><code>Todo findById(int id);
</code></pre>
<p>}
<code>_TodoService.java_</code>
@Service
public class TodoService {
    @Autowired
    private TodoRepository todoRepository;</p>
<pre><code>public int countTodo(){
    return todoRepository.findAll().size();
}

public Todo getTodo(int id){
    return todoRepository.findById(id);
}

public List&lt;Todo&gt; getAll(){
    return todoRepository.findAll();
}
</code></pre>
<p>}
<code>_App.java_</code>
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

Rất đơn giản.
</p>
<h3 id="test-bang-springboottest"><strong>Test bằng @SpringBootTest</strong><a class="headerlink" href="#test-bang-springboottest" title="Permanent link">&para;</a></h3>
<p>Chúng ta <code>mock TodoRepository</code> và giả lập cho nó trả ra một <code>List&lt;Todo&gt;</code> gồm 10 phần tử.

```
@RunWith(SpringRunner.class)
@SpringBootTest
public class TodoServiceTest {</p>
<pre><code>/**
 * Cách này sử dụng @SpringBootTest
 * Nó sẽ load toàn bộ Bean trong app của bạn lên,
 * Giống với việc chạy App.java vậy
 */

/**
 * Đối tượng TodoRepository sẽ được mock, chứ không phải bean trong context
 */
@MockBean
TodoRepository todoRepository;

@Autowired
private TodoService todoService;

@Before
public void setUp() {
    Mockito.when(todoRepository.findAll())
           .thenReturn(IntStream.range(0, 10)
                                .mapToObj(i -&gt; new Todo(i, "title-" + i, "detail-" + i))
                                .collect(Collectors.toList()));

}

@Test
public void testCount() {
    Assert.assertEquals(10, todoService.countTodo());
}
</code></pre>
<p>}
<div class="highlight"><pre><span></span><code>Bạn sẽ thấy Test chạy thành công, nhưng sẽ mất thời gian vì khởi tạo `Context` quá lâu do `@SpringBootTest` phải load hết tất cả bean lên.

### **Test bằng @TestConfiguration**
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">me.loda.spring.testinginspringboot</span><span class="p">;</span>
<span class="cm">/*******************************************************</span>
<span class="cm"> * For Vietnamese readers:</span>
<span class="cm"> *    Các bạn thân mến, mình rất vui nếu project này giúp</span>
<span class="cm"> * ích được cho các bạn trong việc học tập và công việc. Nếu</span>
<span class="cm"> * bạn sử dụng lại toàn bộ hoặc một phần source code xin để</span>
<span class="cm"> * lại dường dẫn tới github hoặc tên tác giá.</span>
<span class="cm"> *    Xin cảm ơn!</span>
<span class="cm"> *******************************************************/</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Collectors</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.IntStream</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Assert</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Before</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mockito.Mockito</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.context.TestConfiguration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.mock.mockito.MockBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoServiceTest2</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Cách này sử dụng @TestConfiguration</span>
<span class="cm">     * Nó chỉ tạo ra Bean trong Context test này mà thôi</span>
<span class="cm">     * Tiết kiệm thời gian hơn khi sử dụng @SpringBootTest (vì phải load hết Bean lên mà không dùng đến)</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@TestConfiguration</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoServiceTest2Configuration</span><span class="p">{</span>

<span class="w">        </span><span class="cm">/*</span>
<span class="cm">        Tạo ra trong Context một Bean TodoService</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="nd">@Bean</span>
<span class="w">        </span><span class="n">TodoService</span><span class="w"> </span><span class="nf">todoService</span><span class="p">(){</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoService</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@MockBean</span>
<span class="w">    </span><span class="n">TodoRepository</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Before</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">())</span>
<span class="w">               </span><span class="p">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">IntStream</span><span class="p">.</span><span class="na">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">mapToObj</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Todo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;title-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;detail-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">countTodo</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div></p>
<h3 id="van-e-test-spring-boot-2"><strong>Vấn đề Test + Spring Boot 2</strong><a class="headerlink" href="#van-e-test-spring-boot-2" title="Permanent link">&para;</a></h3>
<p>Ở trên chúng ta đã xử lý xong vấn đề dependency injection của <strong>JUnit</strong> + <strong>Spring Boot</strong> rồi.</p>
<p>Vấn đề tiếp theo là cái <strong>Controller</strong>. Đúng vậy, chúng ta tạo ra hàng chục Rest API đón request người dùng, vậy làm sao để test nó.</p>
<p>Nếu <strong>Controller</strong> không được test thì là một lỗ hổng cực lớn, vì nó là đầu ra chính của chương trình, nó sai -&gt; chương trình không có giá trị.</p>
<p>Tuy nhiên, chúng ta không muốn khởi động cả Tomcat Server + Database để test 1 API. Nó rất tốn tài nguyên và thời gian.</p>
<h3 id="webmvctest"><strong>@WebMvcTest</strong><a class="headerlink" href="#webmvctest" title="Permanent link">&para;</a></h3>
<p><strong>Spring Boot</strong> hỗ trợ test <strong>Controller</strong> mà không cần khởi động Tomcat Server bằng annotation <code>@WebMvcTest</code>.</p>
<p>Tất nhiên là nếu không khởi động Server, thì phải có một phương thức khác giả lập, vâng, lại là <strong>Mock</strong>.</p>
<p>Bây giờ, khi muốn test một Controller nào đó, chúng ta làm như sau:</p>
<div class="highlight"><pre><span></span><code>@RunWith(SpringRunner.class)
// Bạn cần cung cấp lớp Controller cho @WebMvcTest
@WebMvcTest(TodoRestController.class)
public class TodoRestControllerTest {
    /**
     * Đối tượng MockMvc do Spring cung cấp
     * Có tác dụng giả lập request, thay thế việc khởi động Server
     */
    @Autowired
    private MockMvc mvc;
}
</code></pre></div>
<h3 id="demo-2"><strong>Demo 2</strong><a class="headerlink" href="#demo-2" title="Permanent link">&para;</a></h3>
<p>Chúng ta vẫn sử dụng tiếp Project đã tạo ở <strong># Demo 1</strong></p>
<h3 id="tao-controller"><strong>Tạo Controller</strong><a class="headerlink" href="#tao-controller" title="Permanent link">&para;</a></h3>
<p><em>TodoRestController.java</em></p>
<div class="highlight"><pre><span></span><code>@RestController
@RequestMapping(&quot;/api/v1&quot;)
public class TodoRestController {
    @Autowired
    TodoService todoService;

    @GetMapping(&quot;/todo&quot;)
    public List&lt;Todo&gt; findAll(){
        return todoService.getAll();
    }
}
</code></pre></div>
<h3 id="tao-test-controller"><strong>Tạo Test Controller</strong><a class="headerlink" href="#tao-test-controller" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>import static org.hamcrest.CoreMatchers.is;
import static org.hamcrest.Matchers.hasSize;
import static org.mockito.BDDMockito.given;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.IntStream;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

@RunWith(SpringRunner.class)
// Bạn cần cung cấp lớp Controller cho @WebMvcTest
@WebMvcTest(TodoRestController.class)
public class TodoRestControllerTest {
    /**
     * Đối tượng MockMvc do Spring cung cấp
     * Có tác dụng giả lập request, thay thế việc khởi động Server
     */
    @Autowired
    private MockMvc mvc;

    @MockBean
    private TodoService todoService;

    @Test
    public void testFindAll() throws Exception {
        // Tạo ra một List&lt;Todo&gt; 10 phần tử
        List&lt;Todo&gt; allTodos = IntStream.range(0, 10)
                                       .mapToObj(i -&gt; new Todo(i, &quot;title-&quot; + i, &quot;detail-&quot; + i))
                                       .collect(Collectors.toList());

        // giả lập todoService trả về List mong muốn
        given(todoService.getAll()).willReturn(allTodos);

        mvc.perform(get(&quot;/api/v1/todo&quot;).contentType(MediaType.APPLICATION_JSON)) // Thực hiện GET REQUEST
           .andExpect(status().isOk()) // Mong muốn Server trả về status 200
           .andExpect(jsonPath(&quot;$&quot;, hasSize(10))) // Hi vọng server trả về List độ dài 10
           .andExpect(jsonPath(&quot;$[0].id&quot;, is(0))) // Hi vọng phần tử trả về đầu tiên có id = 0
           .andExpect(jsonPath(&quot;$[0].title&quot;, is(&quot;title-0&quot;))) // Hi vọng phần tử trả về đầu tiên có title = &quot;title-0&quot;
           .andExpect(jsonPath(&quot;$[0].detail&quot;, is(&quot;detail-0&quot;)));
    }
}
</code></pre></div>
<p>Chạy thử và trải nghiệm bạn nhé :3</p>
<h3 id="ket"><strong>Kết</strong><a class="headerlink" href="#ket" title="Permanent link">&para;</a></h3>
<p>Test là một phần quan trọng trong hệ thống, hi vọng các đọc kĩ và thực hành để nắm chắc.</p>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h2 id="huong-dan-chi-tiet-test-spring-boot-phan-2">Hướng dẫn chi tiết Test Spring Boot (Phần 2)<a class="headerlink" href="#huong-dan-chi-tiet-test-spring-boot-phan-2" title="Permanent link">&para;</a></h2>
<p>Trong bài này, tôi sẽ tập trung vào việc giới thiệu với các các bạn cách chuẩn bị dữ liệu test.</p>
<p>Bài viết có sử dụng:</p>
<ol>
<li>Hibernate là gì?</li>
<li>Spring JPA</li>
<li>Lombok</li>
<li>Spring Boot</li>
</ol>
<h3 id="cai-at_1"><strong>Cài đặt</strong><a class="headerlink" href="#cai-at_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;projectxmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&lt;parent&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&lt;version&gt;2.0.5.RELEASE&lt;/version&gt;&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;&lt;groupId&gt;me.loda.spring&lt;/groupId&gt;&lt;artifactId&gt;example-independent-maven-spring-project&lt;/artifactId&gt;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;name&gt;example-independent-maven-spring-project&lt;/name&gt;&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;&lt;properties&gt;&lt;java.version&gt;1.8&lt;/java.version&gt;&lt;/properties&gt;&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;&lt;scope&gt;runtime&lt;/scope&gt;&lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;!--spring jpa--&gt;
        &lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--in memory database--&gt;
        &lt;dependency&gt;&lt;groupId&gt;com.h2database&lt;/groupId&gt;&lt;artifactId&gt;h2&lt;/artifactId&gt;&lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;/dependencies&gt;&lt;build&gt;&lt;plugins&gt;&lt;plugin&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&lt;/plugin&gt;&lt;/plugins&gt;&lt;/build&gt;&lt;/project&gt;
</code></pre></div>
<h3 id="prepare"><strong>Prepare</strong><a class="headerlink" href="#prepare" title="Permanent link">&para;</a></h3>
<p>Trước hết, giả sử chúng ta có một hệ thống quản lý công việc</p>
<p><em>Todo.java</em></p>
<div class="highlight"><pre><span></span><code>@Data
@AllArgsConstructor
@NoArgsConstructor
@Entity
public class Todo {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;
    private String title;
    private String detail;
}
</code></pre></div>
<p><em>TodoRepository.java</em></p>
<div class="highlight"><pre><span></span><code>public interface TodoRepository extends JpaRepository&lt;Todo, Long&gt; {
    List&lt;Todo&gt; findAll();

    Todo findById(int id);
}
</code></pre></div>
<p><em>TodoController.java</em></p>
<div class="highlight"><pre><span></span><code>@RestController
@RequestMapping(&quot;/api/v1&quot;)
@RequiredArgsConstructor
public class TodoRestController {
    private final TodoService todoService;

    @GetMapping(&quot;/todo&quot;)
    public List&lt;Todo&gt; findAll() {
        return todoService.getAll();
    }
}
</code></pre></div>
<h3 id="datajpatest"><strong>@DataJpaTest</strong><a class="headerlink" href="#datajpatest" title="Permanent link">&para;</a></h3>
<p>Về cơ bản, chúng ta không thể mock hay làm giả dữ liệu của Database mãi được, nó sẽ là một lỗ hổng lớn trong hệ thống. Ngoài ra, bạn cũng sẽ không thể test được quá trình thao tác với Database của dự án.</p>
<p>Vậy nên sau cùng, chúng ta cũng sẽ phải test các thao tác vận hành với Database,</p>
<p>Nhưng chớ lo, để tập trung vào việc test các thao tác với Database, Spring Boot đã hỗ trợ chúng ta bằng <code>@DataJpaTest</code></p>
<p>Kết hợp giữa <code>@DataJpaTest</code> và <code>h2-database</code> (Memory database) là Combo hoàn hảo.</p>
<div class="highlight"><pre><span></span><code>@RunWith(SpringRunner.class)
/**
 * Khi đánh dấu một class là @DataJpaTest.
 * Spring Boot sẽ load lên tất cả các Bean có liên quan tới tầng Repository
 * Thay vì load hết tất cả Bean như là @SpringBootTest
 */
@DataJpaTest
public class DataJpaAnnotationTest {

    @Autowired
    private DataSource dataSource;
    @Autowired
    private JdbcTemplate jdbcTemplate;
    @Autowired
    private EntityManager entityManager;
    @Autowired
    private TodoRepository todoRepository;

    @Test
    public void allComponentAreNotNull() {
        Assertions.assertThat(dataSource).isNotNull();
        Assertions.assertThat(jdbcTemplate).isNotNull();
        Assertions.assertThat(entityManager).isNotNull();
        Assertions.assertThat(todoRepository).isNotNull();
    }

}
</code></pre></div>
<p><code>@DataJpaTest</code> có tác dụng khởi tạo các Bean cần thiết cho tầng Repository. Ngoài ra, nó không khởi tạo thêm các Bean thừa thãi nào khác. (Chuyên biệt hơn <code>@SpringBootTest</code>)</p>
<h3 id="tao-data"><strong>Tạo Data</strong><a class="headerlink" href="#tao-data" title="Permanent link">&para;</a></h3>
<p>Cách Fake dữ liệu đơn giản nhất là tự insert bằng repository</p>
<div class="highlight"><pre><span></span><code>import org.assertj.core.api.Assertions;
import org.junit.After;

    @Test
    public void testTodoRepositoryByCode() {
        todoRepository.save(new Todo(0, &quot;Todo-1&quot;, &quot;Detail-1&quot;));
        todoRepository.save(new Todo(0, &quot;Todo-2&quot;, &quot;Detail-2&quot;));

        Assertions.assertThat(todoRepository.findAll()).hasSize(2);
        Assertions.assertThat(todoRepository.findById(1).getTitle()).isEqualTo(&quot;Todo-1&quot;);
    }

    @After
    public void clean() {
        todoRepository.deleteAll();
    }
</code></pre></div>
<h3 id="sql"><strong>@Sql</strong><a class="headerlink" href="#sql" title="Permanent link">&para;</a></h3>
<p>Một cách làm hay hơn để chuẩn bị dữ liệu cho Test đó là sử dụng annotation <code>@Sql</code></p>
<p><code>@Sql</code> có tác dụng load một hoặc nhiều file scripts sql lên và thực thi.</p>
<p>ví dụ:</p>
<p><em>createToDo.sql</em></p>
<div class="highlight"><pre><span></span><code>INSERT INTO todo (title, detail) VALUES (&#39;Todo-1&#39;, &#39;Do homework&#39;);
INSERT INTO todo (title, detail) VALUES (&#39;Todo-2&#39;, &#39;Walking&#39;);
</code></pre></div>
<p>Để chạy scripts này trong class Test, bạn làm như sau:</p>
<div class="highlight"><pre><span></span><code>@RunWith(SpringRunner.class)
@DataJpaTest
public class SqlAnnotationTest {
    @Autowired
    private TodoRepository todoRepository;

    @Test
    @Sql(&quot;/createTodo.sql&quot;)
    public void testTodoRepositoryBySqlSchema() {
        Assertions.assertThat(todoRepository.findAll()).hasSize(2);
        Assertions.assertThat(todoRepository.findById(1).getTitle()).isEqualTo(&quot;Todo-1&quot;);
    }

}
</code></pre></div>
<p>Để chạy nhiều file sql cùng lúc, bạn sử dụng <code>@SqlGroup</code></p>
<h3 id="ket_1"><strong>Kết</strong><a class="headerlink" href="#ket_1" title="Permanent link">&para;</a></h3>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h2 id="sb20-huong-dan-toan-tap-mockito">[SB20] Hướng dẫn toàn tập Mockito<a class="headerlink" href="#sb20-huong-dan-toan-tap-mockito" title="Permanent link">&para;</a></h2>
<h3 id="yeu-cau"><strong>Yêu cầu</strong><a class="headerlink" href="#yeu-cau" title="Permanent link">&para;</a></h3>
<p>Trước khi tìm hiểu Mockito, bạn cần biết JUnit.</p>
<p>Trong bài viết có sử dụng Lombok</p>
<h3 id="gioi-thieu"><strong>Giới thiệu</strong><a class="headerlink" href="#gioi-thieu" title="Permanent link">&para;</a></h3>
<p>Về cơ bản, Unit test là phương pháp tiếp cận độc lập, tức là mỗi một chức chăng năng sẽ được đi kèm với một hoặc nhiều bài test để chắc chắn ràng cái chức năng đó hoạt động ổn. Vậy nên Unit Test thường là đơn nhỏ nhất và test case cũng dễ dàng khởi tạo</p>
<div class="highlight"><pre><span></span><code>@Test
public void testSum(){
    Assert.assertEquals(3, MathUtil.sum(1,2));
}
</code></pre></div>
<p>Bài toán mở rộng ra hơn, Khi chúng ta phải test sự hoạt động phối hợp giữa nhiều chức năng hay thành phần với nhau hoặc muốn test một chức năng lớn thì sẽ trở nên phức tạp và khó xây dựng hơn rất nhiều.</p>
<p>Các kịch bản sau thường diễn ra:</p>
<ul>
<li>Chức năng A gọi tới chức năng B. tuy nhiên, B chưa viết xong</li>
<li>Chức năng A gọi tới chức năng B. tuy nhiên, B khởi tạo rất phức tạp (truy xuất Database, yêu cầu nhiều params, v.v.)</li>
<li>Muốn test chức năng A, tuy nhiên A yêu cầu nỗ lực lớn của cả hệ thống (Yêu cầu có HTTP-server, authorize, v.v.)</li>
</ul>
<div class="highlight"><pre><span></span><code>// Giả sử muốn test hàm này
public int getAllData(){

    // Giả sử như thằng driver không được khởi tạo hoặc bị lỗi
    // thì function này coi như hỏng

    MySQLdriver.connect() // Kết nối xuống Database
    var data = MySQLdriver.get()// Lấy dữ liệu

    // Chúng ta muốn test logic xử lý dữ liệu ở dưới đây,
    // mà k cần kết nối databse, phải làm sao?

    // Xử lý dữ liệu
    ...
    // trả ra dữ liệu
    return data
}
</code></pre></div>
<p>Rất nhiều kịch bản phức tạp xảy ra, mà trên thực tế, chúng ta chỉ mong muốn confirm rằng A ổn, chứ thằng B, C, D gì đó thì hãy cứ tạm coi là nó "đã ổn" đi.</p>
<p>Để đơn giản hoá các kịch bản test như trên, khái niệm <code>Mock</code> ra đời.</p>
<p>Tư tưởng của <code>Mock</code> đơn giản là khi muốn test (A gọi B) thì thay vì tạo ra một đối tượng B thật sự, bạn tạo ra một thằng B' giả mạo, có đầy đủ chức năng như B thật (nhưng không phải thật)</p>
<p>Bạn sẽ giả lập cho B' biết là khi thằng A gọi tới nó, nó cần làm gì, trả lại cái gì (hardcode). Miễn làm sao cho nó trả ra đúng cái thằng A cần để chúng ta có thể test A thuận lợi nhất.</p>
<div class="highlight"><pre><span></span><code>// Đại loại như này
// Khi driver.get() được gọi, hãy trả ra một List(1,2,3)
Mockito.when(driver.get())
       .thenReturn(Arrays.asList(1, 2, 3));
</code></pre></div>
<p>Ở trong Java, <code>Mockito</code> chính là thư viện nổi tiếng nhất để các bạn làm việc này.</p>
<h3 id="cai-at_2"><strong>Cài đặt</strong><a class="headerlink" href="#cai-at_2" title="Permanent link">&para;</a></h3>
<p>Để sử dụng <code>Mockito</code> bạn cần:</p>
<div class="highlight"><pre><span></span><code>&lt;!--https://mvnrepository.com/artifact/org.mockito/mockito-core --&gt;
&lt;dependency&gt;&lt;groupId&gt;org.mockito&lt;/groupId&gt;&lt;artifactId&gt;mockito-core&lt;/artifactId&gt;&lt;version&gt;3.2.4&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;
</code></pre></div>
<p>Chúng ta đang viết test, nên đừng quên <code>JUnit</code> nữa nhé:</p>
<div class="highlight"><pre><span></span><code>&lt;!--https://mvnrepository.com/artifact/junit/junit --&gt;
&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;
</code></pre></div>
<h3 id="cach-mock"><strong>Cách Mock</strong><a class="headerlink" href="#cach-mock" title="Permanent link">&para;</a></h3>
<p>Khái niệm cơ bản đầu tiên, đó là làm sao để tạo ra một đối tượng bị Mock.</p>
<h3 id="cach-1-mockitomock"><strong>Cách 1: Mockito.mock()</strong><a class="headerlink" href="#cach-1-mockitomock" title="Permanent link">&para;</a></h3>
<p>Sử dụng <code>Mockito.mock()</code> để tạo ra một object của <code>Class</code> bạn yêu cầu, nó thậm chí còn không quan tâm hàm khởi tạo của <code>Class</code> ý như nào và ra sao, vì nó đâu có thật :v</p>
<div class="highlight"><pre><span></span><code>@Test
public void testUserMockFunction() {
    List mockList = Mockito.mock(List.class);

    Mockito.when(mockList.size()).thenReturn(2);

    Assert.assertEquals(2, mockList.size());
}
</code></pre></div>
<h3 id="cach-2-su-dung-mock"><strong>Cách 2: Sử dụng @Mock</strong><a class="headerlink" href="#cach-2-su-dung-mock" title="Permanent link">&para;</a></h3>
<p>Bạn muốn mock cái gì, thì đánh dấu <code>@Mock</code> lên ý, đơn giản vãi :v</p>
<div class="highlight"><pre><span></span><code>@Mock
List&lt;String&gt; mockedList;
</code></pre></div>
<p>Tuy nhiên, gắn <code>@Mock</code> là chưa đủ, bạn cần kích hoạt <code>Mockito</code> để nó mock các object ý cho bạn.</p>
<p>Sau khi kích hoạt, thì tất cả các object được gắn <code>@Mock</code> sẽ trở thành 1 object giả mạo, và đã được khởi tạo (tức là <code>!= null</code>)</p>
<p>Các cách kích hoạt như sau:</p>
<ol>
<li>Gắn <code>@RunWith(MockitoJUnitRunner.class)</code> lên class test của bạn</li>
</ol>
<div class="highlight"><pre><span></span><code>// Cách 1
@RunWith(MockitoJUnitRunner.class)
public class MockitoAnnotationTest {
    @Mock
    List&lt;String&gt; mockedList;
}
</code></pre></div>
<ol>
<li>tạo ra một đối tượng <code>MockitoRule</code> bên trong class test của bạn</li>
</ol>
<div class="highlight"><pre><span></span><code>public class MockitoAnnotationTest {

    // Cách 2
    @Rule
    public MockitoRule initRule = MockitoJUnit.rule();

    @Mock
    List&lt;String&gt; mockedList;
}
</code></pre></div>
<ol>
<li>Sử dụng <code>Mockito.init()</code></li>
</ol>
<div class="highlight"><pre><span></span><code>public class MockitoAnnotationTest {

    @Mock
    List&lt;String&gt; mockedList;

    @Before
    public void setUp() throws Exception {
        // Cách 3
        // Nếu bạn không dùng cách 1 hoặc 2 thì phải sử dụng
        // dòng code dưới đây:
        MockitoAnnotations.initMocks(this);
    }
}
</code></pre></div>
<p>Vậy là xong, bạn đã tạo ra được một Object bị mock.</p>
<h3 id="cach-su-dung"><strong>Cách sử dụng</strong><a class="headerlink" href="#cach-su-dung" title="Permanent link">&para;</a></h3>
<p><code>Mockito</code> cung cấp rất nhiều methods khác nhau để giúp bạn giả lập đầy đủ các thứ bạn cần.</p>
<p>Hay sử dụng nhất là hàm <code>when()</code>.</p>
<div class="highlight"><pre><span></span><code>// Trả là size 100 khi gọi hàm size()
Mockito.when(mockedList.size()).thenReturn(100);
// Throw exception khi gọi hàm size()
Mockito.when(mockedList.size()).thenThrow(NullPointerException.class);
// Bạn có thể đổi ngược cách viết, còn logic vẫn vậy
// Ném ra exception khi gọi hàm .get() với tham số truyền vào bất kì
Mockito.doThrow(NullPointerException.class).when(mockedList.get(Mockito.any()));
</code></pre></div>
<h3 id="spy"><strong>Spy</strong><a class="headerlink" href="#spy" title="Permanent link">&para;</a></h3>
<p><code>Spy</code> là việc sửa một đối tượng Thật -&gt; Giả</p>
<div class="highlight"><pre><span></span><code>@RunWith(MockitoJUnitRunner.class)
public class SpyTest {
    @Spy
    List&lt;String&gt; list = new ArrayList&lt;&gt;();

    @Test
    public void testSpy() {
        list.add(&quot;one&quot;);
        list.add(&quot;two&quot;);
        // show the list items
        System.out.println(list);

        Mockito.verify(list).add(&quot;one&quot;);
        Mockito.verify(list).add(&quot;two&quot;);

        // @Spy thực sự gọi hàm .add của List nên nó có size là 2 mà không cần giả lập
        Assert.assertEquals(2, list.size());

        // Vẫn có thể làm giả thông tin gọi hàm với @Spy
        Mockito.when(list.size()).thenReturn(100);

        Assert.assertEquals(100, list.size());
    }
}
</code></pre></div>
<h3 id="captor"><strong>Captor</strong><a class="headerlink" href="#captor" title="Permanent link">&para;</a></h3>
<p><code>Captor</code> có nhiệm vụ ghi lại các tham số của đối tượng</p>
<div class="highlight"><pre><span></span><code>@RunWith(MockitoJUnitRunner.class)
public class CaptorTest {
    @Mock
    List&lt;Object&gt; list;

    @Captor
    ArgumentCaptor&lt;Object&gt; captor;

    @Test
    public void testCaptor1() {
        list.add(1);
        // Capture lần gọi add vừa rồi có giá trị là gì
        Mockito.verify(list).add(captor.capture());

        System.out.println(captor.getAllValues());

        Assert.assertEquals(1, captor.getValue());
    }
}
</code></pre></div>
<h3 id="inject-mock"><strong>Inject Mock</strong><a class="headerlink" href="#inject-mock" title="Permanent link">&para;</a></h3>
<p>Quay lại với ví dụ đầu bài viết:</p>
<p>Tôi có một lớp <code>Service</code> chứa lớp <code>DatabaseDriver</code> như sau:</p>
<div class="highlight"><pre><span></span><code>public interface DatabaseDriver {
    List&lt;Object&gt; get() throws SQLException;
}

@Data
@AllArgsConstructor
public static class SuperService {
    DatabaseDriver driver;

    public List&lt;Object&gt; getObjects() throws SQLException {
        System.out.println(&quot;LOG: Getting objects&quot;);
        List&lt;Object&gt; list = driver.get();

        System.out.println(&quot;LOG: Sorting&quot;);
        Collections.sort(list, Comparator.comparingInt(value -&gt; Integer.valueOf(value.toString())));

        System.out.println(&quot;LOG: Done&quot;);
        return list;
    }
}
</code></pre></div>
<p>Rõ ràng thì <code>driver</code> chính là mắt xích trong trong việc <code>SuperService</code> có hoạt động được hay không. Vì thế, muốn test được <code>SuperService</code>, chúng ta phải mock đối tượng <code>driver</code>.</p>
<p>kịch bản bây giờ sẽ là tôi mock một đối tượng của <code>DatabaseDriver</code> rồi truyền nó vào đối tượng <code>SuperService</code>.</p>
<p>Để truyền một đối tượng mock vào một đối tượng khác, chúng ta dùng <code>@InjectMocks</code>.</p>
<div class="highlight"><pre><span></span><code>@RunWith(MockitoJUnitRunner.class)
public class InjectMockTest {
    @Mock
    DatabaseDriver driver;

    /**
     * Inject driver vào superService.
     * Mọi người có thể liên tưởng nó giống với Spring Injection
     */
    @InjectMocks
    SuperService superService;

    @Test(expected = SQLException.class)
    public void testInjectMock() throws SQLException {
        // Giả lập cho driver luôn trả về list (3,2,1) khi được gọi tới
        Mockito.doReturn(Arrays.asList(3, 2, 1)).when(driver).get();

        Assert.assertEquals(driver, superService.getDriver());

        // Test xem superService trả ra ngoài có đúng không?
        Assert.assertEquals(Arrays.asList(1, 2, 3), superService.getObjects());

        // Giả lập cho driver bắn exception
        Mockito.when(driver.get()).thenThrow(SQLException.class);
        superService.getObjects();
    }
}
</code></pre></div>
<h3 id="ket_2"><strong>Kết</strong><a class="headerlink" href="#ket_2" title="Permanent link">&para;</a></h3>
<p>Tới đây, bạn đã có thể dùng <code>Mockito</code> xoành xoạch rồi.</p>
<p>Tiếp theo, có thể đọc cách sử dụng <code>Mockito</code> với <code>Spring Boot</code>tại đây</p>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h1 id="sb21-huong-dan-tao-bean-co-ieu-kien-voi-conditional">[SB21] Hướng dẫn tạo Bean có điều kiện với @Conditional<a class="headerlink" href="#sb21-huong-dan-tao-bean-co-ieu-kien-voi-conditional" title="Permanent link">&para;</a></h1>
<ul>
<li>Giới thiệu</li>
<li>Cách tạo bean có điều kiện</li>
<li>@ConditionalOnBean</li>
<li>@ConditionalOnProperty</li>
<li>@ConditionalOnExpression</li>
<li>@ConditionalOnMissingBean</li>
<li>@ConditionalOnResource</li>
<li>@ConditionalOnClass</li>
<li>@ConditionalOnMissingClass</li>
<li>@ConditionalOnJava</li>
<li>Một số loại khác</li>
<li>Custom Conditional</li>
<li>Kết</li>
</ul>
<h3 id="gioi-thieu_1"><strong>Giới thiệu</strong><a class="headerlink" href="#gioi-thieu_1" title="Permanent link">&para;</a></h3>
<p>Khi xây dựng một chương trình với <strong>Spring Boot</strong> đôi lúc chúng ta một <strong>Bean</strong> chỉ được load lên hoặc khởi tạo theo một điều kiện nào đó. Ví dụ như tạo một <strong>Bean</strong> trong môi trường Test, còn môi trường thật sẽ không cần nữa.</p>
<p><strong>Spring Boot</strong> hỗ trợ chúng ta làm điều này với Annotation <code>@Conditional</code>.</p>
<p>Bài này yêu cầu kiến thức cơ bản:</p>
<ol>
<li>「Spring Boot #0」 Series làm chủ Spring Boot, Zero to Hero</li>
</ol>
<p>Toàn bộ ví dụ trong bài viết này đều có tại Github</p>
<h3 id="cach-tao-bean-co-ieu-kien"><strong>Cách tạo bean có điều kiện</strong><a class="headerlink" href="#cach-tao-bean-co-ieu-kien" title="Permanent link">&para;</a></h3>
<p>Trong <strong>Spring Boot</strong>, có rất nhiều cách để tạo ra <code>Bean</code>, bạn biết cách nào?</p>
<p><code>@Component</code>, <code>@Configuration</code>, <code>@Bean</code>, <code>@Service</code>, v.v...</p>
<p>Với tất cả các cách tạo ra <code>Bean</code>, bạn đều có thể thêm <strong>một hoặc nhiều điều kiện</strong> để cho việc tạo ra <code>Bean</code> đó chỉ xảy ra nếu nó thỏa mãn một điều kiện cho trước.</p>
<p><strong>SpringBoot</strong> hỗ trợ rất nhiều loại điều kiện khác nhau, tất cả đều sẽ bắt đầu bằng tiền tố <code>@Conditional...</code>. Còn hậu tố thì chúng ta sẽ đề cập sau.</p>
<p>Cách thức hoạt động của tất cả <code>@Condition</code> như sau:</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class ConditionalOnBeanExample {
    /*
    ABeanWithCondition chỉ được tạo ra khi @Condition thỏa mãn
    */
    @Bean
    @Conditional...
    ABeanWithCondition aBeanWithACondition() {
        return new ABeanWithCondition();
    }
}
</code></pre></div>
<p>Nếu bạn gắn nó trên một <code>@Configuration</code> thì toàn bộ các <code>@Bean</code> bên trong sẽ bị chịu tác động.</p>
<div class="highlight"><pre><span></span><code>@Conditional...
@Configuration
public class ConditionalOnBeanExample {
    /*
    SomeOtherBean chỉ được tạo ra khi @Condition thỏa mãn
    */
    @Bean
    SomeOtherBean someOtherBean() {
        return new SomeOtherBean();
    }
       /*
    SomeOtherBean2 chỉ được tạo ra khi @Condition thỏa mãn
    */
    @Bean
    SomeOtherBean2 someOtherBean2() {
        return new SomeOtherBean2();
    }
}
</code></pre></div>
<p>Tương tự cho tất cả các annotation khác như <code>@Component</code>, <code>@Service</code>, <code>@Repository</code></p>
<div class="highlight"><pre><span></span><code>@Conditional...
@Component
public class ConditionalOnBeanExample {
}
</code></pre></div>
<p>Bây giờ chúng ta sẽ đi tìm hiểu các loại điều kiện trong <strong>Spring Boot</strong>.</p>
<h3 id="conditionalonbean"><strong>@ConditionalOnBean</strong><a class="headerlink" href="#conditionalonbean" title="Permanent link">&para;</a></h3>
<p><code>@ConditionalOnBean</code> sử dụng khi chúng ta muốn tạo ra một Bean, chỉ khi có một Bean khác đang tồn tại</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class ConditionalOnBeanExample {
    /*
    Đây là một Bean, bạn hãy chạy ứng dụng
    khi comment và chạy lại lần nữa nhưng bỏ dấu comment phía
    dưới để xem kết quả.
     */
    // @Bean
    RandomBean randomBean() {
        return new RandomBean();
    }

    /*
    ABeanWithCondition chỉ được tạo ra, khi RandomBean tồn tại trong Context.
     */
    @Bean
    @ConditionalOnBean(RandomBean.class)
    ABeanWithCondition aBeanWithACondition() {
        return new ABeanWithCondition();
    }
}
</code></pre></div>
<h3 id="conditionalonproperty"><strong>@ConditionalOnProperty</strong><a class="headerlink" href="#conditionalonproperty" title="Permanent link">&para;</a></h3>
<p>Dùng <code>@ConditionalOnProperty</code> khi bạn muốn quyết định sự tồn tại Bean thông qua cấu hình property.</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class ConditionalOnPropertyExample {

    /*
    @ConditionalOnProperty giúp gắn điều kiện cho @Bean dựa theo
    property trong config
     */
    @Bean
    @ConditionalOnProperty(
            value=&quot;loda.bean2.enabled&quot;,
            havingValue = &quot;true&quot;, // Nếu giá trị loda.bean2.enabled  = true thì Bean mới được khởi tạo
            matchIfMissing = false) // matchIFMissing là giá trị mặc định nếu không tìm thấy property loda.bean2.enabled
    ABeanWithCondition2 aBeanWithCondition2(){
        return new ABeanWithCondition2();
    }
}
</code></pre></div>
<p><em>application.properties</em></p>
<div class="highlight"><pre><span></span><code>#Thay đổi thành true để tạo bean2
loda.bean2.enabled=true
</code></pre></div>
<h3 id="conditionalonexpression"><strong>@ConditionalOnExpression</strong><a class="headerlink" href="#conditionalonexpression" title="Permanent link">&para;</a></h3>
<p>Trong trường hợp bạn muốn thỏa mãn nhiều điều kiện trong property, hãy sử dụng <code>@ConditionalOnExpression</code></p>
<div class="highlight"><pre><span></span><code>@Configuration
@ConditionalOnExpression(
        &quot;${loda.expression1.enabled:true} and ${loda.expression2.enabled:true}&quot;
)
public class ConditionalOnExpressionExample {
}
</code></pre></div>
<h3 id="conditionalonmissingbean"><strong>@ConditionalOnMissingBean</strong><a class="headerlink" href="#conditionalonmissingbean" title="Permanent link">&para;</a></h3>
<p>Nếu trong <code>Context</code> chưa tồn tại bất kỳ Bean nào tương tự, thì <code>@ConditionalOnMissingBean</code> sẽ thỏa mãn điều kiện và tạo ra một Bean như thế.</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class ConditionalOnMissingBeanExample {
    /**
     * Nếu trong Context chưa tồn tại một SomeMissingBean nào
     * Thì Bean ở dưới đây mới được tạo
     * @return
     */
    @ConditionalOnMissingBean
    DataSource someMissingBean(){
        return new DataSource();
    }
}
</code></pre></div>
<h3 id="conditionalonresource"><strong>@ConditionalOnResource</strong><a class="headerlink" href="#conditionalonresource" title="Permanent link">&para;</a></h3>
<p><code>@ConditionalOnResource</code> thỏa mãn khi có một resources nào đó do bạn chỉ định tồn tại</p>
<div class="highlight"><pre><span></span><code>/*
Nếu Spring Boot không tìm thấy file application.properties thì class này không được tạo
*/
@Configuration
@ConditionalOnResource(resources = &quot;/application.properties&quot;)
public class ConditionalOnResourceExample {
}
</code></pre></div>
<h3 id="conditionalonclass"><strong>@ConditionalOnClass</strong><a class="headerlink" href="#conditionalonclass" title="Permanent link">&para;</a></h3>
<p><code>@ConditionalOnClass</code> thỏa mãn khi trong classpath có tồn tại class mà bạn yêu cầu</p>
<div class="highlight"><pre><span></span><code>@Configuration
@ConditionalOnClass(name = &quot;loda.me.spring.LodaHandsome&quot;)
class ConditionalOnClassExample {
}
</code></pre></div>
<h3 id="conditionalonmissingclass"><strong>@ConditionalOnMissingClass</strong><a class="headerlink" href="#conditionalonmissingclass" title="Permanent link">&para;</a></h3>
<p><code>@ConditionalOnMissingClass</code> ngược lại với <code>@ConditionalOnClass</code>. thỏa mãn khi trong classpath <strong>không</strong> tồn tại class mà bạn yêu cầu</p>
<div class="highlight"><pre><span></span><code>@Configuration
@ConditionalOnMissingClass(name = &quot;loda.me.spring.LodaHandsome&quot;)
class ConditionalOnMissingClassExample {
}
</code></pre></div>
<h3 id="conditionalonjava"><strong>@ConditionalOnJava</strong><a class="headerlink" href="#conditionalonjava" title="Permanent link">&para;</a></h3>
<p><code>@ConditionalOnJava</code> thỏa mãn nếu môi trường chạy version Java đúng với điều kiện</p>
<div class="highlight"><pre><span></span><code>@Configuration
@ConditionalOnJava(JavaVersion.EIGHT)
class ConditionalOnJavaExample {
}
</code></pre></div>
<h3 id="mot-so-loai-khac"><strong>Một số loại khác</strong><a class="headerlink" href="#mot-so-loai-khac" title="Permanent link">&para;</a></h3>
<p>Vẫn còn các bạn ạ, những mình thấy nó ít khi được sử dụng, nên sẽ không đề cập, tránh loạn thông tin.</p>
<h3 id="custom-conditional"><strong>Custom Conditional</strong><a class="headerlink" href="#custom-conditional" title="Permanent link">&para;</a></h3>
<p>Tất nhiên là bạn hoàn toàn có thể tự tạo ra cho mình một điều kiện. Mình sẽ đề cập cách làm ở bài sau.</p>
<h3 id="ket_3"><strong>Kết</strong><a class="headerlink" href="#ket_3" title="Permanent link">&para;</a></h3>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h1 id="sb22-huong-dan-tu-tao-custom-conditional">[SB22] Hướng dẫn tự tạo custom @Conditional<a class="headerlink" href="#sb22-huong-dan-tu-tao-custom-conditional" title="Permanent link">&para;</a></h1>
<ul>
<li>Giới thiệu</li>
<li>Tự tạo @Conditional</li>
<li>Tự tạo Annotation @Conditional</li>
<li>Chạy thử</li>
<li>Kết hợp nhiều điều kiện với OR</li>
<li>Kết hợp nhiều điều kiện với AND</li>
<li>Kết</li>
</ul>
<h3 id="gioi-thieu_2"><strong>Giới thiệu</strong><a class="headerlink" href="#gioi-thieu_2" title="Permanent link">&para;</a></h3>
<p>Yêu cầu bạn phải đọc bài viết về <code>@Conditional</code> trước:</p>
<ol>
<li>[Spring Boot] Hướng dẫn tạo Bean có điều kiện với @Conditional</li>
</ol>
<p>Tôi đã giới thiệu với các bạn các sử dụng các loại <code>@Conditional</code> có sẵn trong Spring Boot. Tuy nhiên, trên thực tế, sẽ có những lúc yêu cầu các loại điều kiện nằm ngoài phạm vi của Spring Boot cung cấp.</p>
<p>Khi đó, chúng ta phải tự tạo <code>@Condinal</code> cho mình.</p>
<h3 id="tu-tao-conditional"><strong>Tự tạo @Conditional</strong><a class="headerlink" href="#tu-tao-conditional" title="Permanent link">&para;</a></h3>
<p>Để tạo ra một điều kiện cho mình, bạn cần kế thừa lớp <code>Condition</code>, và implement lại function <code>matches</code></p>
<p><code>matches</code> là nơi bạn kiểm tra điều kiện xem có thoả mãn không.</p>
<div class="highlight"><pre><span></span><code>/*
Một điều kiện, phải kế thừa lớp Condition của Spring Boot cung cấp
 */
public class WindowRequired implements Condition{

    @Override
    public boolean matches(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata) {
        // Nếu OS ra window trả ra true.
        return System.getProperty(&quot;os.name&quot;).toLowerCase().contains(&quot;win&quot;);
    }
}
</code></pre></div>
<p>Và khi đã định nghĩa được cho mình một điều kiện riêng, bạn có thể sử dụng như sau:</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class AppConfiguration {
    public static class SomeBean{
    }

    /*
    SomeBean chỉ được tạo ra khi
    thỏa mãn điều kiện
     */
    @Conditional(WindowRequired.class)
    @Bean
    SomeBean someBean(){
        return new SomeBean();
    }
}
</code></pre></div>
<h3 id="tu-tao-annotation-conditional"><strong>Tự tạo Annotation @Conditional</strong><a class="headerlink" href="#tu-tao-annotation-conditional" title="Permanent link">&para;</a></h3>
<p>Nếu việc viết <code>@Conditional(WindowRequired.class)</code> chưa làm bạn hài lòng, bạn có thể tự tạo ra một <code>Annotation</code> giống với Spring Boot.</p>
<p>Ví dụ như <code>@ConditionalOnClass</code> trong bài viết trước</p>
<p>Thì hãy làm như sau:</p>
<div class="highlight"><pre><span></span><code>@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Documented
// Đánh dấu annotation này bởi @Conditional(WindowRequired.class)
@Conditional(WindowRequired.class)
public @interface ConditionalOnWindow {
    /*
    Trong trường hợp bạn muốn viết ngắn gọn,
    hay tạo ra 1 Annotation mới và gắn @Conditional(WindowRequired.class)
    trên nó

    Như vậy khi cần sử dụng chỉ cần gọi @ConditionalOnWindow là được
     */
}
</code></pre></div>
<p>Khi sử dụng:</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class AppConfiguration {
    public static class SomeBean{
    }

    /*
    SomeBean chỉ được tạo ra khi
    thỏa mãn điều kiện
     */
    @ConditionalOnWindow
    @Bean
    SomeBean someBean(){
        return new SomeBean();
    }
}
</code></pre></div>
<h3 id="chay-thu_1"><strong>Chạy thử</strong><a class="headerlink" href="#chay-thu_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>@SpringBootApplication
public class App {
    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(App.class, args);
        try {
            SomeBean someBean = context.getBean(SomeBean.class);
            System.out.println(&quot;SomeBean tồn tại!&quot;);
        }catch (Exception e){
            System.out.println(&quot;SomeBean chỉ được tạo nếu chạy trên Window&quot;);
        }

    }
}
</code></pre></div>
<p>Hãy bỏ Annotation <code>@ConditionalOnWindow</code> đi và chạy thử, sau đó thêm lại, xem kết quả của 2 lần chạy.</p>
<h3 id="ket-hop-nhieu-ieu-kien-voi-or"><strong>Kết hợp nhiều điều kiện với OR</strong><a class="headerlink" href="#ket-hop-nhieu-ieu-kien-voi-or" title="Permanent link">&para;</a></h3>
<p>Bạn có thể kết hợp nhiều điều kiện với nhau bởi phép OR.</p>
<p>Spring Boot hỗ trợ điều này bằng cách kế thừa lớp <code>AnyNestedCondition</code></p>
<div class="highlight"><pre><span></span><code>/**
 * Class kế thừa AnyNestedCondition sẽ chấp nhận mọi
 * điều kiện @Conditional bên trong nó
 */
public class WindowOrMacRequired extends AnyNestedCondition{

    public WindowOrMacRequired(){
        super(ConfigurationPhase.REGISTER_BEAN);
    }

    /*
    Bạn phải định nghĩa các Điều kiện bên trong class
    kế thừa AnyNestedCondition
     */
    @Conditional(WindowRequired.class)
    public class RunOnWindow{}

    /*
    Lúc này, cả 2 điều kiện Window và Mac sẽ được kết hợp vs
    nhau khi kiểm tra, nếu thoả mãn 1 trong 2 là đc
     */
    @Conditional(MacRequired.class)
    public class RunOnMac{}
}
</code></pre></div>
<p>Sử dụng</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class AppConfiguration {
    public static class SomeBean{
    }

    /*
    SomeBean chỉ được tạo ra khi
    thỏa mãn điều kiện
     */
    @Conditional(WindowOrMacRequired.class)
    @Bean
    SomeBean someBean(){
        return new SomeBean();
    }
}
</code></pre></div>
<h3 id="ket-hop-nhieu-ieu-kien-voi-and"><strong>Kết hợp nhiều điều kiện với AND</strong><a class="headerlink" href="#ket-hop-nhieu-ieu-kien-voi-and" title="Permanent link">&para;</a></h3>
<p>Bạn có thể kết hợp các điều kiện bằng phép AND bằng cách kế thừa lớp <code>AllNestedConditions</code>.</p>
<p>Cách kế thừa của nó giống với <code>AnyNestedCondition</code> nên tôi sẽ không cần đề cập thêm.</p>
<p>Ngoài ra, có một cách khác là sử dụng nhiều custom <code>@Conditional</code> cùng một lúc.</p>
<div class="highlight"><pre><span></span><code>@Bean
@ConditionalOnWindow
@Conditional(MacRequired.class)
SomeBean someBean() {
  return new SomeBean();
}
</code></pre></div>
<h3 id="ket_4"><strong>Kết</strong><a class="headerlink" href="#ket_4" title="Permanent link">&para;</a></h3>
<p>Tới đây, bạn có thể nắm vững được cách tạo điều kiện cho cấu hình ứng dụng của mình, nó sẽ rất có ích khi bạn làm việc và tách biệt được hai môi trường dev và production.</p>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h1 id="sb23-xu-ly-su-kien-voi-eventlistener-async">[SB23] Xử lý sự kiện với @EventListener + @Async<a class="headerlink" href="#sb23-xu-ly-su-kien-voi-eventlistener-async" title="Permanent link">&para;</a></h1>
<ul>
<li>Giới thiệu</li>
<li>Cơ bản về Event &amp; Listener</li>
<li>Áp vào thực tế</li>
<li>Event</li>
<li>Event Publisher</li>
<li>Event Listener</li>
<li>Chạy thử 1</li>
<li>@Async</li>
<li>@Async</li>
<li>Chạy thử lần 2</li>
<li>Kết</li>
</ul>
<h3 id="gioi-thieu_3"><strong>Giới thiệu</strong><a class="headerlink" href="#gioi-thieu_3" title="Permanent link">&para;</a></h3>
<p>Hẳn trong <strong>Java</strong> không ít thì nhiều các bạn đã từng sử dụng qua <code>Listener Pattern</code> rồi, nên tôi nghĩ sẽ không giới thiệu về nó nữa.</p>
<p>Trong bài viết này, chúng ta tập trung vào cách làm sao để thực hiện việc tạo ra <code>Event</code> và xử lý <code>Event</code> đó một cách gọn gàng với <strong>Spring Boot</strong>.</p>
<p>Bài này yêu cầu kiến thức cơ bản:</p>
<ol>
<li>「Spring Boot #0」 Series làm chủ Spring Boot, Zero to Hero</li>
</ol>
<h3 id="co-ban-ve-event-listener"><strong>Cơ bản về Event &amp; Listener</strong><a class="headerlink" href="#co-ban-ve-event-listener" title="Permanent link">&para;</a></h3>
<p>!image</p>
<p>Cơ bản là khi chương trình của bạn đang vận hành, và có một công việc gì đó, bạn không muốn xử lý trực tiếp tại Class hiện hành hoặc muốn thông báo cho các Đối tượng khác biết bạn vừa làm gì.</p>
<p>Thì bạn sẽ bắn ra một object gọi là <code>Event</code> (sự kiện), có hoặc không thông tin đi kèm, và nhiệm vụ của các thằng khác là đón lấy hay lắng nghe sự kiện đó để xử lý nghiệp vụ của riêng nó, thằng xử lý gọi là <code>Listener</code>.</p>
<p>Thằng gây ra sự kiện gọi là <code>Source</code>.</p>
<p>Còn thằng cầm sự kiện đó ném cho <code>Listener</code> gọi là <code>Pushlisher</code></p>
<h3 id="ap-vao-thuc-te"><strong>Áp vào thực tế</strong><a class="headerlink" href="#ap-vao-thuc-te" title="Permanent link">&para;</a></h3>
<p>Giả sử bạn có một cái chuông cửa, khi có người tới bấm cái chuông này. Chuông sẽ phát ra tiếng kêu.</p>
<p>Ở trong nhà có chó, nó nghe thấy tiếng kêu, nó sẽ sủa lên.</p>
<p>Thì:</p>
<ul>
<li><code>Source</code>: Người bấm chuông cửa, là người gây ra sự kiện.</li>
<li><code>Event</code>: sự kiện bấm chuông cửa</li>
<li><code>Pushlisher</code>: Cái chuông phát ra âm thanh (sự kiện) để thông báo.</li>
<li><code>Listener</code>: Con chó lắng nghe và xử lý sự kiện</li>
</ul>
<h3 id="event"><strong>Event</strong><a class="headerlink" href="#event" title="Permanent link">&para;</a></h3>
<p>Một <code>Event</code> (sự kiện) muốn được <strong>Spring Boot</strong> hỗ trợ thì sẽ phải kế thừa lớp <code>ApplicationEvent</code>.</p>
<div class="highlight"><pre><span></span><code>/*
DoorBellEvent phải kế thừa lớp ApplicationEvent của Spring
Như vậy nó mới được coi là một sự kiện hợp lệ.
 */
public class DoorBellEvent extends ApplicationEvent {
    /*
        Mọi Class kế thừa ApplicationEvent sẽ
        phải gọi Constructor tới lớp cha.
     */
    public DoorBellEvent(Object source, String guestName) {
        // Object source là object tham chiếu tới
        // nơi đã phát ra event này!
        super(source);
    }
}
</code></pre></div>
<h3 id="event-publisher"><strong>Event Publisher</strong><a class="headerlink" href="#event-publisher" title="Permanent link">&para;</a></h3>
<p>Trong <strong>Spring Boot</strong>, để bắn ra một sự kiện chúng ta sử dụng đối tượng <code>ApplicationEventPublisher</code>. Đây là một <code>Bean</code> có sẵn trong <code>Context</code> do Spring cung cấp, bạn chỉ cần lôi ra sử dụng thôi.</p>
<div class="highlight"><pre><span></span><code>@Component
public class MyHouse {
    @Autowired
    ApplicationEventPublisher applicationEventPublisher;

    /**
     * Hành động bấm chuông cửa
     */
    public void rangDoorbellBy(String guestName) {
        // Phát ra một sự kiện DoorBellEvent
        // source (Nguồn phát ra) chính là class này
        applicationEventPublisher.publishEvent(new DoorBellEvent(this, guestName));
    }
}
</code></pre></div>
<h3 id="event-listener"><strong>Event Listener</strong><a class="headerlink" href="#event-listener" title="Permanent link">&para;</a></h3>
<p>Để lắng nghe các sự kiện do <code>ApplicationEventPublisher</code> bắn ra, chúng ta sử dụng <code>@EventListener</code></p>
<div class="highlight"><pre><span></span><code>// Tạo ra Bean
@Component
public class MyDog {

    /*
        @EventListener sẽ lắng nghe mọi sự kiện xảy ra
        Nếu có một sự kiện DoorBellEvent được bắn ra, nó sẽ đón lấy
        và đưa vào hàm để xử lý
     */
    @EventListener
    public void doorBellEventListener(DoorBellEvent doorBellEvent) throws InterruptedException {
        // Giả sử con chó đang ngủ, 1 giây sau mới dậy
        Thread.sleep(1000);
        // Sự kiện DoorBellEvent được lắng nghe và xử lý tại đây
        System.out.println(Thread.currentThread().getName() + &quot;: Chó ngủ dậy!!!&quot;);
        System.out.println(String.format(&quot;%s: Go go!! Có người tên là %s gõ cửa!!!&quot;, Thread.currentThread().getName(), doorBellEvent.getGuestName()));
    }
}
</code></pre></div>
<p><code>@EventListener</code> gắn trên một method, với tham số đầu vào chính là sự kiện mà bạn muốn lắng nghe.</p>
<p>Lưu ý: Class chịu trách nhiệm xử lý, có chứa method <code>@EventListener</code> cũng phải là Bean nhé.</p>
<h3 id="chay-thu-1"><strong>Chạy thử 1</strong><a class="headerlink" href="#chay-thu-1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>@SpringBootApplication
public class App {
    @Autowired
    MyHouse myHouse;

    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }

    @Bean
    CommandLineRunner run() {
        return args -&gt; {
            System.out.println(Thread.currentThread().getName() + &quot;: Loda đi tới cửa nhà !!!&quot;);
            System.out.println(Thread.currentThread().getName() + &quot;: =&gt; Loda bấm chuông và khai báo họ tên!&quot;);
            // gõ cửa
            myHouse.rangDoorbellBy(&quot;Loda&quot;);
            System.out.println(Thread.currentThread().getName() +&quot;: Loda quay lưng bỏ đi&quot;);
        };
    }

}
</code></pre></div>
<p>OUTPUT:</p>
<div class="highlight"><pre><span></span><code>restartedMain: Loda đi tới cửa nhà !!!
restartedMain: =&gt; Loda bấm chuông và khai báo họ tên!
restartedMain: Chó ngủ dậy!!!
restartedMain: Go go!! Có người tên là Loda gõ cửa!!!
restartedMain: Loda quay lưng bỏ đi
</code></pre></div>
<p>Bạn sẽ thấy quá trình xử lý ở đây xảy ra một cách <strong>tuần tự</strong> và đồng bộ (Synchronous).</p>
<p>Vậy là chúng ta có thể hiểu:</p>
<blockquote>
<p>nếu không cấu hình gì thêm, ApplicationEvent và @EventListener là Synchronous.</p>
</blockquote>
<p>Chương trình sẽ phải chờ sự kiện xử lý xong thì mới được chạy tiếp.</p>
<h3 id="async"><strong>@Async</strong><a class="headerlink" href="#async" title="Permanent link">&para;</a></h3>
<p>Đa phần, xử lý Synchronous không phải điều mà chúng ta mong đợi, chúng ta muốn việc xử lý sự kiện có thể hoạt động riêng và không ảnh hưởng tới luồng làm việc chính.</p>
<p>Nói cách khác, chúng ta muốn sự kiện được xử lý ở một Thread khác, đây gọi là <strong>bất đồng bộ (Asynchronous)</strong></p>
<p>Để làm được điều này, chúng ta cần kích hoạt chức năng xử lý bất đồng bộ của <strong>Spring Boot</strong>, bằng cách bổ sung annotation <code>@EnableAsync</code>.</p>
<div class="highlight"><pre><span></span><code>@Configuration
@EnableAsync
public class ListenerConfiguration {
    /**
     * Tạo ra Executor cho Async
     * @return
     */
    @Bean
    TaskExecutor taskExecutor() {
        return new SimpleAsyncTaskExecutor();
    }
}
</code></pre></div>
<p><strong>Spring Boot</strong> khi thấy Annotation này, sẽ kích hoạt cho phép xử lý sự kiện dưới dạng Async</p>
<p>các <code>Event</code> sẽ được gửi vào một <code>Executor</code> (đơn giản nhất là <code>SimpleAsyncTaskExecutor</code>) và chờ được xử lý.</p>
<p>Nếu chưa biết <code>Executor</code> là gì, bạn có thể đọc 2 bài viết sau:</p>
<ol>
<li>Khái niệm ThreadPool và Executor trong Java</li>
<li>ThreadPoolExecutor và nguyên tắc quản lý pool size</li>
</ol>
<h3 id="async_1"><strong>@Async</strong><a class="headerlink" href="#async_1" title="Permanent link">&para;</a></h3>
<p>Sau khi kích hoạt tính năng <code>Async</code>, bất kỳ sự kiện nào bạn muốn nó xử lý Async thì hãy đánh dấu nó bởi <code>@Async</code>.</p>
<div class="highlight"><pre><span></span><code>@Component
public class MyDog {

    /*
        @EventListener sẽ lắng nghe mọi sự kiện xảy ra
        Nếu có một sự kiện DoorBellEvent được bắn ra, nó sẽ đón lấy
        và đưa vào hàm để xử lý
     */
    /*
        @Async là cách lắng nghe sự kiện ở một Thread khác, không ảnh hưởng tới
        luồng chính
     */
    @Async
    @EventListener
    public void doorBellEventListener(DoorBellEvent doorBellEvent) throws InterruptedException {
        // Giả sử con chó đang ngủ, 1 giây sau mới dậy
        Thread.sleep(1000);
        // Sự kiện DoorBellEvent được lắng nghe và xử lý tại đây
        System.out.println(&quot;Chó ngủ dậy!!!&quot;);
        System.out.println(String.format(&quot;Go go!! Có người tên là %s gõ cửa!!!&quot;, doorBellEvent.getGuestName()));
    }
}
</code></pre></div>
<h3 id="chay-thu-lan-2"><strong>Chạy thử lần 2</strong><a class="headerlink" href="#chay-thu-lan-2" title="Permanent link">&para;</a></h3>
<p>OUTPUT:</p>
<div class="highlight"><pre><span></span><code>restartedMain: Loda đi tới cửa nhà !!!
restartedMain: =&gt; Loda bấm chuông và khai báo họ tên!
restartedMain: Loda quay lưng bỏ đi
SimpleAsyncTaskExecutor-1: Chó ngủ dậy!!!
SimpleAsyncTaskExecutor-1: Go go!! Có người tên là Loda gõ cửa!!!
</code></pre></div>
<p>Lần này quá trình xử lý đã diễn ra đúng như chúng ta mong đợi, người bấm cứ bấm, mà chó kêu cứ kêu, mỗi người một việc, chả ai ảnh hưởng tới ai, chỉ cần biết có sự kiện xảy ra thì phản ứng là được.</p>
<h3 id="ket_5"><strong>Kết</strong><a class="headerlink" href="#ket_5" title="Permanent link">&para;</a></h3>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h1 id="sb24-restful-api-document-tao-voi-spring-boot-swagger">[SB24] RESTful API Document Tạo với Spring Boot + Swagger<a class="headerlink" href="#sb24-restful-api-document-tao-voi-spring-boot-swagger" title="Permanent link">&para;</a></h1>
<ul>
<li>Giới thiệu</li>
<li>cài đặt</li>
<li>Tổng quan Swagger</li>
<li>Prepare</li>
<li>Config Swagger</li>
<li>Góc custom</li>
</ul>
<h3 id="gioi-thieu_4"><strong>Giới thiệu</strong><a class="headerlink" href="#gioi-thieu_4" title="Permanent link">&para;</a></h3>
<p><strong>Spring Boot</strong> hỗ trợ chúng ta tạo ra RESTful API một cách nhanh chóng và tiện lợi, giúp sản phẩm được vận hành nhanh nhất có thể.</p>
<p>Tuy nhiên, Việc deploy nhanh chóng một services không đồng nghĩa với việc nó có thể sử dụng được. Thông thường, tất cả các API sau khi được đưa lên sẽ phải đi kèm với document mô tả, để bất kì ai sử dụng đến thì có thể tra cứu.</p>
<p>Thật không may là việc làm document chưa bao giờ là dễ dàng cả :(( từ lí do này, <code>Swagger</code> ra đời để giúp chúng ta mô tả tài liệu dự án một cách nhanh chóng bằng annotation.</p>
<p>Trong bài có đề cập các kiến thức:</p>
<ol>
<li>Spring Boot</li>
<li>jpa</li>
<li>lombok</li>
</ol>
<h3 id="cai-at_3"><strong>cài đặt</strong><a class="headerlink" href="#cai-at_3" title="Permanent link">&para;</a></h3>
<p>Trong bài này, tôi sẽ hướng dẫn các bạn sử dụng <code>Swagger2</code> và tuân theo các quy tắc cảu <strong>Swagger Specification 2.0</strong> nhé.</p>
<p>Tại thời điểm viết bài này, hiện phiên bản mới nhất là 3, tuy nhiên, nó sẽ là <strong>OpenAPI 3.0</strong>.</p>
<p><em>pom.xml</em></p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;projectxmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&lt;parent&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&lt;version&gt;2.0.5.RELEASE&lt;/version&gt;&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;&lt;groupId&gt;me.loda.spring&lt;/groupId&gt;&lt;artifactId&gt;example-independent-maven-spring-project&lt;/artifactId&gt;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;name&gt;example-independent-maven-spring-project&lt;/name&gt;&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;&lt;properties&gt;&lt;java.version&gt;1.8&lt;/java.version&gt;&lt;/properties&gt;&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;&lt;scope&gt;runtime&lt;/scope&gt;&lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;

        &lt;dependency&gt;&lt;groupId&gt;io.springfox&lt;/groupId&gt;&lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;&lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;io.springfox&lt;/groupId&gt;&lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;&lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;!--spring jpa--&gt;
        &lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--in memory database--&gt;
        &lt;dependency&gt;&lt;groupId&gt;com.h2database&lt;/groupId&gt;&lt;artifactId&gt;h2&lt;/artifactId&gt;&lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;/dependencies&gt;&lt;build&gt;&lt;plugins&gt;&lt;plugin&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&lt;/plugin&gt;&lt;/plugins&gt;&lt;/build&gt;&lt;/project&gt;
</code></pre></div>
<p><code>springfox</code> là một thư viện java implementation của Swagger Specification.</p>
<p><code>springfox-swagger2</code> chứa core của swagger, giúp chúng ta khai báo document cho api.</p>
<p><code>springfox-swagger-ui</code> giúp chúng ta biểu diễn tài liệu dưới dạng web view, dễ nhìn và test.</p>
<h3 id="tong-quan-swagger"><strong>Tổng quan Swagger</strong><a class="headerlink" href="#tong-quan-swagger" title="Permanent link">&para;</a></h3>
<p>Để sử dụng cơ bản thì <code>Swagger</code> cung cấp một số các Annotations hữu ích sau:</p>
<p>Chúng ta đi vào thực hành thử nhé.</p>
<p>Đại loại sau khi làm xong, chúng ta sẽ có 1 web view document như thế này:</p>
<p>!image</p>
<h3 id="prepare_1"><strong>Prepare</strong><a class="headerlink" href="#prepare_1" title="Permanent link">&para;</a></h3>
<p>Tạo ra class Model</p>
<p><em>User.java</em></p>
<div class="highlight"><pre><span></span><code>@Data
@Entity
@Table
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String firstName;
    private String lastName;
    private String email;
}
</code></pre></div>
<p><em>UserRepository.java</em></p>
<div class="highlight"><pre><span></span><code>@Repository
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {

}
</code></pre></div>
<p>Khi đã có được Model và Repository, chúng ta sẽ tạo Controller để thao tác liên quan tới <code>User</code> nhé.</p>
<div class="highlight"><pre><span></span><code>@RestController
@RequestMapping(&quot;/api/v1&quot;)
@RequiredArgsConstructor
public class UserController {
    private final UserRepository userRepository;

    @GetMapping(&quot;/users&quot;)
    public List&lt;User&gt; getAllUsers() {
        return userRepository.findAll();
    }

    @GetMapping(&quot;/users/{id}&quot;)
    public User getUser(@PathVariable(&quot;id&quot;) Long id) {
        return userRepository.findById(id).orElse(new User());
    }

    @PostMapping(&quot;/users&quot;)
    public User createUser(@Valid @RequestBody User user) {
        return userRepository.save(user);
    }

    @PutMapping(&quot;/users/{id}&quot;)
    public User updateUser(@PathVariable(&quot;id&quot;) Long id, @Valid @RequestBody User user) {
        user.setId(id);
        return userRepository.save(user);
    }

    @DeleteMapping(&quot;/users/{id}&quot;)
    public void deleteUser(@PathVariable(&quot;id&quot;) Long id) {
        userRepository.deleteById(id);
    }
}
</code></pre></div>
<p>Âu khê, tạm thời như thế đã 😂</p>
<p>Bây giờ vào phần chính, config <code>Swagger</code> cho dự án của chúng ta.</p>
<h3 id="config-swagger"><strong>Config Swagger</strong><a class="headerlink" href="#config-swagger" title="Permanent link">&para;</a></h3>
<p>Thật may mắn, trước khi đi vào các custom phức tạp thì Swagger hỗ trợ chúng ta tự động sinh ra tài liệu một cách mặc định mà chưa cần phải khai báo bất kì annotation nào đã giới thiệu ở trên.</p>
<p>Chỉ cần tạo ra đối tượng <code>Docket</code> của <code>Swagger</code> và nó sẽ quét hết các địa chỉ API mà bạn chỉ định, rồi tự động sinh ra tài liệu cơ bản cho chúng ta.</p>
<div class="highlight"><pre><span></span><code>@Configuration
@EnableSwagger2
public class Swagger2Config {
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2).select()
                                                      .apis(RequestHandlerSelectors.basePackage(&quot;me.loda.spring.swagger.controller&quot;))
                                                      .paths(PathSelectors.regex(&quot;/.*&quot;))
                                                      .build()
                                                      .apiInfo(apiEndPointsInfo());
    }

    private ApiInfo apiEndPointsInfo() {
        return new ApiInfoBuilder().title(&quot;Spring Boot REST API&quot;)
                                   .description(&quot;Employee Management REST API&quot;)
                                   .contact(new Contact(&quot;loda&quot;, &quot;https://loda.me/&quot;, &quot;loda.namnh@gmail.com&quot;))
                                   .license(&quot;Apache 2.0&quot;)
                                   .licenseUrl(&quot;http://www.apache.org/licenses/LICENSE-2.0.html&quot;)
                                   .version(&quot;1.0.0&quot;)
                                   .build();
    }
}
</code></pre></div>
<p>Các thứ cần lưu ý bao gồm:</p>
<ol>
<li>Để <code>Swagger</code> hoạt động, bạn nhớ kích hoạt nó bằng <code>@EnableSwagger2</code>.</li>
<li>Bạn có thể chọn nơi chứa các API bằng <code>RequestHandlerSelectors</code>. Nếu muốn quét hết cả project, có thể xài <code>RequestHandlerSelectors.any()</code></li>
<li>Bạn có thể chỉ định bộ lọc cho các api bằng <code>PathSelectors</code>. Nếu muốn quét tất cả, chọn <code>PathSelectors.any()</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code>@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
</code></pre></div>
<p>Bây giờ, chạy thử và vào địa chỉ <code>http://localhost:8080/swagger-ui.html</code> để xem thành quả nhé.</p>
<h3 id="goc-custom"><strong>Góc custom</strong><a class="headerlink" href="#goc-custom" title="Permanent link">&para;</a></h3>
<p>Bạn có thể chỉ định rõ hơn các mô tả của tài liệu bằng cách sử dụng các Annotation mà <code>Swagger</code> cung cấp.</p>
<p><em>User.java</em></p>
<div class="highlight"><pre><span></span><code>@Data
@Entity
@Table
@NoArgsConstructor
@AllArgsConstructor
@ApiModel(value = &quot;User model&quot;)
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @ApiModelProperty(notes = &quot;The database generated User ID&quot;)
    private Long id;

    private String firstName;
    private String lastName;
    private String email;
}
</code></pre></div>
<p><em>UserController.java</em></p>
<div class="highlight"><pre><span></span><code>@RestController
@RequestMapping(&quot;/api/v1&quot;)
@RequiredArgsConstructor
@Api(value = &quot;User APIs&quot;)
public class UserController {
    private final UserRepository userRepository;

    @ApiOperation(value = &quot;Xem danh sách User&quot;, response = List.class)
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = &quot;Thành công&quot;),
            @ApiResponse(code = 401, message = &quot;Chưa xác thực&quot;),
            @ApiResponse(code = 403, message = &quot;Truy cập bị cấm&quot;),
            @ApiResponse(code = 404, message = &quot;Không tìm thấy&quot;)
    })
    @GetMapping(&quot;/users&quot;)
    public List&lt;User&gt; getAllUsers() {
        return userRepository.findAll();
    }

    @GetMapping(&quot;/users/{id}&quot;)
    public User getUser(@PathVariable(&quot;id&quot;) Long id) {
        return userRepository.findById(id).orElse(new User());
    }

    @PostMapping(&quot;/users&quot;)
    public User createUser(
            @ApiParam(value = &quot;Đối tượng User cần tạo mới&quot;, required = true) @Valid @RequestBody User user
    ) {
        return userRepository.save(user);
    }

    @PutMapping(&quot;/users/{id}&quot;)
    public User updateUser(@PathVariable(&quot;id&quot;) Long id, @Valid @RequestBody User user) {
        user.setId(id);
        return userRepository.save(user);
    }

    @DeleteMapping(&quot;/users/{id}&quot;)
    public void deleteUser(@PathVariable(&quot;id&quot;) Long id) {
        userRepository.deleteById(id);
    }
}
</code></pre></div>
<p>Tới đây bạn có thể sử dụng Swagger thoải mái rồi, tôi sẽ làm một bài khác về <strong>OpenAPI 3.0</strong>.</p>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>
<h1 id="sb25-restful-api-document-voi-spring-boot-openapi-30">[SB25] RESTful API Document với Spring Boot + OpenApi 3.0<a class="headerlink" href="#sb25-restful-api-document-voi-spring-boot-openapi-30" title="Permanent link">&para;</a></h1>
<ul>
<li>Giới thiệu</li>
<li>cài đặt</li>
<li>Tổng quan OpenApi 3.0</li>
<li>Prepare</li>
<li>Config OpenApi 3.0</li>
<li>Kết</li>
</ul>
<h3 id="gioi-thieu_5"><strong>Giới thiệu</strong><a class="headerlink" href="#gioi-thieu_5" title="Permanent link">&para;</a></h3>
<p>Trong bài viết trước:</p>
<ol>
<li>RESTful API Document Tạo với Spring Boot + Swagger</li>
</ol>
<p>Tôi đã giới thiệu lí do vì sao cần Document, và cách tạo ra nó nhanh chóng với <code>Swagger 2</code>.</p>
<p>Trong bài này, tôi sẽ giới thiệu thêm phiên bản tiếp theo, một tiêu chuẩn mới nhất về RESTful document đó là OpenApi 3.0.</p>
<p>Tại sao k đặt tên là <code>Swagger 3</code>? câu chuyện đằng sau nó là việc SmartBear mua lại Swagger, và đổi tên Swagger Specification thành OpenApi Specification, bắt đầu tạo ra các tiêu chuẩn mới cho xây dựng Document, tuy nhiên vẫn xây dựng trên Swagger core.</p>
<p><code>OpenApi 3.0</code> là bản mới nhất được ra mắt tại thời điểm viết bài này.</p>
<p>Trong bài có đề cập các kiến thức:</p>
<ol>
<li>Spring Boot</li>
<li>jpa</li>
<li>lombok</li>
</ol>
<h3 id="cai-at_4"><strong>cài đặt</strong><a class="headerlink" href="#cai-at_4" title="Permanent link">&para;</a></h3>
<p><em>pom.xml</em></p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;projectxmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&lt;parent&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&lt;version&gt;2.0.5.RELEASE&lt;/version&gt;&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;&lt;groupId&gt;me.loda.spring&lt;/groupId&gt;&lt;artifactId&gt;example-independent-maven-spring-project&lt;/artifactId&gt;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;name&gt;example-independent-maven-spring-project&lt;/name&gt;&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;&lt;properties&gt;&lt;java.version&gt;1.8&lt;/java.version&gt;&lt;/properties&gt;&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;&lt;scope&gt;runtime&lt;/scope&gt;&lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;!--https://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-core --&gt;
        &lt;dependency&gt;&lt;groupId&gt;org.springdoc&lt;/groupId&gt;&lt;artifactId&gt;springdoc-openapi-core&lt;/artifactId&gt;&lt;version&gt;1.1.49&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springdoc&lt;/groupId&gt;&lt;artifactId&gt;springdoc-openapi-ui&lt;/artifactId&gt;&lt;version&gt;1.1.49&lt;/version&gt;&lt;/dependency&gt;&lt;!--spring jpa--&gt;
        &lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--in memory database--&gt;
        &lt;dependency&gt;&lt;groupId&gt;com.h2database&lt;/groupId&gt;&lt;artifactId&gt;h2&lt;/artifactId&gt;&lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;/dependencies&gt;&lt;build&gt;&lt;plugins&gt;&lt;plugin&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&lt;/plugin&gt;&lt;/plugins&gt;&lt;/build&gt;&lt;/project&gt;
</code></pre></div>
<p><code>springdoc</code> là một thư viện java implementation của OpenApi Specification 3.0.</p>
<p><code>springdoc-openapi-core</code> chứa core của swagger, giúp chúng ta khai báo document cho api.</p>
<p><code>springdoc-openapi-ui</code> giúp chúng ta biểu diễn tài liệu dưới dạng web view, dễ nhìn và test.</p>
<h3 id="tong-quan-openapi-30"><strong>Tổng quan OpenApi 3.0</strong><a class="headerlink" href="#tong-quan-openapi-30" title="Permanent link">&para;</a></h3>
<p><code>OpenApi 3.0</code> kế thừa và đổi mới khá nhiều các thành phần của <code>Swagger2</code>, khiến nó tường minh và dễ đọc hơn.</p>
<p>SWAGGER2OPENAPI 3.0DESCRIPTION@Api</p>
<p>@Tag</p>
<p>Đánh dấu 1 class là nơi chứa các API</p>
<p>@ApiModel</p>
<p>không còn</p>
<p>Đánh dấu 1 class là Swagger Model</p>
<p>@ApiModelProperty</p>
<p>@Schema</p>
<p>Bổ sung các thông tin cho</p>
<p>@ApiOperation</p>
<p>@Operation</p>
<p>Mô tả cho một API và response của nó</p>
<p>@ApiParam</p>
<p>@Parameter</p>
<p>Mô tả các parameter</p>
<p>@ApiResponse</p>
<p>@ApiResponse</p>
<p>Mô tả status code của response</p>
<p>@ApiResponses</p>
<p>@ApiResponses</p>
<p>Mô tả danh sách các status code của response</p>
<p>Chúng ta đi vào thực hành thử nhé.</p>
<p>Đại loại sau khi làm xong, chúng ta sẽ có 1 web view document như thế này:</p>
<p>!image</p>
<p>Ngoài đẹp hơn, mô tả chi tiết và dễ sử dụng hơn, thì có 1 phần rất hay, đó là chúng ta có thể chọn Server Url khi test API</p>
<p>!image</p>
<h3 id="prepare_2"><strong>Prepare</strong><a class="headerlink" href="#prepare_2" title="Permanent link">&para;</a></h3>
<p>Tạo ra class Model</p>
<p><em>User.java</em></p>
<div class="highlight"><pre><span></span><code>@Data
@Entity
@Table
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Schema(description = &quot;User UUID in  the database&quot;)
    @JsonProperty(&quot;id&quot;)
    private Long id;

    private @NotBlank @Size(min = 0, max = 20) String firstName;
    private String lastName;

    private @NotBlank @Size(min = 0, max = 50) String email;
}
</code></pre></div>
<p><em>UserRepository.java</em></p>
<div class="highlight"><pre><span></span><code>@Repository
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {

}
</code></pre></div>
<p>Khi đã có được Model và Repository, chúng ta sẽ tạo Controller để thao tác liên quan tới <code>User</code> nhé.</p>
<p>Điểm khác biệt lớn nhất của <code>OpenApi3</code> so với <code>Swagger2</code> là hệ thống Annotation rất là dày đặc, đa phần các giá trị được biểu diễn và ăn khớp với nhau bằng Annotation và Class.</p>
<div class="highlight"><pre><span></span><code>@RestController
@RequestMapping(&quot;/api/v1&quot;)
@RequiredArgsConstructor
@Tag(name = &quot;user&quot;)
public class UserController {
    private final UserRepository userRepository;

    @Operation(description = &quot;Xem danh sách User&quot;, responses = {
            @ApiResponse(content = @Content(array = @ArraySchema(schema = @Schema(implementation = User.class))), responseCode = &quot;200&quot;) })
    @ApiResponses(value = {
            @ApiResponse(responseCode  = &quot;200&quot;, description = &quot;Thành công&quot;),
            @ApiResponse(responseCode  = &quot;401&quot;, description = &quot;Chưa xác thực&quot;),
            @ApiResponse(responseCode  = &quot;403&quot;, description = &quot;Truy cập bị cấm&quot;),
            @ApiResponse(responseCode  = &quot;404&quot;, description = &quot;Không tìm thấy&quot;)
    })
    @GetMapping(&quot;/users&quot;)
    public List&lt;User&gt; getAllUsers() {
        return userRepository.findAll();
    }

    @GetMapping(&quot;/users/{id}&quot;)
    public User getUser(@PathVariable(&quot;id&quot;) Long id) {
        return userRepository.findById(id).orElse(new User());
    }

    @PostMapping(&quot;/users&quot;)
    public User createUser(
            @Valid
            @Parameter(description = &quot;User model to create.&quot;, required = true, schema = @Schema(implementation = User.class))
            @RequestBody User user) {
        return userRepository.save(user);
    }

    @PutMapping(&quot;/users/{id}&quot;)
    public User updateUser(@PathVariable(&quot;id&quot;) Long id, @Valid @RequestBody User user) {
        user.setId(id);
        return userRepository.save(user);
    }

    @DeleteMapping(&quot;/users/{id}&quot;)
    public void deleteUser(@PathVariable(&quot;id&quot;) Long id) {
        userRepository.deleteById(id);
    }
}
</code></pre></div>
<p>Âu khê, Chỉ cần như vậy là chạy được rồi.</p>
<p>Nếu đầy đủ hơn, thì bạn nên config <code>OpenApi</code> cho dự án của chúng ta để bổ sung các thông tin tổng quan.</p>
<h3 id="config-openapi-30"><strong>Config OpenApi 3.0</strong><a class="headerlink" href="#config-openapi-30" title="Permanent link">&para;</a></h3>
<p>Chỉ cần tạo ra đối tượng <code>OpenAPI</code> và cung cấp các thông tin cần thiết.</p>
<div class="highlight"><pre><span></span><code>@Configuration
public class OpenApiConfig {
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                // Thiết lập các server dùng để test api
                .servers(Lists.newArrayList(
                        new Server().url(&quot;http://localhost:8080&quot;),
                        new Server().url(&quot;https://user.loda.me&quot;)
                ))
                // info
                .info(new Info().title(&quot;Loda Application API&quot;)
                                .description(&quot;Sample OpenAPI 3.0&quot;)
                                .contact(new Contact()
                                                 .email(&quot;loda.namnh@gmail.com&quot;)
                                                 .name(&quot;loda&quot;)
                                                 .url(&quot;https://loda.me/&quot;))
                                .license(new License()
                                                 .name(&quot;Apache 2.0&quot;)
                                                 .url(&quot;http://www.apache.org/licenses/LICENSE-2.0.html&quot;))
                                .version(&quot;1.0.0&quot;));
    }
}
</code></pre></div>
<p><code>OpenApi3.0</code> thì bạn không cần <code>@Enable</code> mà chỉ cần add <code>springdoc-openapi-core</code> vào dependencies thôi là nó tự động gen ra tài liệu rồi.</p>
<div class="highlight"><pre><span></span><code>@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
</code></pre></div>
<p>Bây giờ, chạy thử và vào địa chỉ <code>http://localhost:8080/swagger-ui.html</code> để xem thành quả nhé.</p>
<h3 id="ket_6"><strong>Kết</strong><a class="headerlink" href="#ket_6" title="Permanent link">&para;</a></h3>
<p>Tới đây bạn có thể sử dụng <strong>OpenAPI 3.0</strong> thoải mái rồi.</p>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "search.suggest", "search.highlighting", "search.share"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>