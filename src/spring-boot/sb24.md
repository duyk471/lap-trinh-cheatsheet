[SB24] RESTful API Document Táº¡o vá»›i Spring Boot + Swagger
=============================================================

- Giá»›i thiá»‡u
- cÃ i Ä‘áº·t
- Tá»•ng quan Swagger
- Prepare
- Config Swagger
- GÃ³c custom

### **Giá»›i thiá»‡u**

**Spring Boot**Â há»— trá»£ chÃºng ta táº¡o ra RESTful API má»™t cÃ¡ch nhanh chÃ³ng vÃ  tiá»‡n lá»£i, giÃºp sáº£n pháº©m Ä‘Æ°á»£c váº­n hÃ nh nhanh nháº¥t cÃ³ thá»ƒ.

Tuy nhiÃªn, Viá»‡c deploy nhanh chÃ³ng má»™t services khÃ´ng Ä‘á»“ng nghÄ©a vá»›i viá»‡c nÃ³ cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c. ThÃ´ng thÆ°á»ng, táº¥t cáº£ cÃ¡c API sau khi Ä‘Æ°á»£c Ä‘Æ°a lÃªn sáº½ pháº£i Ä‘i kÃ¨m vá»›i document mÃ´ táº£, Ä‘á»ƒ báº¥t kÃ¬ ai sá»­ dá»¥ng Ä‘áº¿n thÃ¬ cÃ³ thá»ƒ tra cá»©u.

Tháº­t khÃ´ng may lÃ  viá»‡c lÃ m document chÆ°a bao giá» lÃ  dá»… dÃ ng cáº£ :(( tá»« lÃ­ do nÃ y,Â `Swagger`Â ra Ä‘á»i Ä‘á»ƒ giÃºp chÃºng ta mÃ´ táº£ tÃ i liá»‡u dá»± Ã¡n má»™t cÃ¡ch nhanh chÃ³ng báº±ng annotation.

Trong bÃ i cÃ³ Ä‘á» cáº­p cÃ¡c kiáº¿n thá»©c:

1. Spring Boot
2. jpa
3. lombok

### **cÃ i Ä‘áº·t**

Trong bÃ i nÃ y, tÃ´i sáº½ hÆ°á»›ng dáº«n cÃ¡c báº¡n sá»­ dá»¥ngÂ `Swagger2`Â vÃ  tuÃ¢n theo cÃ¡c quy táº¯c cáº£uÂ **Swagger Specification 2.0**Â nhÃ©.

Táº¡i thá»i Ä‘iá»ƒm viáº¿t bÃ i nÃ y, hiá»‡n phiÃªn báº£n má»›i nháº¥t lÃ  3, tuy nhiÃªn, nÃ³ sáº½ lÃ Â **OpenAPI 3.0**.

_pom.xml_

```
<?xml version="1.0" encoding="UTF-8"?>
<projectxmlns="http://maven.apache.org/POM/4.0.0"xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"xsi:schemaLocation="http://maven.apache.org/POM/4.0.0https://maven.apache.org/xsd/maven-4.0.0.xsd"><modelVersion>4.0.0</modelVersion><parent><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-parent</artifactId><version>2.0.5.RELEASE</version><relativePath/> <!-- lookup parent from repository -->
	</parent><groupId>me.loda.spring</groupId><artifactId>example-independent-maven-spring-project</artifactId><version>0.0.1-SNAPSHOT</version><name>example-independent-maven-spring-project</name><description>Demo project for Spring Boot</description><properties><java.version>1.8</java.version></properties><dependencies><dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-web</artifactId></dependency><dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-devtools</artifactId><scope>runtime</scope><optional>true</optional></dependency><dependency><groupId>org.projectlombok</groupId><artifactId>lombok</artifactId><optional>true</optional></dependency><dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-test</artifactId><scope>test</scope></dependency>

		<dependency><groupId>io.springfox</groupId><artifactId>springfox-swagger2</artifactId><version>2.9.2</version></dependency><dependency><groupId>io.springfox</groupId><artifactId>springfox-swagger-ui</artifactId><version>2.9.2</version></dependency><!--spring jpa-->
		<dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-data-jpa</artifactId></dependency><!--in memory database-->
		<dependency><groupId>com.h2database</groupId><artifactId>h2</artifactId><scope>runtime</scope></dependency></dependencies><build><plugins><plugin><groupId>org.springframework.boot</groupId><artifactId>spring-boot-maven-plugin</artifactId></plugin></plugins></build></project>
```

`springfox`Â lÃ  má»™t thÆ° viá»‡n java implementation cá»§a Swagger Specification.

`springfox-swagger2`Â chá»©a core cá»§a swagger, giÃºp chÃºng ta khai bÃ¡o document cho api.

`springfox-swagger-ui`Â giÃºp chÃºng ta biá»ƒu diá»…n tÃ i liá»‡u dÆ°á»›i dáº¡ng web view, dá»… nhÃ¬n vÃ  test.

### **Tá»•ng quan Swagger**

Äá»ƒ sá»­ dá»¥ng cÆ¡ báº£n thÃ¬Â `Swagger`Â cung cáº¥p má»™t sá»‘ cÃ¡c Annotations há»¯u Ã­ch sau:

ChÃºng ta Ä‘i vÃ o thá»±c hÃ nh thá»­ nhÃ©.

Äáº¡i loáº¡i sau khi lÃ m xong, chÃºng ta sáº½ cÃ³ 1 web view document nhÆ° tháº¿ nÃ y:

!image

### **Prepare**

Táº¡o ra class Model

_User.java_

```
@Data
@Entity
@Table
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String firstName;
    private String lastName;
    private String email;
}
```

_UserRepository.java_

```
@Repository
public interface UserRepository extends JpaRepository<User, Long> {

}
```

Khi Ä‘Ã£ cÃ³ Ä‘Æ°á»£c Model vÃ  Repository, chÃºng ta sáº½ táº¡o Controller Ä‘á»ƒ thao tÃ¡c liÃªn quan tá»›iÂ `User`Â nhÃ©.

```
@RestController
@RequestMapping("/api/v1")
@RequiredArgsConstructor
public class UserController {
    private final UserRepository userRepository;

    @GetMapping("/users")
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }

    @GetMapping("/users/{id}")
    public User getUser(@PathVariable("id") Long id) {
        return userRepository.findById(id).orElse(new User());
    }

    @PostMapping("/users")
    public User createUser(@Valid @RequestBody User user) {
        return userRepository.save(user);
    }

    @PutMapping("/users/{id}")
    public User updateUser(@PathVariable("id") Long id, @Valid @RequestBody User user) {
        user.setId(id);
        return userRepository.save(user);
    }

    @DeleteMapping("/users/{id}")
    public void deleteUser(@PathVariable("id") Long id) {
        userRepository.deleteById(id);
    }
}
```

Ã‚u khÃª, táº¡m thá»i nhÆ° tháº¿ Ä‘Ã£ ğŸ˜‚

BÃ¢y giá» vÃ o pháº§n chÃ­nh, configÂ `Swagger`Â cho dá»± Ã¡n cá»§a chÃºng ta.

### **Config Swagger**

Tháº­t may máº¯n, trÆ°á»›c khi Ä‘i vÃ o cÃ¡c custom phá»©c táº¡p thÃ¬ Swagger há»— trá»£ chÃºng ta tá»± Ä‘á»™ng sinh ra tÃ i liá»‡u má»™t cÃ¡ch máº·c Ä‘á»‹nh mÃ  chÆ°a cáº§n pháº£i khai bÃ¡o báº¥t kÃ¬ annotation nÃ o Ä‘Ã£ giá»›i thiá»‡u á»Ÿ trÃªn.

Chá»‰ cáº§n táº¡o ra Ä‘á»‘i tÆ°á»£ngÂ `Docket`Â cá»§aÂ `Swagger`Â vÃ  nÃ³ sáº½ quÃ©t háº¿t cÃ¡c Ä‘á»‹a chá»‰ API mÃ  báº¡n chá»‰ Ä‘á»‹nh, rá»“i tá»± Ä‘á»™ng sinh ra tÃ i liá»‡u cÆ¡ báº£n cho chÃºng ta.

```
@Configuration
@EnableSwagger2
public class Swagger2Config {
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2).select()
                                                      .apis(RequestHandlerSelectors.basePackage("me.loda.spring.swagger.controller"))
                                                      .paths(PathSelectors.regex("/.*"))
                                                      .build()
                                                      .apiInfo(apiEndPointsInfo());
    }

    private ApiInfo apiEndPointsInfo() {
        return new ApiInfoBuilder().title("Spring Boot REST API")
                                   .description("Employee Management REST API")
                                   .contact(new Contact("loda", "https://loda.me/", "loda.namnh@gmail.com"))
                                   .license("Apache 2.0")
                                   .licenseUrl("http://www.apache.org/licenses/LICENSE-2.0.html")
                                   .version("1.0.0")
                                   .build();
    }
}
```

CÃ¡c thá»© cáº§n lÆ°u Ã½ bao gá»“m:

1. Äá»ƒÂ `Swagger`Â hoáº¡t Ä‘á»™ng, báº¡n nhá»› kÃ­ch hoáº¡t nÃ³ báº±ngÂ `@EnableSwagger2`.
2. Báº¡n cÃ³ thá»ƒ chá»n nÆ¡i chá»©a cÃ¡c API báº±ngÂ `RequestHandlerSelectors`. Náº¿u muá»‘n quÃ©t háº¿t cáº£ project, cÃ³ thá»ƒ xÃ iÂ `RequestHandlerSelectors.any()`
3. Báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh bá»™ lá»c cho cÃ¡c api báº±ngÂ `PathSelectors`. Náº¿u muá»‘n quÃ©t táº¥t cáº£, chá»nÂ `PathSelectors.any()`.

```
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

BÃ¢y giá», cháº¡y thá»­ vÃ  vÃ o Ä‘á»‹a chá»‰Â `http://localhost:8080/swagger-ui.html`Â Ä‘á»ƒ xem thÃ nh quáº£ nhÃ©.

### **GÃ³c custom**

Báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh rÃµ hÆ¡n cÃ¡c mÃ´ táº£ cá»§a tÃ i liá»‡u báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c Annotation mÃ Â `Swagger`Â cung cáº¥p.

_User.java_

```
@Data
@Entity
@Table
@NoArgsConstructor
@AllArgsConstructor
@ApiModel(value = "User model")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @ApiModelProperty(notes = "The database generated User ID")
    private Long id;

    private String firstName;
    private String lastName;
    private String email;
}
```

_UserController.java_

```
@RestController
@RequestMapping("/api/v1")
@RequiredArgsConstructor
@Api(value = "User APIs")
public class UserController {
    private final UserRepository userRepository;

    @ApiOperation(value = "Xem danh sÃ¡ch User", response = List.class)
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = "ThÃ nh cÃ´ng"),
            @ApiResponse(code = 401, message = "ChÆ°a xÃ¡c thá»±c"),
            @ApiResponse(code = 403, message = "Truy cáº­p bá»‹ cáº¥m"),
            @ApiResponse(code = 404, message = "KhÃ´ng tÃ¬m tháº¥y")
    })
    @GetMapping("/users")
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }

    @GetMapping("/users/{id}")
    public User getUser(@PathVariable("id") Long id) {
        return userRepository.findById(id).orElse(new User());
    }

    @PostMapping("/users")
    public User createUser(
            @ApiParam(value = "Äá»‘i tÆ°á»£ng User cáº§n táº¡o má»›i", required = true) @Valid @RequestBody User user
    ) {
        return userRepository.save(user);
    }

    @PutMapping("/users/{id}")
    public User updateUser(@PathVariable("id") Long id, @Valid @RequestBody User user) {
        user.setId(id);
        return userRepository.save(user);
    }

    @DeleteMapping("/users/{id}")
    public void deleteUser(@PathVariable("id") Long id) {
        userRepository.deleteById(id);
    }
}
```

Tá»›i Ä‘Ã¢y báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Swagger thoáº£i mÃ¡i rá»“i, tÃ´i sáº½ lÃ m má»™t bÃ i khÃ¡c vá»Â **OpenAPI 3.0**.

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

