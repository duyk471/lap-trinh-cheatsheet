[SB22] HÆ°á»›ng dáº«n tá»± táº¡o custom @Conditional
====================================================

- Giá»›i thiá»‡u
- Tá»± táº¡o @Conditional
- Tá»± táº¡o Annotation @Conditional
- Cháº¡y thá»­
- Káº¿t há»£p nhiá»u Ä‘iá»u kiá»‡n vá»›i OR
- Káº¿t há»£p nhiá»u Ä‘iá»u kiá»‡n vá»›i AND
- Káº¿t

### **Giá»›i thiá»‡u**

YÃªu cáº§u báº¡n pháº£i Ä‘á»c bÃ i viáº¿t vá»Â `@Conditional`Â trÆ°á»›c:

1. [Spring Boot] HÆ°á»›ng dáº«n táº¡o Bean cÃ³ Ä‘iá»u kiá»‡n vá»›i @Conditional

TÃ´i Ä‘Ã£ giá»›i thiá»‡u vá»›i cÃ¡c báº¡n cÃ¡c sá»­ dá»¥ng cÃ¡c loáº¡iÂ `@Conditional`Â cÃ³ sáºµn trong Spring Boot. Tuy nhiÃªn, trÃªn thá»±c táº¿, sáº½ cÃ³ nhá»¯ng lÃºc yÃªu cáº§u cÃ¡c loáº¡i Ä‘iá»u kiá»‡n náº±m ngoÃ i pháº¡m vi cá»§a Spring Boot cung cáº¥p.

Khi Ä‘Ã³, chÃºng ta pháº£i tá»± táº¡oÂ `@Condinal`Â cho mÃ¬nh.

### **Tá»± táº¡o @Conditional**

Äá»ƒ táº¡o ra má»™t Ä‘iá»u kiá»‡n cho mÃ¬nh, báº¡n cáº§n káº¿ thá»«a lá»›pÂ `Condition`, vÃ  implement láº¡i functionÂ `matches`

`matches`Â lÃ  nÆ¡i báº¡n kiá»ƒm tra Ä‘iá»u kiá»‡n xem cÃ³ thoáº£ mÃ£n khÃ´ng.

```
/*
Má»™t Ä‘iá»u kiá»‡n, pháº£i káº¿ thá»«a lá»›p Condition cá»§a Spring Boot cung cáº¥p
 */
public class WindowRequired implements Condition{

    @Override
    public boolean matches(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata) {
        // Náº¿u OS ra window tráº£ ra true.
        return System.getProperty("os.name").toLowerCase().contains("win");
    }
}
```

VÃ  khi Ä‘Ã£ Ä‘á»‹nh nghÄ©a Ä‘Æ°á»£c cho mÃ¬nh má»™t Ä‘iá»u kiá»‡n riÃªng, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nhÆ° sau:

```
@Configuration
public class AppConfiguration {
    public static class SomeBean{
    }

    /*
    SomeBean chá»‰ Ä‘Æ°á»£c táº¡o ra khi
    thá»a mÃ£n Ä‘iá»u kiá»‡n
     */
    @Conditional(WindowRequired.class)
    @Bean
    SomeBean someBean(){
        return new SomeBean();
    }
}
```

### **Tá»± táº¡o Annotation @Conditional**

Náº¿u viá»‡c viáº¿tÂ `@Conditional(WindowRequired.class)`Â chÆ°a lÃ m báº¡n hÃ i lÃ²ng, báº¡n cÃ³ thá»ƒ tá»± táº¡o ra má»™tÂ `Annotation`Â giá»‘ng vá»›i Spring Boot.

VÃ­ dá»¥ nhÆ°Â `@ConditionalOnClass`Â trongÂ bÃ i viáº¿t trÆ°á»›c

ThÃ¬ hÃ£y lÃ m nhÆ° sau:

```
@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Documented
// ÄÃ¡nh dáº¥u annotation nÃ y bá»Ÿi @Conditional(WindowRequired.class)
@Conditional(WindowRequired.class)
public @interface ConditionalOnWindow {
    /*
    Trong trÆ°á»ng há»£p báº¡n muá»‘n viáº¿t ngáº¯n gá»n,
    hay táº¡o ra 1 Annotation má»›i vÃ  gáº¯n @Conditional(WindowRequired.class)
    trÃªn nÃ³

    NhÆ° váº­y khi cáº§n sá»­ dá»¥ng chá»‰ cáº§n gá»i @ConditionalOnWindow lÃ  Ä‘Æ°á»£c
     */
}
```

Khi sá»­ dá»¥ng:

```
@Configuration
public class AppConfiguration {
    public static class SomeBean{
    }

    /*
    SomeBean chá»‰ Ä‘Æ°á»£c táº¡o ra khi
    thá»a mÃ£n Ä‘iá»u kiá»‡n
     */
    @ConditionalOnWindow
    @Bean
    SomeBean someBean(){
        return new SomeBean();
    }
}
```

### **Cháº¡y thá»­**

```
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(App.class, args);
        try {
            SomeBean someBean = context.getBean(SomeBean.class);
            System.out.println("SomeBean tá»“n táº¡i!");
        }catch (Exception e){
            System.out.println("SomeBean chá»‰ Ä‘Æ°á»£c táº¡o náº¿u cháº¡y trÃªn Window");
        }

    }
}
```

HÃ£y bá» AnnotationÂ `@ConditionalOnWindow`Â Ä‘i vÃ  cháº¡y thá»­, sau Ä‘Ã³ thÃªm láº¡i, xem káº¿t quáº£ cá»§a 2 láº§n cháº¡y.

### **Káº¿t há»£p nhiá»u Ä‘iá»u kiá»‡n vá»›i OR**

Báº¡n cÃ³ thá»ƒ káº¿t há»£p nhiá»u Ä‘iá»u kiá»‡n vá»›i nhau bá»Ÿi phÃ©p OR.

Spring Boot há»— trá»£ Ä‘iá»u nÃ y báº±ng cÃ¡ch káº¿ thá»«a lá»›pÂ `AnyNestedCondition`

```
/**
 * Class káº¿ thá»«a AnyNestedCondition sáº½ cháº¥p nháº­n má»i
 * Ä‘iá»u kiá»‡n @Conditional bÃªn trong nÃ³
 */
public class WindowOrMacRequired extends AnyNestedCondition{

    public WindowOrMacRequired(){
        super(ConfigurationPhase.REGISTER_BEAN);
    }

    /*
    Báº¡n pháº£i Ä‘á»‹nh nghÄ©a cÃ¡c Äiá»u kiá»‡n bÃªn trong class
    káº¿ thá»«a AnyNestedCondition
     */
    @Conditional(WindowRequired.class)
    public class RunOnWindow{}

    /*
    LÃºc nÃ y, cáº£ 2 Ä‘iá»u kiá»‡n Window vÃ  Mac sáº½ Ä‘Æ°á»£c káº¿t há»£p vs
    nhau khi kiá»ƒm tra, náº¿u thoáº£ mÃ£n 1 trong 2 lÃ  Ä‘c
     */
    @Conditional(MacRequired.class)
    public class RunOnMac{}
}
```

Sá»­ dá»¥ng

```
@Configuration
public class AppConfiguration {
    public static class SomeBean{
    }

    /*
    SomeBean chá»‰ Ä‘Æ°á»£c táº¡o ra khi
    thá»a mÃ£n Ä‘iá»u kiá»‡n
     */
    @Conditional(WindowOrMacRequired.class)
    @Bean
    SomeBean someBean(){
        return new SomeBean();
    }
}
```

### **Káº¿t há»£p nhiá»u Ä‘iá»u kiá»‡n vá»›i AND**

Báº¡n cÃ³ thá»ƒ káº¿t há»£p cÃ¡c Ä‘iá»u kiá»‡n báº±ng phÃ©p AND báº±ng cÃ¡ch káº¿ thá»«a lá»›pÂ `AllNestedConditions`.

CÃ¡ch káº¿ thá»«a cá»§a nÃ³ giá»‘ng vá»›iÂ `AnyNestedCondition`Â nÃªn tÃ´i sáº½ khÃ´ng cáº§n Ä‘á» cáº­p thÃªm.

NgoÃ i ra, cÃ³ má»™t cÃ¡ch khÃ¡c lÃ  sá»­ dá»¥ng nhiá»u customÂ `@Conditional`Â cÃ¹ng má»™t lÃºc.

```
@Bean
@ConditionalOnWindow
@Conditional(MacRequired.class)
SomeBean someBean() {
  return new SomeBean();
}
```

### **Káº¿t**

Tá»›i Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ náº¯m vá»¯ng Ä‘Æ°á»£c cÃ¡ch táº¡o Ä‘iá»u kiá»‡n cho cáº¥u hÃ¬nh á»©ng dá»¥ng cá»§a mÃ¬nh, nÃ³ sáº½ ráº¥t cÃ³ Ã­ch khi báº¡n lÃ m viá»‡c vÃ  tÃ¡ch biá»‡t Ä‘Æ°á»£c hai mÃ´i trÆ°á»ng dev vÃ  production.

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

