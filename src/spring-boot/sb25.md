[SB25] RESTful API Document vá»›i Spring Boot + OpenApi 3.0
===========================================================

- Giá»›i thiá»‡u
- cÃ i Ä‘áº·t
- Tá»•ng quan OpenApi 3.0
- Prepare
- Config OpenApi 3.0
- Káº¿t

### **Giá»›i thiá»‡u**

Trong bÃ i viáº¿t trÆ°á»›c:

1. RESTful API Document Táº¡o vá»›i Spring Boot + Swagger

TÃ´i Ä‘Ã£ giá»›i thiá»‡u lÃ­ do vÃ¬ sao cáº§n Document, vÃ  cÃ¡ch táº¡o ra nÃ³ nhanh chÃ³ng vá»›iÂ `Swagger 2`.

Trong bÃ i nÃ y, tÃ´i sáº½ giá»›i thiá»‡u thÃªm phiÃªn báº£n tiáº¿p theo, má»™t tiÃªu chuáº©n má»›i nháº¥t vá» RESTful document Ä‘Ã³ lÃ  OpenApi 3.0.

Táº¡i sao k Ä‘áº·t tÃªn lÃ Â `Swagger 3`? cÃ¢u chuyá»‡n Ä‘áº±ng sau nÃ³ lÃ  viá»‡c SmartBear mua láº¡i Swagger, vÃ  Ä‘á»•i tÃªn Swagger Specification thÃ nh OpenApi Specification, báº¯t Ä‘áº§u táº¡o ra cÃ¡c tiÃªu chuáº©n má»›i cho xÃ¢y dá»±ng Document, tuy nhiÃªn váº«n xÃ¢y dá»±ng trÃªn Swagger core.

`OpenApi 3.0`Â lÃ  báº£n má»›i nháº¥t Ä‘Æ°á»£c ra máº¯t táº¡i thá»i Ä‘iá»ƒm viáº¿t bÃ i nÃ y.

Trong bÃ i cÃ³ Ä‘á» cáº­p cÃ¡c kiáº¿n thá»©c:

1. Spring Boot
2. jpa
3. lombok

### **cÃ i Ä‘áº·t**

_pom.xml_

```
<?xml version="1.0" encoding="UTF-8"?>
<projectxmlns="http://maven.apache.org/POM/4.0.0"xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"xsi:schemaLocation="http://maven.apache.org/POM/4.0.0https://maven.apache.org/xsd/maven-4.0.0.xsd"><modelVersion>4.0.0</modelVersion><parent><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-parent</artifactId><version>2.0.5.RELEASE</version><relativePath/> <!-- lookup parent from repository -->
	</parent><groupId>me.loda.spring</groupId><artifactId>example-independent-maven-spring-project</artifactId><version>0.0.1-SNAPSHOT</version><name>example-independent-maven-spring-project</name><description>Demo project for Spring Boot</description><properties><java.version>1.8</java.version></properties><dependencies><dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-web</artifactId></dependency><dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-devtools</artifactId><scope>runtime</scope><optional>true</optional></dependency><dependency><groupId>org.projectlombok</groupId><artifactId>lombok</artifactId><optional>true</optional></dependency><dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-test</artifactId><scope>test</scope></dependency><!--https://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-core -->
        <dependency><groupId>org.springdoc</groupId><artifactId>springdoc-openapi-core</artifactId><version>1.1.49</version></dependency><dependency><groupId>org.springdoc</groupId><artifactId>springdoc-openapi-ui</artifactId><version>1.1.49</version></dependency><!--spring jpa-->
		<dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-data-jpa</artifactId></dependency><!--in memory database-->
		<dependency><groupId>com.h2database</groupId><artifactId>h2</artifactId><scope>runtime</scope></dependency></dependencies><build><plugins><plugin><groupId>org.springframework.boot</groupId><artifactId>spring-boot-maven-plugin</artifactId></plugin></plugins></build></project>
```

`springdoc`Â lÃ  má»™t thÆ° viá»‡n java implementation cá»§a OpenApi Specification 3.0.

`springdoc-openapi-core`Â chá»©a core cá»§a swagger, giÃºp chÃºng ta khai bÃ¡o document cho api.

`springdoc-openapi-ui`Â giÃºp chÃºng ta biá»ƒu diá»…n tÃ i liá»‡u dÆ°á»›i dáº¡ng web view, dá»… nhÃ¬n vÃ  test.

### **Tá»•ng quan OpenApi 3.0**

`OpenApi 3.0`Â káº¿ thá»«a vÃ  Ä‘á»•i má»›i khÃ¡ nhiá»u cÃ¡c thÃ nh pháº§n cá»§aÂ `Swagger2`, khiáº¿n nÃ³ tÆ°á»ng minh vÃ  dá»… Ä‘á»c hÆ¡n.

SWAGGER2OPENAPI 3.0DESCRIPTION@Api

@Tag

ÄÃ¡nh dáº¥u 1 class lÃ  nÆ¡i chá»©a cÃ¡c API

@ApiModel

khÃ´ng cÃ²n

ÄÃ¡nh dáº¥u 1 class lÃ  Swagger Model

@ApiModelProperty

@Schema

Bá»• sung cÃ¡c thÃ´ng tin cho

@ApiOperation

@Operation

MÃ´ táº£ cho má»™t API vÃ  response cá»§a nÃ³

@ApiParam

@Parameter

MÃ´ táº£ cÃ¡c parameter

@ApiResponse

@ApiResponse

MÃ´ táº£ status code cá»§a response

@ApiResponses

@ApiResponses

MÃ´ táº£ danh sÃ¡ch cÃ¡c status code cá»§a response

ChÃºng ta Ä‘i vÃ o thá»±c hÃ nh thá»­ nhÃ©.

Äáº¡i loáº¡i sau khi lÃ m xong, chÃºng ta sáº½ cÃ³ 1 web view document nhÆ° tháº¿ nÃ y:

!image

NgoÃ i Ä‘áº¹p hÆ¡n, mÃ´ táº£ chi tiáº¿t vÃ  dá»… sá»­ dá»¥ng hÆ¡n, thÃ¬ cÃ³ 1 pháº§n ráº¥t hay, Ä‘Ã³ lÃ  chÃºng ta cÃ³ thá»ƒ chá»n Server Url khi test API

!image

### **Prepare**

Táº¡o ra class Model

_User.java_

```
@Data
@Entity
@Table
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Schema(description = "User UUID in  the database")
    @JsonProperty("id")
    private Long id;

    private @NotBlank @Size(min = 0, max = 20) String firstName;
    private String lastName;

    private @NotBlank @Size(min = 0, max = 50) String email;
}
```

_UserRepository.java_

```
@Repository
public interface UserRepository extends JpaRepository<User, Long> {

}
```

Khi Ä‘Ã£ cÃ³ Ä‘Æ°á»£c Model vÃ  Repository, chÃºng ta sáº½ táº¡o Controller Ä‘á»ƒ thao tÃ¡c liÃªn quan tá»›iÂ `User`Â nhÃ©.

Äiá»ƒm khÃ¡c biá»‡t lá»›n nháº¥t cá»§aÂ `OpenApi3`Â so vá»›iÂ `Swagger2`Â lÃ  há»‡ thá»‘ng Annotation ráº¥t lÃ  dÃ y Ä‘áº·c, Ä‘a pháº§n cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c biá»ƒu diá»…n vÃ  Äƒn khá»›p vá»›i nhau báº±ng Annotation vÃ  Class.

```
@RestController
@RequestMapping("/api/v1")
@RequiredArgsConstructor
@Tag(name = "user")
public class UserController {
    private final UserRepository userRepository;

    @Operation(description = "Xem danh sÃ¡ch User", responses = {
            @ApiResponse(content = @Content(array = @ArraySchema(schema = @Schema(implementation = User.class))), responseCode = "200") })
    @ApiResponses(value = {
            @ApiResponse(responseCode  = "200", description = "ThÃ nh cÃ´ng"),
            @ApiResponse(responseCode  = "401", description = "ChÆ°a xÃ¡c thá»±c"),
            @ApiResponse(responseCode  = "403", description = "Truy cáº­p bá»‹ cáº¥m"),
            @ApiResponse(responseCode  = "404", description = "KhÃ´ng tÃ¬m tháº¥y")
    })
    @GetMapping("/users")
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }

    @GetMapping("/users/{id}")
    public User getUser(@PathVariable("id") Long id) {
        return userRepository.findById(id).orElse(new User());
    }

    @PostMapping("/users")
    public User createUser(
            @Valid
            @Parameter(description = "User model to create.", required = true, schema = @Schema(implementation = User.class))
            @RequestBody User user) {
        return userRepository.save(user);
    }

    @PutMapping("/users/{id}")
    public User updateUser(@PathVariable("id") Long id, @Valid @RequestBody User user) {
        user.setId(id);
        return userRepository.save(user);
    }

    @DeleteMapping("/users/{id}")
    public void deleteUser(@PathVariable("id") Long id) {
        userRepository.deleteById(id);
    }
}
```

Ã‚u khÃª, Chá»‰ cáº§n nhÆ° váº­y lÃ  cháº¡y Ä‘Æ°á»£c rá»“i.

Náº¿u Ä‘áº§y Ä‘á»§ hÆ¡n, thÃ¬ báº¡n nÃªn configÂ `OpenApi`Â cho dá»± Ã¡n cá»§a chÃºng ta Ä‘á»ƒ bá»• sung cÃ¡c thÃ´ng tin tá»•ng quan.

### **Config OpenApi 3.0**

Chá»‰ cáº§n táº¡o ra Ä‘á»‘i tÆ°á»£ngÂ `OpenAPI`Â vÃ  cung cáº¥p cÃ¡c thÃ´ng tin cáº§n thiáº¿t.

```
@Configuration
public class OpenApiConfig {
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                // Thiáº¿t láº­p cÃ¡c server dÃ¹ng Ä‘á»ƒ test api
                .servers(Lists.newArrayList(
                        new Server().url("http://localhost:8080"),
                        new Server().url("https://user.loda.me")
                ))
                // info
                .info(new Info().title("Loda Application API")
                                .description("Sample OpenAPI 3.0")
                                .contact(new Contact()
                                                 .email("loda.namnh@gmail.com")
                                                 .name("loda")
                                                 .url("https://loda.me/"))
                                .license(new License()
                                                 .name("Apache 2.0")
                                                 .url("http://www.apache.org/licenses/LICENSE-2.0.html"))
                                .version("1.0.0"));
    }
}
```

`OpenApi3.0`Â thÃ¬ báº¡n khÃ´ng cáº§nÂ `@Enable`Â mÃ  chá»‰ cáº§n addÂ `springdoc-openapi-core`Â vÃ o dependencies thÃ´i lÃ  nÃ³ tá»± Ä‘á»™ng gen ra tÃ i liá»‡u rá»“i.

```
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

BÃ¢y giá», cháº¡y thá»­ vÃ  vÃ o Ä‘á»‹a chá»‰Â `http://localhost:8080/swagger-ui.html`Â Ä‘á»ƒ xem thÃ nh quáº£ nhÃ©.

### **Káº¿t**

Tá»›i Ä‘Ã¢y báº¡n cÃ³ thá»ƒ sá»­ dá»¥ngÂ **OpenAPI 3.0**Â thoáº£i mÃ¡i rá»“i.

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

