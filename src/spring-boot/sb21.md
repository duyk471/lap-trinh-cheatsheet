[SB21] HÆ°á»›ng dáº«n táº¡o Bean cÃ³ Ä‘iá»u kiá»‡n vá»›i @Conditional
======================================================================

- Giá»›i thiá»‡u
- CÃ¡ch táº¡o bean cÃ³ Ä‘iá»u kiá»‡n
- @ConditionalOnBean
- @ConditionalOnProperty
- @ConditionalOnExpression
- @ConditionalOnMissingBean
- @ConditionalOnResource
- @ConditionalOnClass
- @ConditionalOnMissingClass
- @ConditionalOnJava
- Má»™t sá»‘ loáº¡i khÃ¡c
- Custom Conditional
- Káº¿t

### **Giá»›i thiá»‡u**

Khi xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh vá»›iÂ **Spring Boot**Â Ä‘Ã´i lÃºc chÃºng ta má»™tÂ **Bean**Â chá»‰ Ä‘Æ°á»£c load lÃªn hoáº·c khá»Ÿi táº¡o theo má»™t Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³. VÃ­ dá»¥ nhÆ° táº¡o má»™tÂ **Bean**Â trong mÃ´i trÆ°á»ng Test, cÃ²n mÃ´i trÆ°á»ng tháº­t sáº½ khÃ´ng cáº§n ná»¯a.

**Spring Boot**Â há»— trá»£ chÃºng ta lÃ m Ä‘iá»u nÃ y vá»›i AnnotationÂ `@Conditional`.

BÃ i nÃ y yÃªu cáº§u kiáº¿n thá»©c cÆ¡ báº£n:

1. ã€ŒSpring Boot #0ã€ Series lÃ m chá»§ Spring Boot, Zero to Hero

ToÃ n bá»™ vÃ­ dá»¥ trong bÃ i viáº¿t nÃ yÂ Ä‘á»u cÃ³ táº¡i Github

### **CÃ¡ch táº¡o bean cÃ³ Ä‘iá»u kiá»‡n**

TrongÂ **Spring Boot**, cÃ³ ráº¥t nhiá»u cÃ¡ch Ä‘á»ƒ táº¡o raÂ `Bean`, báº¡n biáº¿t cÃ¡ch nÃ o?

`@Component`,Â `@Configuration`,Â `@Bean`,Â `@Service`, v.v...

Vá»›i táº¥t cáº£ cÃ¡c cÃ¡ch táº¡o raÂ `Bean`, báº¡n Ä‘á»u cÃ³ thá»ƒ thÃªmÂ **má»™t hoáº·c nhiá»u Ä‘iá»u kiá»‡n**Â Ä‘á»ƒ cho viá»‡c táº¡o raÂ `Bean`Â Ä‘Ã³ chá»‰ xáº£y ra náº¿u nÃ³ thá»a mÃ£n má»™t Ä‘iá»u kiá»‡n cho trÆ°á»›c.

**SpringBoot**Â há»— trá»£ ráº¥t nhiá»u loáº¡i Ä‘iá»u kiá»‡n khÃ¡c nhau, táº¥t cáº£ Ä‘á»u sáº½ báº¯t Ä‘áº§u báº±ng tiá»n tá»‘Â `@Conditional...`. CÃ²n háº­u tá»‘ thÃ¬ chÃºng ta sáº½ Ä‘á» cáº­p sau.

CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a táº¥t cáº£Â `@Condition`Â nhÆ° sau:

```
@Configuration
public class ConditionalOnBeanExample {
    /*
    ABeanWithCondition chá»‰ Ä‘Æ°á»£c táº¡o ra khi @Condition thá»a mÃ£n
    */
    @Bean
    @Conditional...
    ABeanWithCondition aBeanWithACondition() {
        return new ABeanWithCondition();
    }
}
```

Náº¿u báº¡n gáº¯n nÃ³ trÃªn má»™tÂ `@Configuration`Â thÃ¬ toÃ n bá»™ cÃ¡cÂ `@Bean`Â bÃªn trong sáº½ bá»‹ chá»‹u tÃ¡c Ä‘á»™ng.

```
@Conditional...
@Configuration
public class ConditionalOnBeanExample {
    /*
    SomeOtherBean chá»‰ Ä‘Æ°á»£c táº¡o ra khi @Condition thá»a mÃ£n
    */
    @Bean
    SomeOtherBean someOtherBean() {
        return new SomeOtherBean();
    }
       /*
    SomeOtherBean2 chá»‰ Ä‘Æ°á»£c táº¡o ra khi @Condition thá»a mÃ£n
    */
    @Bean
    SomeOtherBean2 someOtherBean2() {
        return new SomeOtherBean2();
    }
}
```

TÆ°Æ¡ng tá»± cho táº¥t cáº£ cÃ¡c annotation khÃ¡c nhÆ°Â `@Component`,Â `@Service`,Â `@Repository`

```
@Conditional...
@Component
public class ConditionalOnBeanExample {
}
```

BÃ¢y giá» chÃºng ta sáº½ Ä‘i tÃ¬m hiá»ƒu cÃ¡c loáº¡i Ä‘iá»u kiá»‡n trongÂ **Spring Boot**.

### **@ConditionalOnBean**

`@ConditionalOnBean`Â sá»­ dá»¥ng khi chÃºng ta muá»‘n táº¡o ra má»™t Bean, chá»‰ khi cÃ³ má»™t Bean khÃ¡c Ä‘ang tá»“n táº¡i

```
@Configuration
public class ConditionalOnBeanExample {
    /*
    ÄÃ¢y lÃ  má»™t Bean, báº¡n hÃ£y cháº¡y á»©ng dá»¥ng
    khi comment vÃ  cháº¡y láº¡i láº§n ná»¯a nhÆ°ng bá» dáº¥u comment phÃ­a
    dÆ°á»›i Ä‘á»ƒ xem káº¿t quáº£.
     */
    // @Bean
    RandomBean randomBean() {
        return new RandomBean();
    }

    /*
    ABeanWithCondition chá»‰ Ä‘Æ°á»£c táº¡o ra, khi RandomBean tá»“n táº¡i trong Context.
     */
    @Bean
    @ConditionalOnBean(RandomBean.class)
    ABeanWithCondition aBeanWithACondition() {
        return new ABeanWithCondition();
    }
}
```

### **@ConditionalOnProperty**

DÃ¹ngÂ `@ConditionalOnProperty`Â khi báº¡n muá»‘n quyáº¿t Ä‘á»‹nh sá»± tá»“n táº¡i Bean thÃ´ng qua cáº¥u hÃ¬nh property.

```
@Configuration
public class ConditionalOnPropertyExample {

    /*
    @ConditionalOnProperty giÃºp gáº¯n Ä‘iá»u kiá»‡n cho @Bean dá»±a theo
    property trong config
     */
    @Bean
    @ConditionalOnProperty(
            value="loda.bean2.enabled",
            havingValue = "true", // Náº¿u giÃ¡ trá»‹ loda.bean2.enabled  = true thÃ¬ Bean má»›i Ä‘Æ°á»£c khá»Ÿi táº¡o
            matchIfMissing = false) // matchIFMissing lÃ  giÃ¡ trá»‹ máº·c Ä‘á»‹nh náº¿u khÃ´ng tÃ¬m tháº¥y property loda.bean2.enabled
    ABeanWithCondition2 aBeanWithCondition2(){
        return new ABeanWithCondition2();
    }
}
```

_application.properties_

```
#Thay Ä‘á»•i thÃ nh true Ä‘á»ƒ táº¡o bean2
loda.bean2.enabled=true
```

### **@ConditionalOnExpression**

Trong trÆ°á»ng há»£p báº¡n muá»‘n thá»a mÃ£n nhiá»u Ä‘iá»u kiá»‡n trong property, hÃ£y sá»­ dá»¥ngÂ `@ConditionalOnExpression`

```
@Configuration
@ConditionalOnExpression(
        "${loda.expression1.enabled:true} and ${loda.expression2.enabled:true}"
)
public class ConditionalOnExpressionExample {
}
```

### **@ConditionalOnMissingBean**

Náº¿u trongÂ `Context`Â chÆ°a tá»“n táº¡i báº¥t ká»³ Bean nÃ o tÆ°Æ¡ng tá»±, thÃ¬Â `@ConditionalOnMissingBean`Â sáº½ thá»a mÃ£n Ä‘iá»u kiá»‡n vÃ  táº¡o ra má»™t Bean nhÆ° tháº¿.

```
@Configuration
public class ConditionalOnMissingBeanExample {
    /**
     * Náº¿u trong Context chÆ°a tá»“n táº¡i má»™t SomeMissingBean nÃ o
     * ThÃ¬ Bean á»Ÿ dÆ°á»›i Ä‘Ã¢y má»›i Ä‘Æ°á»£c táº¡o
     * @return
     */
    @ConditionalOnMissingBean
    DataSource someMissingBean(){
        return new DataSource();
    }
}
```

### **@ConditionalOnResource**

`@ConditionalOnResource`Â thá»a mÃ£n khi cÃ³ má»™t resources nÃ o Ä‘Ã³ do báº¡n chá»‰ Ä‘á»‹nh tá»“n táº¡i

```
/*
Náº¿u Spring Boot khÃ´ng tÃ¬m tháº¥y file application.properties thÃ¬ class nÃ y khÃ´ng Ä‘Æ°á»£c táº¡o
*/
@Configuration
@ConditionalOnResource(resources = "/application.properties")
public class ConditionalOnResourceExample {
}
```

### **@ConditionalOnClass**

`@ConditionalOnClass`Â thá»a mÃ£n khi trong classpath cÃ³ tá»“n táº¡i class mÃ  báº¡n yÃªu cáº§u

```
@Configuration
@ConditionalOnClass(name = "loda.me.spring.LodaHandsome")
class ConditionalOnClassExample {
}
```

### **@ConditionalOnMissingClass**

`@ConditionalOnMissingClass`Â ngÆ°á»£c láº¡i vá»›iÂ `@ConditionalOnClass`. thá»a mÃ£n khi trong classpathÂ **khÃ´ng**Â tá»“n táº¡i class mÃ  báº¡n yÃªu cáº§u

```
@Configuration
@ConditionalOnMissingClass(name = "loda.me.spring.LodaHandsome")
class ConditionalOnMissingClassExample {
}
```

### **@ConditionalOnJava**

`@ConditionalOnJava`Â thá»a mÃ£n náº¿u mÃ´i trÆ°á»ng cháº¡y version Java Ä‘Ãºng vá»›i Ä‘iá»u kiá»‡n

```
@Configuration
@ConditionalOnJava(JavaVersion.EIGHT)
class ConditionalOnJavaExample {
}
```

### **Má»™t sá»‘ loáº¡i khÃ¡c**

Váº«n cÃ²n cÃ¡c báº¡n áº¡, nhá»¯ng mÃ¬nh tháº¥y nÃ³ Ã­t khi Ä‘Æ°á»£c sá»­ dá»¥ng, nÃªn sáº½ khÃ´ng Ä‘á» cáº­p, trÃ¡nh loáº¡n thÃ´ng tin.

### **Custom Conditional**

Táº¥t nhiÃªn lÃ  báº¡n hoÃ n toÃ n cÃ³ thá»ƒ tá»± táº¡o ra cho mÃ¬nh má»™t Ä‘iá»u kiá»‡n. MÃ¬nh sáº½ Ä‘á» cáº­p cÃ¡ch lÃ m á»Ÿ bÃ i sau.

### **Káº¿t**

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

